<!--{%extends "sub-layout-shop.twig"%}-->
<!--{%block main_content%}-->
<div class="row-fluid">
	<div class="span12">
		<div class="box box-color box-bordered">
			<div class="box-title">
				<h3>
					<i class="icon-table"></i>
					物品管理
				</h3>
				<div class="actions">
					<form action="<!--{{url('/v4backpack/goods/list')}}-->">
						<table class="table-filter">
							<tr>
	                            <td>
	                            	<input name="goodsname"  placeholder="请填写物品名称" style="width:177px;" type="text" class="input-small" value="<!--{{goodsname}}-->" >
	                            </td>
                            	<td><!--{{form_select('goodstype',goodstypeList,goodstype,{'id':'complete_type','style':'margin-top:10px;width:100px'})}}--></td>
								<td>
									开始时间
									<div class="input-append date " >
										<input name="startTime" onclick="laydate({istime: true, format: 'YYYY-MM-DD hh:mm:ss'})" type="text" class="input-medium datetimepicker" id="date_timepicker_start" value="<!--{{startTime}}-->" readonly>
										<span class="add-on"><i class="icon-calendar"></i></span>
									</div>

								</td>
								<td>
									结束时间
									<div class="input-append date " >
										<input name="endTime" onclick="laydate({istime: true, format: 'YYYY-MM-DD hh:mm:ss'})" type="text" class="input-medium datetimepicker" id="date_timepicker_start" value="<!--{{endTime}}-->" readonly>
										<span class="add-on"><i class="icon-calendar"></i></span>
									</div>
								</td>
                        	<td><button class="btn btn-teal"><i class="icon-search"></i>搜索</button></td>
	                        <td><a href="<!--{{url('v4backpack/goods/product-add')}}-->" class="btn btn-teal"><i class="icon-plus" title="添加物品"></i></a></td>
                        </tr>
                     </table>
					</form>	
				</div>
			</div>
			<div class="box-content nopadding">
				<table class="table table-hover table-nomargin">
					<thead>
					<tr>
						<!-- <th class="col-60">ID</th> -->
						<th class="col-60">图片</th>
						<th class="col-100">物品名称/ID</th>
						<th class="col-60">类型</th>
						<th class="col-80">截止时间</th>
						<th class="col-80">排序</th>
						<th class="table-btn-group">操作</th>
						<th class="col-80">最后操作人</th>	
						<th class="col-80">最后操作时间</th>	
					</tr>
					</thead>
					<tbody>
					<!--{% for key,item in datalist%}-->
					<tr id="tr_<!--{{item.goodsid}}-->">
						<td class="user-avatar"><img src='<!--{{item.picurl}}-->'/></td>
						<td><!--{{item.goodsname}}--><br/><!--{{item.goodsid}}--></td>
						<td><!--{{goodstypeList[item.goodstype]}}--></td>
						<td><!--{{item.endtime}}--></td>
						<td><!--{{item.sortvalue}}--></td>

						<td>
							<a href="<!--{{url('v4backpack/goods/product-edit',{id:item.goodsid})}}-->" class="btn btn-primary">编辑</a>
							<a href='javascript:;' class="btn btn-primary myfafang" data-url="<!--{{url('v4backpack/goods/fafang',{id:item.goodsid})}}-->" goodsname="<!--{{item.goodsname}}-->" goodsid="<!--{{item.goodsid}}-->" >发放</a>
							<a href='javascript:;' code="<!--{{item.goodsid}}-->"  url="<!--{{url('v4backpack/goods/goodsdelete',{id:item.goodsid})}}-->" class="btn btn-primary ajax-del"><i class="icon-trash"></i>删除</a>
							
						</td>
						<td><!--{{item.operator}}--></td>
						<td><!--{{item.updatetime}}--></td>
					</tr>
					<!--{%endfor%}-->
					</tbody>
				</table>
				<div class="pagelink">
					<!--{{pagelinks}}-->
				</div>
			</div>
		</div>
	</div>
</div>


	<div id="dialog-confirm" style="display:none" >
		<div class="box-content" style="width: 560px;">
            <div class="control-group">
            	<label class="control-label">发放方式</label>
                <div class="controls">
                	<input type="radio" name="ff_type" value="1" checked >直接发放
                    <input type="radio" name="ff_type" value="2" >注册发放
                    <input type="radio" name="ff_type" value="3" >登录发放
                </div>
            </div>
            <div class="control-group" id="dialog-ffboject1" >
            	<label class="control-label">发放对象</label>
                <div class="controls">
                    <input type="radio" name="ff_boject" value="2" checked >指定UID用户
                    <input type="radio" name="ff_boject" value="3" >指定注册时间用户
                </div>
            </div>
            <div class="control-group" id="dialog-ffboject2" style="display:none" >
            	<label class="control-label">发放对象</label>
                <div class="controls">
                	<input type="radio" name="ff_boject" value="1" >全部用户
                </div>
            </div>
            <div class="control-group" id="dialog-ffboject3" style="display:none" >
            	<label class="control-label">发放对象</label>
                <div class="controls">
                	<input type="radio" name="ff_boject" value="1" >全部用户
                    <input type="radio" name="ff_boject" value="2" >指定UID用户
                    <input type="radio" name="ff_boject" value="3" >指定注册时间用户
                </div>
            </div>
            <div class="control-group" id="dialog-ffcount1" >
            	<label class="control-label">发放次数</label>
                <div class="controls">
                	<input type="radio" name="ff_count" value="1" checked >一次
                </div>
            </div>
            <div class="control-group" id="dialog-ffcount2" style="display:none" >
            	<label class="control-label">发放次数</label>
                <div class="controls">
                	<input type="radio" name="ff_count" value="1" >一次
                    <input type="radio" name="ff_count" value="2" >每日一次
                </div>
            </div>
			<div class="control-group" id="dialog-fftime">
				<label class="control-label">发放时间</label>
				<div class="controls">
					 <input name="ff_time" onclick="laydate({istime: true, format: 'YYYY-MM-DD hh:mm:ss'})" type="text" class="input-medium datetimepicker" id="ff_time" value="<!--{{ input_old('ff_time') }}-->" readonly>
                     <span class="add-on"><i class="icon-calendar"></i></span>
				</div>
			</div>
			<div class="row-fluid" id="dialog-fftime-se" style="display:none" >
				<div class="span5">
					<div class="control-group">
						<label class="control-label">发放开始时间</label>
						<div class="controls">
							<div class="input-append date">
								<input name="ff_starttime" id="ff_starttime" onclick="laydate({istime: true, format: 'YYYY-MM-DD hh:mm:ss'})" type="text" class="input-medium " value="<!--{{ input_old('ff_starttime') }}-->" data-rule-required="true"  data-msg-required="请填写发放开始时间"  readonly>
								<span class="add-on"><i class="icon-calendar"></i></span>
							</div>
						</div> 
					</div>
				</div>
				<div class="span5">
					<div class="control-group">
						<label class="control-label">发放结束时间</label>
						<div class="controls">
							<div class="input-append date">
								<input name="ff_endtime" id="ff_endtime" onclick="laydate({istime: true, format: 'YYYY-MM-DD hh:mm:ss'})" type="text" class="input-medium " value="<!--{{ input_old('ff_endtime') }}-->" data-rule-required="true"  data-msg-required="请填写发放结束时间" readonly>
								<span class="add-on"><i class="icon-calendar"></i></span>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="row-fluid" id="dialog-cctime" style="display:none" >
				<div class="span5">
					<div class="control-group">
						<label class="control-label">注册开始时间</label>
						<div class="controls">
							<div class="input-append date">
								<input name="cc_starttime" id="cc_starttime" onclick="laydate({istime: true, format: 'YYYY-MM-DD hh:mm:ss'})" type="text" class="input-medium " value="<!--{{ input_old('cc_starttime') }}-->" data-rule-required="true"  data-msg-required="请填写注册开始时间"  readonly>
								<span class="add-on"><i class="icon-calendar"></i></span>
							</div>
						</div> 
					</div>
				</div>
				<div class="span5">
					<div class="control-group">
						<label class="control-label">注册结束时间</label>
						<div class="controls">
							<div class="input-append date">
								<input name="cc_endtime" id="cc_endtime" onclick="laydate({istime: true, format: 'YYYY-MM-DD hh:mm:ss'})" type="text" class="input-medium " value="<!--{{ input_old('cc_endtime') }}-->" data-rule-required="true"  data-msg-required="请填写注册结束时间" readonly>
								<span class="add-on"><i class="icon-calendar"></i></span>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="control-group" id="dialog-uids" >
				<label class="control-label">用户编号</label>
				<div class="controls">
					<textarea rows="5" cols="30" id="myuids" style="width:400px;height:180px;" name="uids"  class="input-xlarge  input-selected-uids"></textarea>

				</div>
			</div>
			<div class="control-group" id="dialog-version" style="display:none" >
				<label class="control-label">版本限制</label>
				<div class="controls">
					<input type="text" name="appversion" id="appversion" class="input-large" value=""/>

				</div>
			</div>
			<div class="form-actions">
				<a href="javascript:;"  class="btn btn-primary fafang_">发放</a>
			</div>
		</div>
	</div>
	<!-- 模态框（Modal） -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog"
     aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close"
				        data-dismiss="modal" aria-hidden="true">
					&times;
				</button>
				<h4 class="modal-title" id="myModalLabel">

				</h4>
			</div>
			<div id="modal-footer" class="modal-footer">
				<button type="button" class="btn btn-default"
				        data-dismiss="modal">关闭
				</button>
				<a href="javascript:;" id="go_" class="btn btn-primary"> 确定</a>
			</div>
		  </div>
		</div><!-- /.modal-content -->
	</div><!-- /.modal -->
</div>
<!--{%endblock%}-->
<!--{%block footer_js%}-->
<script src="/static/js/laydate/laydate.js"></script>
<script src="/static/js/ajaxfileupload.js"></script>
<script>
	function ff_boject_fade(check_val){
		switch(check_val){
			case '1' :
				$('#dialog-cctime').fadeOut();
				$('#dialog-uids').fadeOut();
				break;
			case '2' :
				$('#dialog-cctime').fadeOut();
				$('#dialog-uids').fadeIn();
				break;
			case '3' :
				$('#dialog-cctime').fadeIn();
				$('#dialog-uids').fadeOut();
				break;
		}
	}
	function ff_type_fade(check_val){
		switch(check_val){
			case '1' :
				$('#dialog-fftime').fadeIn();
				$('#dialog-fftime-se').fadeOut();
				$('#dialog-ffboject1').fadeIn();
				$('#dialog-ffboject1').find("input[type=radio]").eq(0).attr("checked",true);
				$('#dialog-ffboject2').fadeOut();
				$('#dialog-ffboject3').fadeOut();
				$('#dialog-ffcount1').fadeIn();
				$('#dialog-ffcount1').find("input[type=radio]").eq(0).attr("checked",true);
				$('#dialog-ffcount2').fadeOut();
				$('#dialog-cctime').fadeOut();
				$('#dialog-uids').fadeIn();
				$('#dialog-version').fadeOut();
				break;
			case '2' :
				$('#dialog-fftime').fadeOut();
				$('#dialog-fftime-se').fadeIn();
				$('#dialog-ffboject1').fadeOut();
				$('#dialog-ffboject2').fadeIn();
				$('#dialog-ffboject2').find("input[type=radio]").eq(0).attr("checked",true);
				$('#dialog-ffboject3').fadeOut();
				$('#dialog-ffcount1').fadeIn();
				$('#dialog-ffcount1').find("input[type=radio]").eq(0).attr("checked",true);
				$('#dialog-ffcount2').fadeOut();
				$('#dialog-cctime').fadeOut();
				$('#dialog-uids').fadeOut();
				$('#dialog-version').fadeOut();
				break;
			case '3' :
				$('#dialog-fftime').fadeOut();
				$('#dialog-fftime-se').fadeIn();
				$('#dialog-ffboject3').fadeIn();
				$('#dialog-ffboject3').find("input[type=radio]").eq(0).attr("checked",true);
				$('#dialog-ffboject2').fadeOut();
				$('#dialog-ffboject1').fadeOut();
				$('#dialog-ffcount1').fadeOut();
				$('#dialog-ffcount2').fadeIn();
				$('#dialog-ffcount2').find("input[type=radio]").eq(0).attr("checked",true);
				$('#dialog-cctime').fadeOut();
				$('#dialog-uids').fadeOut();
				$('#dialog-version').fadeIn();
				break;
		}
	}
    $('[data-toggle="popover"]').popover();
	$(function(){
		gameselect('#gameselect');
		$('a.ajax-del').bind('click',function(){
			if(!confirm('确定要删除数据吗？')){
				return false;
			}else{
				var url=$(this).attr('url'),code=$(this).attr('code');
				$.get(url,{},function(data){
					if(data.error < 1){
						alert("删除成功！");
						$("#tr_"+code).remove();
					}
				});
			}
		});

		$("a.myfafang").bind('click',function(){
			var html=$("#dialog-confirm").html(),url=$(this).attr("data-url"),goodsname=$(this).attr("goodsname"),goodsid=$(this).attr("goodsid");
			$.dialog({id:'pop-fafang-html',title:'提示',padding:2,content:html,width:610,height:240});
            $("#select-all-uids").click();
			$("a.fafang_").bind('click',function(){
				$("#uids").removeAttr("readonly");
				var uids=$("#myuids").val();
				var ff_type=$("input[name='ff_type']:checked").val();
				var ff_boject=$("input[name='ff_boject']:checked").val();
				var ff_count=$("input[name='ff_count']:checked").val();
				var ff_time=$("#ff_time").val();
				var ff_starttime=$("#ff_starttime").val();
				var ff_endtime=$("#ff_endtime").val();
				var cc_starttime=$("#cc_starttime").val();
				var cc_endtime=$("#cc_endtime").val();
				var appversion=$("#appversion").val();
				$.get(url,{uids:uids,goodsname:goodsname,goodsid:goodsid,ff_type:ff_type,ff_boject:ff_boject,ff_count:ff_count,ff_time:ff_time,ff_starttime:ff_starttime,ff_endtime:ff_endtime,cc_starttime:cc_starttime,cc_endtime:cc_endtime,appversion:appversion},function(data){
					if(data.errorCode==2){
						alert("发放成功");
						setTimeout(function(){location.reload();},1000);
					}else{
						alert(data.errortxt);
					}
					$("#uids").attr("readonly");
					$.dialog.list['pop-fafang-html'].close();
				},"json");
			});
		});
		
		$("input[name='ff_type']").live('change',function(e){
			var check_val = e.currentTarget.value;
			ff_type_fade(check_val);
			return false;
		});		
		$("input[name='ff_boject']").live('change',function(e){
			var check_val = e.currentTarget.value;
			ff_boject_fade(check_val);
			return false;
		});
		
	});
</script>
<!--{%endblock%}-->