<!--{%extends "sub-layout-shop.twig"%}-->

<!--{%block main_content%}-->
<div class="row-fluid">
	<div class="span12">
		<div class="box">
			<div class="box-title">
				<h3><i class="icon-edit"></i>编辑方案</h3>
			</div>
			<div class="box-content">
				<form id="form-product" action="<!--{{url('v4box/plan/plan-edit')}}-->" method="POST" class='form-horizontal form-validate' enctype="multipart/form-data" >
                
					<div class="control-group">
						<label class="control-label">方案名称</label>
						<div class="controls">
							<input type="text" name="title" id="name" data-rule-required="true" data-msg-required="请填写方案名称"
							       class="input-large" value="<!--{{ data.title }}-->"/>
						</div>
					</div>

					<div class="row-fluid">
						<div class="span3">
							<div class="control-group">
								<label class="control-label">方案图片</label>
								<div class="controls">
									<div class="fileupload fileupload-new" data-provides="fileupload">
										<div class="fileupload-new thumbnail" style="max-width: 120px; max-height: 120px;">
											<img src="<!--{{ data.titlePic ? data.titlePic : '/static/img/nopic.gif' }}-->" />
										</div>
										<div class="fileupload-preview fileupload-exists thumbnail" style="max-width: 120px; max-height: 120px; line-height: 20px;"></div>
										<div>
											<span class="btn btn-file"><i class="icon-picture"></i><span class="fileupload-new">选择图片</span><span class="fileupload-exists">重新选择</span><input type="file" data-msg-required="请选择图片" name='titlePic' /></span>
										</div>
									</div>
									<span class="help-inline" style="color: red" >图片最佳尺寸：400*290</span>
									<input type="hidden" name="old_titlePic" value="<!--{{ data.titlePic }}-->">
								</div>
							</div>
						</div>
					</div>
                    
                    <div class="control-group" id="location">
                        <label class="control-label">位置布局:</label>
                        <div class="controls">
                            <!--{{form_select('location',data.locationList,data.location,{'class':'input-medium','id':'location', 'disabled':'disabled'})}}-->
                        </div>
                    </div>
					
					<div class="row-fluid">
						<div class="span3">
							<div class="control-group">
								<label class="control-label">版头图片</label>
								<div class="controls">
									<div class="fileupload fileupload-new" data-provides="fileupload">
										<div class="fileupload-new thumbnail" style="max-width: 120px; max-height: 120px;">
											<img src="<!--{{ data.mastheadPic ? data.mastheadPic : '/static/img/nopic.gif' }}-->" />
										</div>
										<div class="fileupload-preview fileupload-exists thumbnail" style="max-width: 120px; max-height: 120px; line-height: 20px;"></div>
										<div>
											<span class="btn btn-file"><i class="icon-picture"></i><span class="fileupload-new">选择图片</span><span class="fileupload-exists">重新选择</span><input type="file" data-msg-required="请选择图片" name='mastheadPic' /></span>
										</div>
									</div>
									<span class="help-inline" style="color: red" >图片最佳尺寸：400*290</span>
									<input type="hidden" name="old_mastheadPic" value="<!--{{ data.mastheadPic }}-->">
								</div>
							</div>
						</div>
					</div>
					
			        <div class="control-group">
			            <label class="control-label">厂商介绍</label>
			            <div class="controls">
			                <textarea id="introduce" name="introduce" style="width:544px;height:200px;"><!--{{ data.introduce }}--></textarea>
			            </div>
			        </div>

					<div class="row-fluid">
						<div class="span3">
							<div class="control-group">
								<label class="control-label">logo图片</label>
								<div class="controls">
									<div class="fileupload fileupload-new" data-provides="fileupload">
										<div class="fileupload-new thumbnail" style="max-width: 120px; max-height: 120px;">
											<img src="<!--{{ data.logos ? data.logos : '/static/img/nopic.gif' }}-->" />
										</div>
										<div class="fileupload-preview fileupload-exists thumbnail" style="max-width: 120px; max-height: 120px; line-height: 20px;"></div>
										<div>
											<span class="btn btn-file"><i class="icon-picture"></i><span class="fileupload-new">选择图片</span><span class="fileupload-exists">重新选择</span><input type="file" data-msg-required="请选择图片" name='logos' /></span>
										</div>
									</div>
									<span class="help-inline" style="color: red" >图片最佳尺寸：400*290</span>
									<input type="hidden" name="old_logos" value="<!--{{ data.logos }}-->">
								</div>
							</div>
						</div>
					</div>

					<div class="control-group">
						<label class="control-label">关联游戏</label>
						<div class="controls">
							<div class="input-append">
								<input id="selected_game_id" name="game_id" type="hidden" value="<!--{{ data.game_id }}-->"/>
								<input type="text" readonly id="selected_game_name" name="game_name" class="input-medium" value="<!--{{ data.game_name }}-->" />
								<!--<input id="selected_game_icon" name="gicon" type="hidden" value="<!--{{ data.gicon }}-->"/>-->
								<span class="add-on select-pop-game">选择游戏</span>
                                <input type="button" value="清除游戏" class="clear_game"/>
							</div>
						</div>
					</div>
					
					<div class="row-fluid">
						<div class="span3">
							<div class="control-group">
								<label class="control-label">游戏图片</label>
								<div class="controls">
									<div class="fileupload fileupload-new" data-provides="fileupload">
										<div class="fileupload-new thumbnail" style="max-width: 120px; max-height: 120px;">
											<img src="<!--{{ data.gicon ? data.gicon : '/static/img/nopic.gif' }}-->" />
										</div>
										<div class="fileupload-preview fileupload-exists thumbnail" style="max-width: 120px; max-height: 120px; line-height: 20px;"></div>
										<div>
											<span class="btn btn-file"><i class="icon-picture"></i><span class="fileupload-new">选择图片</span><span class="fileupload-exists">重新选择</span><input type="file" data-msg-required="请选择图片" name='gicon' /></span>
										</div>
									</div>
									<span class="help-inline" style="color: red" >图片最佳尺寸：400*290</span>
									<input type="hidden" name="old_gicon" value="<!--{{ data.gicon }}-->">
								</div>
							</div>
						</div>
					</div>
					
			        <div class="control-group">
			            <label class="control-label">游戏介绍</label>
			            <div class="controls">
			                <textarea id="gdesc" name="gdesc" style="width:544px;height:200px;"><!--{{ data.gdesc }}--></textarea>
			            </div>
			        </div>
			        
			        <div class="control-group">
			            <label class="control-label">活动规则</label>
			            <div class="controls">
			            	<script id="regulation" name="regulation" type="text/plain"><!--{{ data.regulation }}--></script>
			                
			            </div>
			        </div>
			        
                    <div class="row-fluid">
                        <div class="span3">
                            <div class="control-group">
                                <label class="control-label">平台</label>
                                <div class="controls">
                                    <!--{{form_radio('platform','ios',data.platform=='ios')}}-->IOS
                                </div>
                            </div>
                        </div>
                        <div class="span3">
                            <div class="control-group">
                                <div class="controls">
                                    <!--{{form_radio('platform','android',data.platform=='android')}}-->安卓
                                </div>
                            </div>
                        </div>
                    </div>

					<div class="control-group">
						<label class="control-label">每日抽奖次数</label>
						<div class="controls">
							<input type="text" name="limitNum" id="limitNum" 
							       class="input-large" value="<!--{{ data.limitNum }}-->"/>
						</div>
					</div>
					
					<div class="control-group">
						<label class="control-label">抽奖花费</label>
						<div class="controls">
							<input type="text" name="cost" id="cost" 
							       class="input-large" value="<!--{{ data.cost }}-->"/>
						</div>
					</div>


                    <div class="control-group">
                        <label class="control-label">分享标题</label>
                        <div class="controls">
                            <input type="text" name="sharetitle" value="<!--{{ data.sharetitle }}-->" class="input-large"/>
                            <span class="add-on">分享标题不要超过15个汉字</span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label">分享描述</label>
                        <div class="controls">
                            <textarea name="sharecontent" class="input-large"><!--{{ data.sharecontent }}--></textarea>
                            <span class="add-on"></span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label">分享图片</label>
                        <div class="controls">
                            <div data-provides="fileupload" class="fileupload fileupload-new">
                                <div style="max-width: 160px; max-height: 60px;" class="fileupload-new thumbnail">
                                    <img src="<!--{{ data.shareicon }}-->">
                                </div>
                                <div style="max-width: 160px; max-height: 60px; line-height: 20px;" class="fileupload-preview fileupload-exists thumbnail"></div>
                                <span class="btn btn-file"><i class="icon-picture"></i>
                                    <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span>
                                    <input type="file" name="shareicon" >
                                </span>
                                <a data-dismiss="fileupload" class="btn fileupload-exists" href="#">Remove</a>
                                <span class="text-info">图片最佳尺寸375x140（<span class="text-error">不上传即为左边默认图</span>）</span>
                                <input type="hidden" name="old_shareicon" value="<!--{{ data.shareicon }}-->">
                            </div>
                        </div>
                    </div>
                    
                    
                    <input type="hidden" name="id" value="<!--{{ data.id }}-->">
                    <input type="hidden" name="location" value="<!--{{ data.location }}-->">
					<div class="form-actions">
						<button type="submit" class="btn btn-primary"><i class="icon-ok"></i>保存</button>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>
<!--{%endblock%}-->
<!--{%block footer_js%}-->
<script src="/static/js/jquery.uniform.min.js"></script>
<script src="<!--{{asset('/static/js/xheditor/xheditor-1.1.14-zh-cn.min.js')}}-->"></script>
<script src="/static/js/jquery.validationEngine.js"></script>
<script src="/static/js/jquery.validationEngine-en.js"></script>
<script src="<!--{{asset('/static/js/ueditor/ueditorbbs.config.js')}}-->"></script>
<script src="<!--{{asset('/static/js/ueditor/ueditor.all.js')}}-->"></script>
<script src="/static/js/ajaxfileupload.js"></script>
<script src="/static/js/laydate/laydate.js"></script>
<link rel="stylesheet" href="/static/css/plugins/tagsinput/jquery.tagsinput.css">
<script src="<!--{{asset('/static/js/plugins/tagsinput/jquery.tagsinput.min.js')}}-->"></script>
<script src="<!--{{asset('/static/js/plugins/jquery-ui/jquery-ui-1.9.2.custom.min.js')}}-->"></script>
<script>
	var set_selected_game=function(game_id,game_name,icon){
		$('#selected_game_id').val(game_id);
		$('#selected_game_name').val(game_name);
		$('#selected_game_icon').val(icon);
	};

    $("span.select-pop-close").on('click',function(){
        $("#selected_labelId,#selected_label_name").val('');
    });

	$(function(){
		UE.getEditor('regulation');

		$('.select-pop-game').bind('click',function(){
			$.ajax({
				url:'/game/api/game-search',
				dataType:'json',
				success:function(json){
					var html = json.html;
					$.dialog({id:'pop-game-list',title:'提示',padding:2,content:html,width:600,height:580});
				}
			});
		});

		//关联验证
		jQuery("#form-product").validationEngine({'custom_error_messages':{
			"minCheckbox":{
				'message':'<span style="left:240px;top:25px;color:#b94a48; position: absolute;width: 200px;">请至少选择一个规则</span>'
			},
			"#single-limit":{
				"condRequired": {'message':'<span style="color:#b94a48;left:220px;top:-20px;position:relative;width:100px;">请填写购买总数</span>'}
			},
			"#file_upload":{
				"condRequired": {'message':'<span style="color:#b94a48;position:absolute;width:100px;">请选择卡密文件</span>'}
			},
			"#tb-url":{
				"condRequired":{'message':'<span style="color: #b94a48;position:absolute;left:48px;width:100px;">请填写淘宝URL</span>'}
			},
			".daily-limit-1":{
				"condRequired": {'message':'<span style="color:#b94a48;left:240px;top:-20px;position:relative;width:100px;">请填写限制项</span>'}
			},
			".daily-limit-2":{
				"condRequired": {'message':'<span style="color:#b94a48;left:200px;top:-25px;position:relative;width:100px;">请填写限制项</span>'}
			},
			"#dis-price":{

				"condRequired": {'message':'<span style="color:#b94a48;position:absolute;left:50px;top:6px;width:120px;">请输入折扣</span>'}
			}
		}});

        $(".clear_game").click(function(){
            $("#selected_game_id").val('');
            $("#selected_game_name").val('');
        })

	});

</script>
<!--{%endblock%}-->