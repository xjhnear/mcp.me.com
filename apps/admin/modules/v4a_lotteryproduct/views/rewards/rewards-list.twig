<!--{%extends "../sub-layout-giftbag.twig"%}-->
<!--{%block main_content%}-->
<div class="row-fluid">
    <div class="span12">
        <div class="box box-color box-bordered">
            <div class="box-title">
                <h3>
                    <i class="icon-table"></i>
                    实物奖励管理
                </h3>
                <div class="actions">
                    <form action="<!--{{url('v4alotteryproduct/rewards/delivery-all')}}-->" id="all" name="all_form" ></form>
                    <form action="<!--{{url('v4alotteryproduct/rewards/list')}}-->">
                        <table class="table-filter">
                            <tr>
                                <td>
                                    <input id="" class="input-small"  type="text" value="<!--{{inputinfo.biller}}-->" placeholder="下单人" name="biller">
                                </td>
                                <td>
                                    <!--{{form_select('orderDesc',{'task_consume':'任务','wheel_consume':'大转盘'},'',{'class':'input-medium','id':'orderDesc','style':'margin-bottom:0px;'})}}-->
                                </td>

                                <td>
                                    <div class="input-append date datepick" id="dpStart">
                                        <input name="billTimeBegin" placeholder="下单时间起始" type="text" class="input-small" value="<!--{{inputinfo.billTimeBegin}}-->" readonly>
                                        <span class="add-on"><i class="icon-calendar"></i></span>
                                    </div>
                                </td>
                                <td>
                                    <div class="input-append date datepick" id="dpEnd" data-date="">
                                        <input name="billTimeEnd"  placeholder="下单时间末尾" type="text" class="input-small" value="<!--{{inputinfo.billTimeEnd}}-->" readonly>
                                        <span class="add-on"><i class="icon-calendar"></i></span>
                                    </div>
                                </td>
                                <td><button class="btn btn-teal"><i class="icon-search"></i>搜索</button></td>

                                <td><a href="javascript:;"id="piliang_fahuo" class="btn btn-teal">批量发货</button></td>
                            </tr>
                        </table>
                    </form>
                </div>
            </div>
            <div class="box-content nopadding">
                <table class="table table-hover table-nomargin">
                    <thead>
                        <tr>
                            <th class="col-10"><input type="checkbox" name="chk_all" id="chk_all" ></th>
                            <th class="col-100">下单人</th>
                            <th class="col-100">奖励内容</th>
                            <th class="col-60">中奖渠道</th>
                            <th class="col-100">中奖时间</th>
                            <th class="col-80">操作</th>

                        </tr>
                    </thead>
                    <tbody>
                    <!--{% for key,item in datalist%}-->
                    <tr id="tr_<!--{{item.orderId}}-->">
                        <td><input type="checkbox" class="c_all" data-key="<!--{{key}}-->"name="chk_list" data-id="<!--{{item.orderId}}-->" value="" data-value="<!--{% if item.orderId and item.orderSmsInfo and item.biller  %}--><!--{{item.orderId}}-->-<!--{{item.biller}}-->-<!--{{item.orderSmsInfo}}-->-<!--{{item.orderSmsInfo}}--><!--{%endif%}-->" ></td>
                        <td>
                            <span class="label label-success"><!--{{item.biller}}--></span><br/>
                            <span class="label label-primary"><!--{{userinfo[item.biller].nickname}}--></span><br/>
                            <span class="label label-warning"><!--{{userinfo[item.biller].mobile}}--></span></td>

                        </td>
                        <td><!--{{item.orderSmsInfo}}--></td>
                        <td><!--{{item.orderDesc=='wheel_consume'?'大转盘':'任务'}}--></td>
                        <td><!--{{item.billTimeStr|date('y-m-d H:i')}}--></td>
                        <td >
                            <a  href="javascript:;" data-id="<!--{{item.orderId}}-->" data-href="<!--{{url('v4alotteryproduct/rewards/delivery',{id:item.orderId})}}-->" class="btn btn-primary btn-fahuo">确定发货</a>
                            <!--{% if item.address%}-->
                            <a href="javascript:;" data-info='<!--{{item.address}}-->' class="btn btn-primary select">查看信息</a>
                            <!--{% endif %}-->
                        </td>
                    </tr>
                    <!--{%endfor%}-->
                    </tbody>
                </table>
                <div class="pagelink">
                    <!--{{pagelinks}}-->
                </div>
            </div>
        </div>
    </div>
</div>


<!-- 模态框（Modal） -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog"
     aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close"
                        data-dismiss="modal" aria-hidden="true">
                    &times;
                </button>
                <h4 class="modal-title" id="myModalLabel">
                    表单信息
                </h4>
            </div>
            <div class="modal-body">
                <div class="box-content">
                    <table class="table"  id="table_from">
                    </table>
                </div>
            </div>
            <div id="modal-footer" class="modal-footer">
                <button type="button" class="btn btn-default"
                        data-dismiss="modal">关闭
                </button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal -->
    <!--{%endblock%}-->

    <!--{%block footer_js%}-->
    <script>
        $(function(){

            $("a.btn-fahuo").bind('click',function(){
                var url=$(this).attr('data-href'),id=$(this).attr("data-id");
                alertify.confirm('确认发货？',function(e){
                    if(e){
                        $.get(url,{},function(data){
                            if(data.errorCode==1){
                                alertify.success('操作成功');
                                $("#tr_"+id).remove();

                                return true;
                            }else{
                                alertify.error('操作失败=>'+data.errortxt);
                                return false;
                            }

                        },'JSON');
                    }else{
                        return false;
                    }
                })

            });


            $("#chk_all").click(function(){
                var arrayObj = new Array();
                if($(this).attr("checked") == 'checked'){
                    $("input[name='chk_list']").each(function(i,item){
                        $(this).attr("checked",true);
                        var v=$(this).attr('data-value'),id=$(this).attr('data-id');
                        arrayObj[i]="";
                        if(id){
                            arrayObj[i]="<input type='hidden' id='all_"+id+"' name='all_"+i+"' value='"+v+"''>";
                        }
                    });
                    $("#all").html(arrayObj.join(''));
                }else{
                    $("input[name='chk_list']").each(function(){
                        $(this).attr("checked",false);
                    });
                    $("#all").html("");
                }
            });
            $("input.c_all").bind("click",function(){
                var this_=$(this),id=this_.attr('data-id'),key=this_.attr('data-key');
                if(this_.attr("checked") == 'checked'){
                    var v=this_.attr('data-value'),
                        html="<input type='hidden' id='all_"+id+"' name='all_"+key+"' value='"+v+"'>";
                    $("#all").append(html);
                }else{
                    $("#all_"+id).remove();
                }
            });
            $("#piliang_fahuo").bind('click',function(){
                if($("#all input[type=hidden]").length < 1){
                    alert("抱歉，请先选择数据");
                    return false;
                }
                $("#all").submit();
            });
        });
        $('a.select').bind('click',function(){
            $("#myModal").modal("show");
            var data=$(this).attr('data-info'),
                    data=jQuery.parseJSON(data),
                    html='<body>';
            $.each(data,function(idx,item){
                html+="<tr><td>"+idx+":</td><td>"+item+"</td></tr>";
            });
            html+='</body>';
            $("#table_from").html(html);
        });

    </script>
    <!--{%endblock%}-->