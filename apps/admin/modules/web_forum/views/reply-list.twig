<!--{%extends "sub-layout-forum.twig"%}-->
<!--{%block header_css%}-->
<style>
	.topic-img img{  float: left;margin-left: 5px;   }
</style>
<!--{%endblock%}-->
<!--{%block main_content%}-->
<div class="row-fluid">
	<div class="span12">
	    <div class="box box-color box-bordered">
			<div class="box-title">
				<h3>
					<i class="icon-table"></i>
					回复列表
                    <a class="btn-primary badge badge-info b_button" data-toggle="modal" data-target="#exampleModal" >原帖详情</a>
					<span class="badge badge-success"><!--{{ topic.subject }}--></span><span class="badge badge-default"><!--{{ uinfo.nickname }}--></span>
					<span style="font-size: 14px;">一级回复数：</span><span class="badge badge-warning"><!--{{total_count}}--></span>
					<span style="font-size: 14px;">一、二级回复总数：</span><span class="badge badge-warning"><!--{{ all_total_count }}--></span>
				</h3>
			</div>
			<div class="box-title">
				<div class="actions">
					<form action="<!--{{url('web_forum/topic/reply-list',{'tid':topic.tid,'recycle':recycle})}}-->">
					<table class="table-filter">
						<tr>
                            <!--
							<td><input type="text" name="keyword" class="input-small" placeholder="关键字" value="<!--{{search.keyword}}-->"/></td>
							<td><input type="text" name="floor" class="input-small" placeholder="间隔楼层数" value="<!--{{search.floor}}-->"/></td>
							<td><span class="label label-blue"><!--{{form_checkbox('hasPic','true',search.hasPic=='true')}}-->筛选搜索带图回复</span></td>
                            -->
                            <td>
                                <select  id="sel_filter"  class="form-control">
                                    <option value="0">选择筛选条件</option>
                                    <option value="keyword">关键字:</option>
                                    <option value="floor">间隔楼层数:</option>
                                    <option value="hasPic">筛选搜索带图回复√</option>
                                </select>

                            </td>
                            <td><input type="text" id="inp_hide" name="" class="input-small"  style="display: none; margin-bottom: 10px;" /></td>
							<td><span class="label label-blue"><!--{{form_checkbox('addUser','false',search.addUser=='true')}}-->将回复人添加到列表</span></td>
							<td><button class="btn btn-teal" title="搜索">搜索<i class="icon-search"></i></button></td>
						<!--{% if recycle %}-->
							<td><a class="btn btn-teal" href="<!--{{ url('web_forum/topic/reply-list',{'tid':tid}) }}-->">有效列表</a></td>
						<!--{% else %}-->
							<td><a class="btn btn-teal" href="<!--{{ url('web_forum/topic/reply-list',{'tid':tid,'recycle':1}) }}-->">回收站</a></td>
						<!--{% endif %}-->
							<td><a class="btn btn-teal" href="<!--{{ url('web_forum/topic/reply-add',{'tid':tid}) }}-->">添加回复</a></td>
						</tr>
					</table>
					</form>
				</div>
			</div>
			<div class="box-content nopadding">
			    <table class="table table-hover table-nomargin">
			        <thead>
						<tr>
						    <th class="col-20">
						        <input type="checkbox" name="all" value="" /><div class="btn-group">
							        <a data-toggle="dropdown" class="btn dropdown-toggle"><span class="caret"></span></a>
                                    <!--
							        <ul class="dropdown-menu">
							            <li><a href="javascript:void(0);" data-act="del" class="ajax-del">删除</a></li>
							        </ul>
							        -->
							    </div>
							</th>
							<th class="col-10">楼层</th>
							<th class="col-150">回复内容</th>
							<th class="col-100">二级回复</th>
							<th class="col-80">回复人</th>
							<th class="col-60">回复时间</th>
							<th class="col-60">操作</th>
						</tr>
					</thead>
					<tbody>
					    <!--{%for item in reply_list%}-->
						<tr>
						    <td><input type="checkbox" name="ids" value="<!--{{item.rid}}-->" /></td>
							<td title="<!--{{item.rid}}-->"><!--{{item.floor}}--></td>
							<td class="user-avatar"><a href="#bigimg" data-toggle="modal"><!--{{item.content}}--></a></td>
							<td><a href="<!--{{url('web_forum/topic/comment-list',{'rid':item.rid})}}-->" target="_blank">查看二级回复(<!--{{item.rid_children_num}}-->)</a></td>
							<td>
								<span class="badge badge-info"><!--{{item.uid}}--></span><br/>
								<a href="<!--{{url('v4user/users/edit',{'id':item.uid})}}-->" target="_blank"><!--{{ item.rname }}--></a>
							</td>
							<td><!--{{item.add_time}}--></td>
							<td>
								<!--{% if item.comments %}-->
								<div class="btn-group">
							        <a data-toggle="dropdown" class="btn  btn-primary dropdown-toggle"><span class="caret"></span></a>
							        <ul class="dropdown-menu dropdown-primary">
								        <li><a href="<!--{{ url('web_forum/topic/comment-list',{'rid':item.rid}) }}-->">查看评论</a></li>
							        </ul>
							    </div>
								<!--{% endif %}-->
								<!--{%if item.is_active %}-->
                                <a href="<!--{{url('web_forum/topic/reply-add')}}-->?id=<!--{{ item.rid }}-->&tid=<!--{{ tid }}-->" class="btn btn-primary">编辑</a>
                                <a href="<!--{{url('web_forum/topic/del-reply',{'rid':item.rid,'uid':item.uid})}}-->?content=<!--{{item.fid}}-->,<!--{{item.tid}}-->&uid=<!--{{item.uid}}-->&title=<!--{{item.subject}}-->&type=5&linkType=1&subject=<!--{{ topic.subject }}-->" class="btn btn-primary ajax-del">删除</a>
								<!--{%else%}-->
								<a href="<!--{{url('web_forum/topic/res-reply',{'rid':item.rid,'uid':item.uid})}}-->" class="btn btn-primary">恢复</a>
								<!--{%endif%}-->
                                <a href="<!--{{url('web_forum/topic/reply-add')}}-->?id=<!--{{ item.rid }}-->&uid=<!--{{ item.uid }}-->&tid=<!--{{ tid }}-->" class="btn btn-primary">回复</a>
							</td>
						</tr>
						<!--{%endfor%}-->
					</tbody>
			    </table>
			    <div class="pagelink">
			        <!--{{paginator}}-->
			    </div>
			</div>
		</div>
	</div>
</div>
<!--{#模态框#}-->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="exampleModalLabel"><!--{{topic.subject}}--></h4>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label for="recipient-name" class="control-label" >原帖标题:</label>
                        <input type="text" class="form-control" readonly value="<!--{{topic.subject}}-->">
                    </div>
                    <div class="form-group">
                        <label for="recipient-name" class="control-label">发帖人:</label>
                        <input type="text" class="form-control" readonly value="<!--{{ uinfo.nickname }}-->" >
                    </div>
                    <div class="form-group">
                        <label for="recipient-name" class="control-label">发帖时间:</label>
                        <input type="text" class="form-control" readonly value="<!--{{ topic.createTime }}-->" >
                    </div>
                    <div class="form-group">
                        <label for="message-text" name=""  class="control-label">内容:</label>

                        <!--{{topic.formatContent}}-->
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<!--{%endblock%}-->
<!--{%block footer_js%}-->
<script>
$(function(){
	$('input').iCheck({
		checkboxClass: 'icheckbox_square-orange',
		radioClass: 'iradio_square-orange',
		increaseArea: '20%' // optional
	});
    $('a.ajax-del').bind('click',function(){
        if(!confirm('确定要删除数据吗？')){
            return false;
        }
        
        if($(this).attr('data-act')=='del'){
            var ids = [];
            $('input[name="ids"]:checked').each(function(){
                ids.push($(this).val());
            });
            if(ids.length==0) return false;
            $.ajax({
                url:'<!--{{url('comment/comments/del')}}-->',
                type:'POST',
                data:{'ids':ids},
                dataType:'json',
                success:function(data){
                    if(data.status==200){
                    //    window.location.href = window.location.href;
                    }else{

                    }
                }
            });
        }
    });

	$('input[name="all"]').on('ifChecked',function(event){
		$('input[name="ids"]').iCheck('check');
	});

	$('input[name="all"]').on('ifUnchecked',function(event){
		$('input[name="ids"]').iCheck('uncheck');
	});
    $("#sel_filter").change(function(){
        var val = $(this).val();

        if(val){
            if(val=="keyword"){
                $("#inp_hide").show().attr("name","keyword").val("");
            }else if(val=="floor"){
                $("#inp_hide").show().attr("name","floor").val("");
            }else if(val=="hasPic"){
                $("#inp_hide").hide().attr("name","hasPic").val("true");
            }else{
                $("#inp_hide").hide().attr("name","").val("");
            }
        }else{
            $("#inp_hide").hide().attr("name","").val("");
        }
    })
    $("option[value='<!--{{search.key}}-->']").attr("selected","selected");
    $("#inp_hide").attr("name","<!--{{search.key}}-->").val("<!--{{search.val}}-->");
    if($("#inp_hide").attr("name")=="hasPic"||$("#inp_hide").attr("name")==""){
        $("#inp_hide").hide();
    }else{
        $("#inp_hide").show();
    }
});
</script>
<!--{%endblock%}-->    