<!--{%extends "sub-layout-lottery.twig"%}-->
<!--{%block main_content%}-->
<div class="row-fluid">
	<div class="span12">
		<div class="box">
			<div class="box-title">
				<h3><i class="icon-edit"></i>添加抽奖</h3>
			</div>
			<div class="box-content">
				<form id="gift-info-form" action="<!--{{url('/lottery/inscharge/lottery-add')}}-->" method="POST" class='form-horizontal form-validate' enctype="multipart/form-data">
					<div class="control-group">
						<label for="act-sort" class="control-label">抽奖名称</label>
						<div class="controls">
							<input id="act-sort" name="title" class="input" type="text" data-rule-required="true" data-msg-required="请填写抽奖名称"/>
						</div>
					</div>
					<div class="control-group">
						<label class="control-label">抽奖类型</label>
						<div class="controls">
							<label class="radio inline">
								<input id="any-time" type="radio" name="type" value="1" checked>随时&nbsp;
							</label>
							<label class="radio inline">
								<input id="one-time" type="radio" name="type" value="2">定时
							</label>
						</div>
					</div>
					<div class="row-fluid anytime" style="display: none;">
						<div class="span4">
							<div class="control-group">
								<label class="control-label">限制次数</label>
								<div class="controls">
									<input type="text" id="join-times" class="input-small validate[condRequired[any-time]]" name="join_times">
									<span class="add-on text-warning">同一账号最多抽奖次数（一般设为一次）</span>
								</div>
							</div>
						</div>
					</div>
					<div class="row-fluid onetime" style="display: none;">
						<div class="span4">
							<label class="control-label">发奖方式</label>
							<div class="control-group">
								<div class="controls">
									<label class="radio inline">
										<input type="radio" name="prize_way" value="1" checked>自动发送
									</label>
									<label class="radio inline">
										<input type="radio" name="prize_way" value="2">手动发送
									</label>
								</div>
							</div>
						</div>
						<div  class="span4 send-time" style="display: none;">
							<div class="control-group">
								<label class="control-label">发送时间</label>
								<div class="controls">
									<div class="input-append date">
										<input name="send_time" type="text" class="input-medium datetimepicker" value="<!--{{gift.starttime|date('Y-m-d H:i')}}-->" readonly="">
										<span class="add-on"><i class="icon-calendar"></i></span>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="row-fluid onetime" style="display: none;">
						<div class="span4">
							<div class="control-group">
								<label class="control-label">获奖人数</label>
								<div class="controls">
									<input type="text" id="winner-num" data-rule-digits="true" data-msg-digits="请填写整数" class="input-small validate[condRequired[one-time]]" name="winner_num">
									<span class="add-on text-warning">（随机抽出此人数来获奖）</span>
								</div>
							</div>
						</div>
					</div>
					<div id="exclusive" class="row-fluid">
						<div class="span3">
							<div class="control-group">
								<label class="control-label">需要游币</label>
								<div class="controls">
									<input id="need-coin" name="need_coin" data-on-color="success" data-on-text="需要" data-off-color="danger" data-off-text="无" class="switchbox" type="checkbox"/>
								</div>
							</div>
						</div>
						<div class="span3 coin-num" style="display: none;">
							<div class="control-group">
								<label class="control-label">游币数</label>
								<div class="controls">
									<input id="coin-num" name="coin_num" data-rule-digits="true" data-msg-digits="请填写整数" class="input-small validate[condRequired[need-coin]]" type="text"/>
								</div>
							</div>
						</div>
					</div>
					<div class="control-group">
						<label class="control-label" for="on-or-off">是否开启</label>
						<div class="controls">
							<input name="valid" data-on-color="success" data-on-text="开启" data-off-color="danger" data-off-text="关闭" class="switchbox" type="checkbox" checked/>
						</div>
					</div>
					<div class="form-actions">
						<button type="submit" class="btn btn-primary"><i class="icon-ok"></i>保存</button>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>
<!--{%endblock%}-->
<!--{%block footer_js%}-->
<script src="/static/js/jquery.validationEngine.js"></script>
<script src="/static/js/jquery.validationEngine-en.js"></script>
<script>
	$(function(){
		$('input').iCheck({
			checkboxClass: 'icheckbox_square-orange',
			radioClass: 'iradio_square-orange',
			increaseArea: '20%' // optional
		});
		$('.switchbox').bootstrapSwitch();
		$('input.datetimepicker').datetimepicker({format:'Y-m-d H:i',lang:'ch'});
		$('#need-coin').on('switchChange.bootstrapSwitch', function (e, data) {
			if(data){
				$(".coin-num").fadeIn();
			}else{
				$(".coin-num").fadeOut();
			}
		});

		//初始化显示
		if($("input[name='need_coin']").attr('checked')) $(".coin-num").show();
		var cj_type = $("input[name='type']:checked").val();
		var fj_type = $("input[name='prize_way']:checked").val();
		if(cj_type == 1){
			$('.anytime').show();
			$('.onetime').hide();
		}else{
			$('.onetime').show();
			$('.anytime').hide();
		}
		if(fj_type == 1){
			$('.send-time').show();
		}else{
			$('.send-time').hide();
		}

		$("input[name='type']").on('ifChecked',function(){
			if($("input[name='type']:checked").val() == 1){
				//随时
				$('.anytime').fadeIn();
				$('.onetime').fadeOut();
			}else{
				//定时
				$('.anytime').fadeOut();
				$('.onetime').fadeIn();
				if($("input[name='prize_way']:checked").val() == 1){
					//自动
					$('.send-time').fadeIn();
				}else{
					//手动
					$('.send-time').fadeOut();
				}
			}
		});

		$("input[name='prize_way']").on('ifChecked',function(){
			if($("input[name='prize_way']:checked").val() == 1){
				//自动
				$('.send-time').fadeIn();
			}else{
				//手动
				$('.send-time').fadeOut();
			}
		});

		//关联验证
		jQuery("#gift-info-form").validationEngine({'custom_error_messages':{
			"#join-times":{
				"condRequired": {'message':'<span style="left:225px;position: absolute;width: 100px;">请填写限制次数</span>'}
			},
			"#winner-num":{
				"condRequired": {'message':'<span style="left:145px;position: absolute;width: 100px;">请填写获奖人数</span>'}
			},
			"#coin-num":{
				"condRequired": {'message':'<span style="position: absolute;width: 100px;">请填写游币数</span>'}
			}
		}});
	});
</script>
<!--{%endblock%}-->
