<!--{%extends "sub-layout-lottery.twig"%}-->
<!--{%block main_content%}-->
<div class="row-fluid">
	<div class="span12">
		<div class="box box-color box-bordered">
			<div class="box-title">
				<h3>
					<i class="icon-table"></i>
					抽奖活动列表
				</h3>
				<div class="actions">
					<form action="<!--{{url('lottery/inscharge/lottery-search')}}-->">
						<table class="table-filter">
						<tbody>
						<tr>
							<td>
								<div class="input-append date datepick" id="dpStart">
									<input name="starttime" type="text" class="input-small" value="<!--{{search.starttime}}-->" readonly>
									<span class="add-on"><i class="icon-calendar"></i></span>
								</div>
							</td>
							<td>
								<div class="input-append date datepick" id="dpEnd">
									<input name="endtime" type="text" class="input-small" value="<!--{{search.endtime}}-->" readonly>
									<span class="add-on"><i class="icon-calendar"></i></span>
								</div>
							</td>
							<td><input type="text" name="title" id="" class="input-small" placeholder="活动名" value="<!--{{search.title}}-->"/></td>
							<td><button class="btn btn-teal"><i class="icon-search"></i>搜索</button></td>
							<td><a class="btn btn-teal" href="/lottery/inscharge/lottery-add">添加</a></td>
						</tr>
						</tbody></table>
					</form>
				</div>
			</div>
			<div class="box-content nopadding">
				<table class="table table-hover table-nomargin">
					<thead>
					<tr>
						<th class="col-50">
							<input type="checkbox" value="" name="all">
							<div class="btn-group">
								<a class="btn dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></a>
								<ul class="dropdown-menu">
									<li><a class="ajax-del" data-act="del" href="javascript:void(0);">删除</a></li>
								</ul>
							</div>
						</th>
						<th class="col-40">ID</th>
						<th class="col-150">名称</th>
						<th class="col-60">类型</th>
						<th class="col">奖项（<span class="badge badge-muted">奖项名</span><span class="badge badge-success">概率</span><span class="badge badge-info">奖项个数</span>）</th>
						<th class="col-120">开始时间</th>
						<th class="col-120">结束时间</th>
						<th class="col-60">是否开启</th>
						<th class="col-100 table-btn-group">操作</th>
					</tr>
					</thead>
					<tbody>
					<!--{% for item in activities %}-->
					<tr>
						<td><input name="ids" type="checkbox" value="<!--{{ item.lottery_id }}-->"></td>
						<td><!--{{item.lottery_id}}--></td>
						<td><!--{{ item.title }}--></td>
						<td><!--{% if item.lot_type == 1 %}--><span class="badge badge-info">随时</span><!--{% else %}--><span class="badge badge-warning">定时</span><!--{% endif %}--></td>
						<td>
						<!--{% if item.prize_info %}-->
							<!--{% for row in item.prize_info %}-->
								<span class="badge badge-muted"><!--{{ row.title }}--></span>
								<span class="badge badge-success"><!--{% if item.lot_type == 1 %}--><!--{{ row.probab }}-->%<!--{% else %}-->--<!--{% endif %}--></span>
								<span class="badge badge-info"><!--{{ row.number }}--></span> |
							<!--{% endfor %}-->
						<!--{% endif %}-->
							<span style="color: red;"><a href="<!--{{ url('lottery/inscharge/prize-add',item.lottery_id) }}-->">设置</a></span>
						</td>
						<td><!--{{ item.start_time|date('Y-m-d H:i') }}--></td>
						<td><!--{{ item.end_time|date('Y-m-d H:i') }}--></td>
						<td><!--{% if item.valid == 1 %}--><span class="badge badge-success">开启</span><!--{% else %}--><span class="badge badge-error">关闭</span><!--{% endif %}--></td>
						<td>
							<a href="<!--{{url('/lottery/inscharge/lottery-edit',item.lottery_id)}}-->" class="btn btn-primary">编辑</a>
							<a href="javascript:void(0);" data-act="del" data="<!--{{ item.lottery_id }}-->" class="btn btn-primary ajax-del">删除</a>
						</td>
					</tr>
					<!--{%endfor%}-->
					</tbody>
				</table>
				<div class="pagelink">
					<!--{{ pagination }}-->
				</div>
			</div>
		</div>
	</div>
</div>
<!--{%endblock%}-->
<!--{%block footer_js%}-->
<script>
	$(function(){
		$('a.ajax-del').bind('click',function(){
			if(!confirm('确定要删除数据吗？')){
				return false;
			}
			if($(this).attr('data-act')=='del'){
				var ids = [];
				$('input[name="ids"]:checked').each(function(){
					ids.push($(this).val());
				});
				if(ids.length==0) return false;
				$.get('<!--{{url('/lottery/inscharge/lottery-del')}}-->',{'ids':ids},function(resp){
					if(resp.state){
						alertify.success(resp.msg);
						setTimeout(function(){
							location.reload();
						},2000);
					}else{
						alertify.error(resp.msg);
					}
				},'json');
			}
		});


		$('input[name="all"]').bind('click',function(){
			if($(this).prop('checked')==true){
				$('input[name="ids"]').prop('checked',true);
			}else{
				$('input[name="ids"]').prop('checked',false);
			}
		});
	});
</script>
<!--{%endblock%}-->