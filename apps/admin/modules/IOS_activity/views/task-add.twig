<!--{%extends "base-layout.twig"%}-->
<!--{%block main_content%}-->
<link href="/static/css/app.css" rel="stylesheet" type="text/css"/>
<div class="row-fluid">
    <div class="span12">
		<div class="box">
            <div class="box-title">
                <h3>任务信息</h3>
            </div>



			<div class="box-content">
			    <form id="activity-task" action="<!--{{url('IOS_activity/task/task-add')}}-->" method="POST" class='form-horizontal form-validate' enctype="multipart/form-data">
                <div class="control-group">
                        <div class="control-group">
                            <label class="control-label">审核类型</label>
                            <div class="controls auditType">
                                <!--{{form_radio('auditType',1,auditType!=2)}}-->常规审核
                                <!--{{form_radio('auditType',2,auditType==2)}}-->idfa回调
                            </div>
                        </div>
                </div>
                <div class="control-group">
                        <div class="control-group">
                            <label class="control-label">活动展示类型</label>
                            <div class="controls taskType">
                                <!--{{form_radio('selTaskType',0,selType==0)}}-->普通任务
                                <!--{{form_radio('selTaskType',1,selType==1)}}-->子任务+
                                <!--{{form_radio('selTaskType',2,selType==2)}}-->连续任务
                            </div>
                        </div>
                </div>
                
                <div class="control-group accessType">
                        <div class="control-group">
                            <label class="control-label">使用用途 	</label>
                            <div class="controls">
                            	<!--{{form_radio('accessType',0,accessType==0)}}-->一般用途
                                <!--{{form_radio('accessType',1,accessType==1)}}-->充值用途
                                <!--{{form_radio('accessType',2,accessType==2)}}-->道具/物品用途
                            </div>
                        </div>
                </div>
                
                <!--{%if not atask.taskId%}-->
                <div class="control-group">
                    <label class="control-label">自分享任务</label>
                    <div class="controls">
                        <input type="checkbox" name="share" class="checkbox" />
                        	是
                    </div>
                </div>
                
                <div class="control-group shareType">
                        <div class="control-group">
                            <label class="control-label">可见类型 	</label>
                            <div class="controls">
                            	<!--{{form_radio('shareTypeList',0,shareType==0)}}-->全部可见
                                <!--{{form_radio('shareTypeList',1,shareType==1)}}-->自然用户可见
                                <!--{{form_radio('shareTypeList',2,shareType==2)}}-->自分享用户可见
                            </div>
                        </div>
                </div>
                
                <!--<div class="control-group">
                    <label class="control-label">自然注册用户使用</label>
                    <div class="controls">
                        <input type="checkbox" name="natural_create" class="checkbox" />
                        	是
                    </div>
                </div>-->
                
                <!--{%endif%}-->
                <div class="control-group task_children_all" style="border-top: 1px dashed #999;border-bottom: 1px dashed #999;padding-top: 10px;padding-bottom: 10px;">
					<div class="control-group"><label class="control-label" style="width: 200px;">全局子任务:</label></div>
                    <div class="control-group">
                        <label class="control-label">子任务选择</label>
                        <div class="controls">
                            <div style="margin-top: -18px;" class="block__list block__list_words">
                                <ul id="editable" style="border: 1px solid;width: 400px;">
                                    <!--{%for item in task_children%}-->
                                    <li taskid="" starttime="<!--{{item.startTime}}-->" endtime="<!--{{item.endTime}}-->"><!--{{item.taskName}}--> <i class="js-remove" style="margin-top: -5px;margin-right: -15px;">✖</i></li>
                                    <!--{%endfor%}-->
                                </ul>
                            </div>
                            <input type="button" id="show_iframe" value="添加子任务" class="select-task-code"/>
                        </div>
                    </div>
                    <div class="control-group">
                        <label for="textfield" class="control-label">公告</label>
                        <div class="controls">
                            <textarea class="form-control" id="textarea1" name="taskDesc" rows="3"><!--{{atask.taskDesc}}--></textarea>
                        </div>
                    </div>
                </div>
                <!--{%if not atask.taskId%}-->
                <div class="control-group task_children_share" style="display:none; border-top: 1px dashed #999;border-bottom: 1px dashed #999;padding-top: 10px;padding-bottom: 10px;">
					<div class="control-group"><label class="control-label" style="width: 200px;">自分享子任务:</label></div>
                    <div class="control-group">
                        <label class="control-label">子任务选择</label>
                        <div class="controls">
                            <div style="margin-top: -18px;" class="block__list block__list_words">
                                <ul id="editable2" style="border: 1px solid;width: 400px;">
                                    <!--{%for item in task_children%}-->
                                    <li taskid="" starttime="<!--{{item.startTime}}-->" endtime="<!--{{item.endTime}}-->"><!--{{item.taskName}}--> <i class="js-remove" style="margin-top: -5px;margin-right: -15px;">✖</i></li>
                                    <!--{%endfor%}-->
                                </ul>
                            </div>
                            <input type="button" id="show_iframe" value="添加子任务" class="select-task-code-2"/>
                        </div>
                    </div>
                    <div class="control-group">
                        <label for="textfield" class="control-label">公告</label>
                        <div class="controls">
                            <textarea class="form-control" id="textarea1" name="taskDesc_2" rows="3"><!--{{atask.taskDesc}}--></textarea>
                        </div>
                    </div>
                </div>
                <!--{%endif%}-->
                <div class="control-group">
					<label class="control-label">标题</label>
					<div class="controls">
						<input type="text" name="taskName" class="input-xxlarge" value="<!--{{atask.taskName}}-->" data-rule-required="true" data-msg-required="标题不能为空"  />
					</div>
				</div>
                <div class="control-group">
                    <label class="control-label">简介</label>
                    <div class="controls">
                        <input type="text" name="taskContent" class="input-xxlarge" value="<!--{{atask.taskContent}}-->" data-rule-required="true" data-msg-required="标题不能为空"  />
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label">下载按钮(攻略使用)</label>
                    <div class="controls">
                        <input type="checkbox" name="loaddownload" class="checkbox" <!--{%if atask.isLoadDownload == 1%}-->checked="checked"<!--{%endif%}-->/>
                        	有
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label">*关联游戏</label>
                    <div class="controls">
                        <div class="input-append">
                            <input id="selected_game_id" name="game_id" type="hidden" value="<!--{{atask.gid}}-->"/>
                            <input type="text" readonly id="selected_game_name" name="game_name" class="input-medium" data-rule-required="true" data-msg-required="请选择游戏" value="<!--{{ atask.typeCondition['gameName'] }}-->" />
                            <span class="add-on select-pop-game">选择游戏</span>
                        </div>
                    </div>
                </div>
                <div class="control-group">
                    <label class="control-label">图片</label>
                    <div class="controls">
                        <div data-provides="fileupload" class="fileupload fileupload-new">
                            <div style="max-width: 60px; max-height: 60px;" class="fileupload-new thumbnail">
                                <img id="selected_game_icon" src="<!--{{atask.taskIcon|default('/static/img/wu_ss.gif')}}-->">
                            </div>
                            <div style="max-width: 60px; max-height: 60px; line-height: 20px;" class="fileupload-preview fileupload-exists thumbnail"></div>
                        <span class="btn btn-file"><i class="icon-picture"></i>
                            <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span>
                            <input id="task_img" name="task_img" type="hidden" value="<!--{{atask.taskIcon}}-->"/>
                            <input type="file"  name="task_icon" >
                        </span>
                            <a data-dismiss="fileupload" class="btn fileupload-exists" href="#">Remove</a>
                            <span style="color: rgb(185, 74, 72);" class="img_note" hidden="hidden">图片不能为空且限于png,gif,jpeg,jpg格式</span>
                        </div>
                    </div>
                </div>
                
                <div class="control-group sort">
                    <label class="control-label">排序</label>
                    <div class="controls">
                        <input type="text" name="sort" class="input-small" value="<!--{{atask.sortValue|default('50')}}-->" />
                    </div>
                </div>
                
                <!--
                <div class="control-group linkType">
                    <div class="control-group">
                        <label class="control-label">跳转类型</label>
                        <div class="controls">
                            <!--{{form_radio('selLinkType',0,atask.linkType==0)}}-->内部跳转
                            <!--{{form_radio('selLinkType',1,atask.linkType==1)}}-->帖子
                            <!--{{form_radio('selLinkType',2,atask.linkType==2)}}-->外部跳转
                        </div>
                    </div>
                </div>
                -->

                <div class="control-group limitNumbers">
                    <label class="control-label">限额参与</label>
                    <div class="controls">
                        <div class="span2">
                            <!--{{form_radio('isLimitin',0,isLimitin==0)}}-->否
                            <!--{{form_radio('isLimitin',1,isLimitin==1)}}-->是
                        </div>

                     
	                    <div class="control-group appends">
	                        <div class="controls">
	                        	<label class="control-label">初始名额</label>
	                            <input type="text" name="limitNumbers" class="input-small" value="<!--{{atask.limitNumbers}}-->" />
	                        </div>
	                    </div>
                    
                        
                        <div class="span4">
                            <div class="control-group">
                                <label class="control-label">限定参与时间（h）</label>
                                <div class="controls">
                                    <input type="text" name="limitHours" class="input-small" value="<!--{{atask.limitHours}}-->" />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="control-group limitNumbers">
                    <label class="control-label">定时添加名额</label>
                    <div class="controls">
                        <div class="span2">
                            <!--{{form_radio('autoQuotaOff',0,autoQuotaOff==0)}}-->否
                            <!--{{form_radio('autoQuotaOff',1,autoQuotaOff==1)}}-->是
                        </div>

                     
	                    <div class="control-group appends">
	                        <div class="controls">
	                            从<input name="quotaStartTime" type="text" class="input-small" id="quotaStartTime" value="<!--{{atask.quotaStartTime}}-->" >
                                      <span style="color: rgb(185, 74, 72);" class="img_note">*(0-23)点</span>  
                                     到<input name="quotaEndTime" type="text" class="input-small" id="quotaEndTime" value="<!--{{atask.quotaEndTime}}-->" >
                                      <span style="color: rgb(185, 74, 72);" class="img_note">*(1-24)点</span>
                                        
	                            每 <input type="text" name="intervalTime" data-rule-digits="true" data-rule-min="1" data-msg-min="最小为1"
	                                     id="intervalTime" class="validate[condRequired[append-1]]" data-msg-digits="请填写整数" style="width:30px" value="<!--{{ atask.intervalTime }}-->">
	                            <select name="add_period_type" style="width:80px" >
	                                <option value="hour" <!--{{ giftbag.extraReq.addPeriodType == 'hour' ? 'selected' : '' }}-->>小时</option>
	                            </select>
	                            追加 <input id="add-num-1" name="quotaNumber" class="input-small validate[condRequired[append-1]]" type="text"
	                                      data-rule-digits="true" data-rule-min="1" data-msg-min="最小为1" data-msg-digits="请填写整数"
	                                      value="<!--{{ atask.quotaNumber }}-->">
	                        </div>
	                    </div>

                    </div>
                </div>

                <div class="control-group isRecommend">
                    <label class="control-label">任务推荐到任务中心顶部</label>
                    <div class="controls">
                        <div class="span2">
                            <!--{{form_radio('isRecommend',0,atask.isRecommend==0)}}-->否
                            <!--{{form_radio('isRecommend',1,atask.isRecommend==1)}}-->是
                        </div>
                        <div class="span4" id="pic_isRecommend" style="display:none;">
                            <div class="controls">
                                <div data-provides="fileupload" class="fileupload fileupload-new">
                                    <div style="max-width: 60px; max-height: 60px;" class="fileupload-new thumbnail">
                                        <img id="selected_game_icon" src="<!--{{atask.recommendBackgroundImg|default('/static/img/wu_ss.gif')}}-->">
                                    </div>
                                    <div style="max-width: 60px; max-height: 60px; line-height: 20px;" class="fileupload-preview fileupload-exists thumbnail"></div>
                        <span class="btn btn-file"><i class="icon-picture"></i>
                            <span class="fileupload-new">上传图片</span><span class="fileupload-exists">Change</span>
                            <input id="task_pic" name="task_pic" type="hidden" value="<!--{{atask.recommendBackgroundImg}}-->"/>
                            <input type="file"  name="task_pic" >
                        </span>
                                    <a data-dismiss="fileupload" class="btn fileupload-exists" href="#">Remove</a>
                                    <span style="color: rgb(185, 74, 72);" class="img_note" hidden="hidden">图片不能为空且限于png,gif,jpeg,jpg格式</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="control-group isLimit">
                    <label class="control-label">限制时间内可参与</label>
                    <div class="controls">
                        <div class="span2">
                            <!--{{form_radio('isLimit',0,isLimit==0)}}-->否
                            <!--{{form_radio('isLimit',1,isLimit==1)}}-->是
                        </div>
                        <div class="span4">
                            <div class="control-group">
                                <label class="control-label">限时任务开始时间</label>
                                <div class="controls">
                                    <div class="input-append date">
                                        <input name="limitStartTime" onclick="laydate({istime: true, format: 'YYYY-MM-DD hh:mm:ss'})" type="text" class="input-medium datetimepicker" id="date_timepicker_start" value="<!--{{atask.limitStartTime}}-->" readonly>
                                        <span class="add-on"><i class="icon-calendar"></i></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="span4">
                            <div class="control-group">
                                <label class="control-label">限时任务结束时间</label>
                                <div class="controls">
                                    <div class="input-append date">
                                        <input name="limitEndTime" onclick="laydate({istime: true, format: 'YYYY-MM-DD hh:mm:ss'})" type="text" class="input-medium datetimepicker" id="date_timepicker_start" value="<!--{{atask.limitEndTime}}-->" readonly>
                                        <span class="add-on"><i class="icon-calendar"></i></span>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
             
				<div class="control-group allstep" style="border-top: 1px dashed #999;border-bottom: 1px dashed #999;padding-top: 10px;padding-bottom: 10px;">
					<div class="control-group"><label class="control-label" style="width: 200px;">全局奖励&步骤:</label></div>
	                <div class="control-group prizeDiv">
	                    <label class="control-label">奖励</label>
	                    <div class="controls" style="width: 100%;">
	                        <div class="span4">
		                        <div class="controls" style="margin-left:0px;width:500px">
		                            <!--{{form_radio('selPrizeType',"-1",atask.prizeList.0.prizeType==-1,{'class':"prize_radio"})}}-->无奖励
		                            <!--{{form_radio('selPrizeType',3,atask.prizeList.0.prizeType==3,{'class':"prize_radio"})}}-->钻石
		                            <!--{{form_radio('selPrizeType',1,atask.prizeList.0.prizeType==1,{'class':"prize_radio"})}}-->礼包
		                            <input type="text" name="prizeKey" class="input-small prizeKey" value="<!--{{atask.prizeList.0.prizeKey|default('0')}}-->" />
		                        </div>
	                        </div>
	                        <div class="span4">
								<div class="controls" style="width:300px">
									<label class="control-label">奖励图片<br/>（攻略用）</label>
			                        <div data-provides="fileupload" class="fileupload fileupload-new">
			                            <div style="max-width: 60px; max-height: 60px;" class="fileupload-new thumbnail">
			                                <img id="selected_game_icon" src="<!--{{atask.prizeList.0.prizeIcon|default('/static/img/wu_ss.gif')}}-->">
			                            </div>
			                            <div style="max-width: 60px; max-height: 60px; line-height: 20px;" class="fileupload-preview fileupload-exists thumbnail"></div>
			                        <span class="btn btn-file"><i class="icon-picture"></i>
			                            <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span>
			                            <input id="prizeIcon" name="prizeIcon" type="hidden" value="<!--{{atask.prizeList.0.prizeIcon}}-->"/>
			                            <input type="file"  name="prizeIcon" >
			                        </span>
			                            <a data-dismiss="fileupload" class="btn fileupload-exists" href="#">Remove</a>
			                            <span style="color: rgb(185, 74, 72);" class="img_note" hidden="hidden">图片不能为空且限于png,gif,jpeg,jpg格式</span>
			                        </div>
			                    </div>
	                        </div>
	                    </div>
	                    <div class="controls div_icon" style="display:none;">
	                    	<div class="span4">
	                    		<div class="controls"  id="div_icon_old" style="margin-left:0px;width:600px">
                                    <div class="input-append">
                                    	<!--{%if atask.prizeList.0.prizeKey %}--><input type="hidden" name="card_code_old[2]" value="<!--{{atask.prizeList.0.prizeKey}}-->"/><!--{%endif%}-->
                                        <input class="selected_cardCode" name="card_code[2]" value="<!--{%if atask.prizeList.0.prizeKey %}--><!--{{atask.prizeList.0.prizeKey}}--><!--{%endif%}-->" type="hidden"/>
                                        <input class="selected_card_gid" name="card_gid[2]" value="<!--{%if atask.prizeList.0.gid %}--><!--{{atask.prizeList.0.gid}}--><!--{%endif%}-->" type="hidden"/>
                                        <input name="requestFrom[2]" value="<!--{%if atask.prizeList.0.requestFrom %}--><!--{{atask.prizeList.0.requestFrom}}--><!--{%endif%}-->" type="hidden"/>
                                        <input type="text" readonly class="input-small selected_card_name" name="card_des[2]" value="<!--{{ atask.prizeList.0.prizeName }}-->" data-rule-required="true" data-msg-required="请选择礼包" />
                                        <span class="add-on select-card-code">选择</span>
                                        <span class="add-on can-use">可上架礼包<span class="text-error"><!--{% if atask.prizeList.0.cardnum %}--><!--{{atask.prizeList.0.cardnum}}--><!--{% else %}-->0<!--{% endif %}--></span>个</span>
                                    </div>
                                    <div class="input-append">
                                        &nbsp;
                                        <input type="hidden" name="card_change[2]" value=""/>
                                        <input type="text" name= "totalCount[2]" class="input-min xxx totalCount" value="<!--{% if atask.prizeList.0.prizeType == '1' %}--><!--{{atask.prizeList.0.stock}}--><!--{% else %}-->0<!--{% endif %}-->" readonly="readonly">
                                        <input type="text" name="total[2]" class="input-min" value=""  />
                                        <span class="add-on get_gift" id="get_gift_old">分配</span>
                                    </div>
                                </div>
	                    	</div>
	                    </div>
	                </div>
	
	                <div class="control-group step_div">
	                    <label class="control-label">任务步骤</label>
	                    <div class="controls">
	                        <input type="button"  class="input-small add_down" value="新建步骤" step_type="step_1" />
	                    </div>
	                </div>
	 
	                <div style="margin-left: 100px; margin-bottom: 10px; " class="step_content">
	                    <fieldset style="width: 600px; padding: 10px; border-left: groove" class="step_1">
	                        <legend class="step">步骤 <span>一</span> <!--{{form_select('stepType[]',stepType,atask.stepType,{'style':'width:160px;margin-left:240px;','class':'stepType'})}}--></legend>
	
	                        <div style="float: left">
	                            <div class="control-group">
	                                <label class="control-label">内容:</label>
	                                <div class="controls">
	                                    <input type="text"  class="input-small" value="<!--{{item.stepCondition.content}}-->" />
	                                </div>
	                            </div>
	                            <div class="control-group" >
	                            </div>
	                        </div>
	
	                        <div style="float: left; margin-left: 60px;">
	                            <input value="插入步骤"  type="button"class="add_up" /><br><br>
	                            <input value="删除" type="button" class="btn_del" />
	                            <!--{%if atask.taskId%}-->
	                            <br><br><input value="保存" type="button" class="btn_save" />
	                            <!--{%endif%}-->
	                        </div>
	                        <div style="clear: both"></div>
	
	
	                    </fieldset>
	                </div>
				</div>
				
				<!--{%if not atask.taskId%}-->
				<div class="control-group sharestep" style="display:none; border-top: 1px dashed #999;border-bottom: 1px dashed #999;padding-top: 10px;padding-bottom: 10px;">
					<div class="control-group"><label class="control-label" style="width: 200px;">自分享奖励&步骤:</label></div>
	                <div class="control-group prizeDiv">
	                    <label class="control-label">奖励</label>
	                    <div class="controls" style="width: 100%;">
	                        <div class="span4">
		                        <div class="controls" style="margin-left:0px;width:500px">
		                            <!--{{form_radio('selPrizeType_2',"-1",atask.prizeList.0.prizeType==-1,{'class':"prize_radio2"})}}-->无奖励
		                            <!--{{form_radio('selPrizeType_2',3,atask.prizeList.0.prizeType==3,{'class':"prize_radio2"})}}-->钻石
		                            <!--{{form_radio('selPrizeType_2',1,atask.prizeList.0.prizeType==1,{'class':"prize_radio2"})}}-->礼包
		                            <input type="text" name="prizeKey_2" class="input-small prizeKey2" value="<!--{{atask.prizeList.0.prizeKey|default('0')}}-->" />
		                        </div>
	                        </div>
	                        <div class="span4">
								<div class="controls" style="width:300px">
									<label class="control-label">奖励图片<br/>（攻略用）</label>
			                        <div data-provides="fileupload" class="fileupload fileupload-new">
			                            <div style="max-width: 60px; max-height: 60px;" class="fileupload-new thumbnail">
			                                <img id="selected_game_icon" src="<!--{{atask.prizeList.0.prizeIcon|default('/static/img/wu_ss.gif')}}-->">
			                            </div>
			                            <div style="max-width: 60px; max-height: 60px; line-height: 20px;" class="fileupload-preview fileupload-exists thumbnail"></div>
			                        <span class="btn btn-file"><i class="icon-picture"></i>
			                            <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span>
			                            <input id="prizeIcon" name="prizeIcon_2" type="hidden" value="<!--{{atask.prizeList.0.prizeIcon}}-->"/>
			                            <input type="file"  name="prizeIcon_2" >
			                        </span>
			                            <a data-dismiss="fileupload" class="btn fileupload-exists" href="#">Remove</a>
			                            <span style="color: rgb(185, 74, 72);" class="img_note" hidden="hidden">图片不能为空且限于png,gif,jpeg,jpg格式</span>
			                        </div>
			                    </div>
	                        </div>
	                    </div>
	                    <div class="controls div_icon2" style="display:none;">
	                    	<div class="span4">
                                <div class="controls"  id="div_icon_old" style="margin-left:0px;width:600px">
                                    <div class="input-append">
                                    	<!--{%if atask.prizeList.0.prizeKey %}--><input type="hidden" name="card_code_old[1]" value="<!--{{atask.prizeList.0.prizeKey}}-->"/><!--{%endif%}-->
                                        <input class="selected_cardCode" name="card_code[1]" value="<!--{%if atask.prizeList.0.prizeKey %}--><!--{{atask.prizeList.0.prizeKey}}--><!--{%endif%}-->" type="hidden"/>
                                        <input class="selected_card_gid" name="card_gid[1]" value="<!--{%if atask.prizeList.0.gid %}--><!--{{atask.prizeList.0.gid}}--><!--{%endif%}-->" type="hidden"/>
                                        <input name="requestFrom[1]" value="<!--{%if atask.prizeList.0.requestFrom %}--><!--{{atask.prizeList.0.requestFrom}}--><!--{%endif%}-->" type="hidden"/>
                                        <input type="text" readonly class="input-small selected_card_name" name="card_des[1]" value="<!--{{ atask.prizeList.0.prizeName }}-->" data-rule-required="true" data-msg-required="请选择礼包" />
                                        <span class="add-on select-card-code">选择</span>
                                        <span class="add-on can-use">可上架礼包<span class="text-error"><!--{% if atask.prizeList.0.cardnum %}--><!--{{atask.prizeList.0.cardnum}}--><!--{% else %}-->0<!--{% endif %}--></span>个</span>
                                    </div>
                                    <div class="input-append">
                                        &nbsp;
                                        <input type="hidden" name="card_change[1]" value=""/>
                                        <input type="text" name="totalCount[1]" class="input-min xxx totalCount" value="<!--{% if atask.prizeList.0.prizeType == '1' %}--><!--{{atask.prizeList.0.stock}}--><!--{% else %}-->0<!--{% endif %}-->" readonly="readonly">
                                        <input type="text" name="total[1]" class="input-min" value="" />
                                        <span class="add-on get_gift" id="get_gift_new">分配</span>
                                    </div>
                                </div>
	                    	</div>
	                    </div>
	                </div>
	
	                <div class="control-group step_div">
	                    <label class="control-label">任务步骤</label>
	                    <div class="controls">
	                        <input type="button"  class="input-small add_down" value="新建步骤" step_type="step_2" />
	                    </div>
	                </div>
	 
	                <div style="margin-left: 100px; margin-bottom: 10px; " class="step_content">
	                    <fieldset style="width: 600px; padding: 10px; border-left: groove" class="step_2">
	                        <legend class="step">步骤 <span>一</span> <!--{{form_select('stepType[]',stepType,atask.stepType,{'style':'width:160px;margin-left:240px;','class':'stepType'})}}--></legend>
	
	                        <div style="float: left">
	                            <div class="control-group">
	                                <label class="control-label">内容:</label>
	                                <div class="controls">
	                                    <input type="text"  class="input-small" value="<!--{{item.stepCondition.content}}-->" />
	                                </div>
	                            </div>
	                            <div class="control-group" >
	                            </div>
	                        </div>
	
	                        <div style="float: left; margin-left: 60px;">
	                            <input value="插入步骤"  type="button"class="add_up" /><br><br>
	                            <input value="删除" type="button" class="btn_del" />
	                            <!--{%if atask.taskId%}-->
	                            <br><br><input value="保存" type="button" class="btn_save" />
	                            <!--{%endif%}-->
	                        </div>
	                        <div style="clear: both"></div>
	
	
	                    </fieldset>
	                </div>
				</div>
				<!--{%endif%}-->
				
                <div class="control-group out_url">
                    <label class="control-label">帖子ID/URL</label>
                    <div class="controls">
                        <input type="text" name="linkValue" class="input-small" value="<!--{{atask.linkValue}}-->" />
                    </div>
                </div>

                <div class="control-group attendRate">
                    <label class="control-label">任务限制人数</label>
                    <div class="controls">
                        <input type="text" name="attendRate" class="validate[required,custom[integer],max[100]] text-input input-small" value="<!--{{atask.attendRate}}-->" />(%)可以参加下一子任务,不填将不做限制
                    </div>
                </div>

                <div class="row-fluid time">
                    <div class="span4">
                        <div class="control-group">
                            <label class="control-label">开始时间</label>
                            <div class="controls">
                                <div class="input-append date">
                                    <input name="start_time" onclick="laydate({istime: true, format: 'YYYY-MM-DD hh:mm:ss'})" type="text" class="input-medium datetimepicker" id="date_timepicker_start" value="<!--{{atask.startTime}}-->" readonly>
                                    <span class="add-on"><i class="icon-calendar"></i></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="span4">
                        <div class="control-group">
                            <label class="control-label">结束时间</label>
                            <div class="controls">
                                <div class="input-append date">
                                    <input name="end_time" onclick="laydate({istime: true, format: 'YYYY-MM-DD hh:mm:ss'})" type="text" class="input-medium datetimepicker" id="date_timepicker_start" value="<!--{{atask.endTime}}-->" readonly>
                                    <span class="add-on"><i class="icon-calendar"></i></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <div class="control-group top">
                    <label class="control-label">属性</label>
                    <div class="controls">
                        <input type="checkbox" name="top" class="checkbox top"/>
                        置顶
                    </div>
                </div>
                
                <div class="control-group">
                    <label class="control-label">任务审核须知</label>
                    <div class="controls">
                        <input type="text" name="approvalReminderInfo" class="input-xxlarge" value="<!--{{atask.approvalReminderInfo}}-->" />
                    </div>
                </div>
                
                <!--{%if not atask.taskId or not atask.mutexTaskId %}-->
                <div class="control-group">
					<label class="control-label">互斥任务ID</label>
					<div class="controls">
						<input type="text" name="mutexTaskId" class="input-xxlarge" value="<!--{{atask.mutexTaskId}}-->" />
					</div>
				</div>
				<!--{%endif%}-->

			    <div class="form-actions">
					<button type="submit" class="btn btn-primary sub"><i class="icon-ok"></i>保存</button>
                    <input type="hidden" name="stepListStr" value="<!--{{stepListStr}}-->"/>
                    <input type="hidden" name="stepListStr_2" value="<!--{{stepListStr}}-->"/>
                    <input type="hidden" name="lineType" value="<!--{{selType}}-->"/>
                    <input type="hidden" name="ids" class="ids" value=""/>
                    <input type="hidden" name="ids_2" class="ids2" value=""/>
                    <input type="hidden" name="taskId"  value="<!--{{atask.taskId}}-->"/>
                    <input type="hidden" name="lineId"  value="<!--{{atask.lineId}}-->"/>
                    <input type="hidden" name="shareType"  value="<!--{{atask.shareType}}-->"/>
                    <input type="hidden" name="prizeId"  value="<!--{{atask.prizeList[0]['prizeId']}}-->"/>
				</div> 
			    </form>
			</div>
		</div>
    </div>
</div>
<!--{%endblock%}-->
<!--{%block footer_js%}-->
<script src="/static/js/ajaxfileupload.js"></script>
<script src="<!--{{asset('/static/js/ueditor/ueditor.config.js')}}-->"></script>
<script src="<!--{{asset('/static/js/ueditor/ueditor.all.js')}}-->"></script>
<script src="<!--{{asset('/static/js/ueditor/lang/zh-cn/zh-cn.js')}}-->"></script>
<script src="/static/js/jquery.validationEngine.js"></script>
<script src="/static/js/jquery.validationEngine-en.js"></script>
<script src="/static/js/laydate/laydate.js"></script>
<script src="/static/js/Sortable.js"></script>
<script src="/static/js/plugins/multiselect/bootstrap-multiselect.js"></script>
<script>
var card_code1="";
var card_name1="";
var can_use1="";
var obj= "";
var obj2= "";
obj2 = $(this);
var complete_type;
var selTaskType="0";
var selLinkType="0";
var img_path = "";
var num_new = 0;
var num_old = 0;
var n_new = 0;
var n_old = 0;
var count_new = 0;
var count_old = 0;
var t_new = 0;
var t_old = 0;
var taskId = "<!--{{atask.taskId}}-->";
var sort = "<!--{{atask.sortValue}}-->";
var selType = "<!--{{selType}}-->";
var set_selected_template = function(templateId,templateName){
	$("#selected_templateId").val(templateId);
	$("#selected_templateName").val(templateName);
}

$(function() {
    var step_model = '<fieldset style="width: 600px; padding: 10px; border-left: groove"><legend class="step">步骤  <span> 一</span>  <!--{{form_select('stepType[]',stepType,item.stepType,{'style':'width:160px;margin-left:240px;','class':'stepType'})}}--></legend>    <div style="float: left">   <div class="control-group"><label class="control-label">随机等级</label><div class="controls"><input type="text"  class="input-small" value="<!--{{item.stepCondition.minlevel}}-->" /> 到 <input type="text"  class="input-small" value="<!--{{item.stepCondition.maxlevel}}-->" /> <span style="color:red">必须为正整数</span>  </div>    </div>    <div class="control-group"><label class="control-label">内容</label><div class="controls"><input type="text"  class="input-small" value="<!--{{item.stepCondition.content}}-->" />  </div>    </div>    <div class="control-group">    <label class="control-label">*图片</label>                            <div class="controls">                                <div data-provides="fileupload" class="fileupload fileupload-new">                                    <div style="max-width: 60px; max-height: 60px;" class="fileupload-new thumbnail">                                        <img src="<!--{{item.stepCondition.image|default('/static/img/wu_ss.gif')}}-->">                                    </div>                                    <div style="max-width: 60px; max-height: 60px; line-height: 20px;" class="fileupload-preview fileupload-exists thumbnail"></div>                                    <span class="btn btn-file"><i class="icon-picture"></i>                                        <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span>                                        <input name="prize_img[]" type="hidden" value="<!--{{item.stepCondition.image}}-->"/>                                        <input type="file" name="prize_pic[]"  class="img_validate myfile"  >                                    </span>                                    <a data-dismiss="fileupload" class="btn fileupload-exists" href="#">Remove</a>                                    <span style="color: rgb(185, 74, 72);" class="img_note" hidden="hidden">图片不能为空且限于png,gif,jpeg,jpg格式</span>                                </div>                            </div>                            </div> <div class="control-group">    <label class="control-label">上传图片数：</label><div class="controls"><!--{{form_select('uploadPicType[]',uploadPicType,item.stepCondition.uploadPicType,{'style':'width:80px','class':'stepType'})}}--><input type="text"  class="input-small minpic"  value="<!--{{item.stepCondition.uploadPicLimit}}-->" />  </div> </div>  </div>  <div style="float: left; margin-left: 60px;">    <input value="插入步骤" type="button"class="add_up" /><br><br>    <input value="删除" type="button" class="btn_del" /> <!--{%if atask.taskId%}--> <br><br><input value="保存" type="button" class="btn_save"  /> <!--{%endif%}-->  </div>    <div style="clear: both"></div>    </fieldset>';
    var step_cont_4 = '<div class="control-group"><label class="control-label">随机等级</label><div class="controls"><input type="text"  class="input-small" value="<!--{{item.stepCondition.minlevel}}-->" /> 到 <input type="text"  class="input-small" value="<!--{{item.stepCondition.maxlevel}}-->" /> <span style="color:red">必须为正整数</span>  </div>    </div>    <div class="control-group"><label class="control-label">内容</label><div class="controls"><input type="text"  class="input-small" value="<!--{{item.stepCondition.content}}-->" />  </div>    </div>    <div class="control-group">    <label class="control-label">*图片</label>                            <div class="controls">                                <div data-provides="fileupload" class="fileupload fileupload-new">                                    <div style="max-width: 60px; max-height: 60px;" class="fileupload-new thumbnail">                                        <img src="<!--{{item.stepCondition.image|default('/static/img/wu_ss.gif')}}-->">                                    </div>                                    <div style="max-width: 60px; max-height: 60px; line-height: 20px;" class="fileupload-preview fileupload-exists thumbnail"></div>                                    <span class="btn btn-file"><i class="icon-picture"></i>                                        <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span>                                        <input name="prize_img[]" type="hidden" value="<!--{{item.stepCondition.image}}-->"/>                                        <input type="file" name="prize_pic[]"  class="img_validate myfile"  >                                    </span>                                    <a data-dismiss="fileupload" class="btn fileupload-exists" href="#">Remove</a>                                    <span style="color: rgb(185, 74, 72);" class="img_note" hidden="hidden">图片不能为空且限于png,gif,jpeg,jpg格式</span>                                </div>                            </div>                        </div> <div class="control-group">    <label class="control-label">上传图片数：</label><div class="controls"><!--{{form_select('uploadPicType[]',uploadPicType,item.stepCondition.uploadPicType,{'style':'width:80px','class':'stepType'})}}--><input type="text"  class="input-small minpic"  value="<!--{{item.stepCondition.uploadPicLimit}}-->" />  </div>    </div>';
    var step_cont_0 = '<div class="control-group"><label class="control-label">内容</label><div class="controls"><input type="text"  class="input-small" value="<!--{{item.stepCondition.content}}-->" />  </div>  </div>    <div class="control-group">    <label class="control-label">*图片</label>                            <div class="controls">                                <div data-provides="fileupload" class="fileupload fileupload-new">                                    <div style="max-width: 60px; max-height: 60px;" class="fileupload-new thumbnail">                                        <img src="<!--{{item.stepCondition.image|default('/static/img/wu_ss.gif')}}-->">                                    </div>                                    <div style="max-width: 60px; max-height: 60px; line-height: 20px;" class="fileupload-preview fileupload-exists thumbnail"></div>                                    <span class="btn btn-file"><i class="icon-picture"></i>                                        <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span>                                        <input name="prize_img[]" type="hidden" value="<!--{{item.stepCondition.image}}-->"/>                                        <input type="file" name="prize_pic[]" class="img_validate myfile"  >                                    </span>                                    <a data-dismiss="fileupload" class="btn fileupload-exists" href="#">Remove</a>                                    <span style="color: rgb(185, 74, 72);" class="img_note" hidden="hidden">图片不能为空且限于png,gif,jpeg,jpg格式</span>                                </div>                            </div>                        </div><div class="control-group"><label class="control-label">喊话</label><div class="controls"><input type="text"  class="input-small" value="<!--{{item.stepCondition.shout}}-->" /> <span style="color:#999">* 选填</span>  </div>  </div>';
    var step_cont_1 = '<div class="control-group"><label class="control-label">内容</label><div class="controls"><input type="text"  class="input-small" value="<!--{{item.stepCondition.content}}-->" />  </div>    </div>    <div class="control-group">    <label class="control-label">*图片</label>                            <div class="controls">                                <div data-provides="fileupload" class="fileupload fileupload-new">                                    <div style="max-width: 60px; max-height: 60px;" class="fileupload-new thumbnail">                                        <img src="<!--{{item.stepCondition.image|default('/static/img/wu_ss.gif')}}-->">                                    </div>                                    <div style="max-width: 60px; max-height: 60px; line-height: 20px;" class="fileupload-preview fileupload-exists thumbnail"></div>                                    <span class="btn btn-file"><i class="icon-picture"></i>                                        <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span>                                        <input name="prize_img[]" type="hidden" value="<!--{{item.stepCondition.image}}-->"/>                                        <input type="file" name="prize_pic[]"  class="img_validate myfile"  >                                    </span>                                    <a data-dismiss="fileupload" class="btn fileupload-exists" href="#">Remove</a>                                    <span style="color: rgb(185, 74, 72);" class="img_note" hidden="hidden">图片不能为空且限于png,gif,jpeg,jpg格式</span>                                </div>                            </div>                        </div> <div class="control-group">    <label class="control-label">上传图片数：</label><div class="controls"><!--{{form_select('uploadPicType[]',uploadPicType,item.stepCondition.uploadPicType,{'style':'width:80px','class':'stepType'})}}--><input type="text"  class="input-small minpic"  value="<!--{{item.stepCondition.uploadPicLimit}}-->" />  </div>    </div> <div class="control-group"><label class="control-label">链接地址</label><div class="controls"><input type="text"  class="input-xlarge" value="<!--{{item.stepCondition.linkValue}}-->" /> <span style="color:#999">* 选填</span>  </div>  </div>';
    var step_cont_10 = '<div class="control-group"><label class="control-label">随机等级</label><div class="controls"><input type="text"  class="input-small" value="<!--{{item.stepCondition.minlevel}}-->" /> 到 <input type="text"  class="input-small" value="<!--{{item.stepCondition.maxlevel}}-->" /> <span style="color:red">必须为正整数</span>  </div>    </div>    <div class="control-group"><label class="control-label">内容</label><div class="controls"><input type="text"  class="input-small" value="<!--{{item.stepCondition.content}}-->" />  </div>    </div>    <div class="control-group">    <label class="control-label">*图片</label>                            <div class="controls">                                <div data-provides="fileupload" class="fileupload fileupload-new">                                    <div style="max-width: 60px; max-height: 60px;" class="fileupload-new thumbnail">                                        <img src="<!--{{item.stepCondition.image|default('/static/img/wu_ss.gif')}}-->">                                    </div>                                    <div style="max-width: 60px; max-height: 60px; line-height: 20px;" class="fileupload-preview fileupload-exists thumbnail"></div>                                    <span class="btn btn-file"><i class="icon-picture"></i>                                        <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span>                                        <input name="prize_img[]" type="hidden" value="<!--{{item.stepCondition.image}}-->"/>                                        <input type="file" name="prize_pic[]"  class="img_validate myfile"  >                                    </span>                                    <a data-dismiss="fileupload" class="btn fileupload-exists" href="#">Remove</a>                                    <span style="color: rgb(185, 74, 72);" class="img_note" hidden="hidden">图片不能为空且限于png,gif,jpeg,jpg格式</span>                                </div>                            </div>                        </div> <div class="control-group">    <label class="control-label">上传图片数：</label><div class="controls"><!--{{form_select('uploadPicType[]',uploadPicType,item.stepCondition.uploadPicType,{'style':'width:80px','class':'stepType'})}}--><input type="text"  class="input-small minpic"  value="<!--{{item.stepCondition.uploadPicLimit}}-->" />  </div>    </div>';
    var step_cont_5 = '<div class="control-group"><label class="control-label">内容</label><div class="controls"><input type="text"  class="input-small" value="<!--{{item.stepCondition.content}}-->" />  </div>    </div>    <div class="control-group">    <label class="control-label">*图片</label>                            <div class="controls">                                <div data-provides="fileupload" class="fileupload fileupload-new">                                    <div style="max-width: 60px; max-height: 60px;" class="fileupload-new thumbnail">                                        <img src="<!--{{item.stepCondition.image|default('/static/img/wu_ss.gif')}}-->">                                    </div>                                    <div style="max-width: 60px; max-height: 60px; line-height: 20px;" class="fileupload-preview fileupload-exists thumbnail"></div>                                    <span class="btn btn-file"><i class="icon-picture"></i>                                        <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span>                                        <input name="prize_img[]" type="hidden" value="<!--{{item.stepCondition.image}}-->"/>                                        <input type="file" name="prize_pic[]"  class="img_validate myfile"  >                                    </span>                                    <a data-dismiss="fileupload" class="btn fileupload-exists" href="#">Remove</a>                                    <span style="color: rgb(185, 74, 72);" class="img_note" hidden="hidden">图片不能为空且限于png,gif,jpeg,jpg格式</span>                                </div>                            </div>                        </div> <div class="control-group">    <label class="control-label">上传图片数：</label><div class="controls"><!--{{form_select('uploadPicType[]',uploadPicType,item.stepCondition.uploadPicType,{'style':'width:80px','class':'stepType'})}}--><input type="text"  class="input-small minpic"  value="<!--{{item.stepCondition.uploadPicLimit}}-->" />  </div>    </div>';
    var step_cont_6 = '<div class="control-group"><label class="control-label">随机等级</label><div class="controls"><input type="text"  class="input-small" value="<!--{{item.stepCondition.minlevel}}-->" /> 到 <input type="text"  class="input-small" value="<!--{{item.stepCondition.maxlevel}}-->" /> <span style="color:red">必须为正整数</span>  </div>    </div>    <div class="control-group"><label class="control-label">内容</label><div class="controls"><input type="text"  class="input-small" value="<!--{{item.stepCondition.content}}-->" />  </div>    </div>    <div class="control-group">    <label class="control-label">*图片</label>                            <div class="controls">                                <div data-provides="fileupload" class="fileupload fileupload-new">                                    <div style="max-width: 60px; max-height: 60px;" class="fileupload-new thumbnail">                                        <img src="<!--{{item.stepCondition.image|default('/static/img/wu_ss.gif')}}-->">                                    </div>                                    <div style="max-width: 60px; max-height: 60px; line-height: 20px;" class="fileupload-preview fileupload-exists thumbnail"></div>                                    <span class="btn btn-file"><i class="icon-picture"></i>                                        <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span>                                        <input name="prize_img[]" type="hidden" value="<!--{{item.stepCondition.image}}-->"/>                                        <input type="file" name="prize_pic[]"  class="img_validate myfile"  >                                    </span>                                    <a data-dismiss="fileupload" class="btn fileupload-exists" href="#">Remove</a>                                    <span style="color: rgb(185, 74, 72);" class="img_note" hidden="hidden">图片不能为空且限于png,gif,jpeg,jpg格式</span>                                </div>                            </div>                        </div> <div class="control-group">    <label class="control-label">上传图片数：</label><div class="controls"><!--{{form_select('uploadPicType[]',uploadPicType,item.stepCondition.uploadPicType,{'style':'width:80px','class':'stepType'})}}--><input type="text"  class="input-small minpic"  value="<!--{{item.stepCondition.uploadPicLimit}}-->" />  </div>    </div>';
    var step_cont_7 = '<div class="control-group"><label class="control-label">随机等级</label><div class="controls"><input type="text"  class="input-small" value="<!--{{item.stepCondition.minlevel}}-->" /> 到 <input type="text"  class="input-small" value="<!--{{item.stepCondition.maxlevel}}-->" /> <span style="color:red">必须为正整数</span>  </div>    </div>    <div class="control-group"><label class="control-label">内容</label><div class="controls"><input type="text"  class="input-small" value="<!--{{item.stepCondition.content}}-->" />  </div>    </div>    <div class="control-group">    <label class="control-label">*图片</label>                            <div class="controls">                                <div data-provides="fileupload" class="fileupload fileupload-new">                                    <div style="max-width: 60px; max-height: 60px;" class="fileupload-new thumbnail">                                        <img src="<!--{{item.stepCondition.image|default('/static/img/wu_ss.gif')}}-->">                                    </div>                                    <div style="max-width: 60px; max-height: 60px; line-height: 20px;" class="fileupload-preview fileupload-exists thumbnail"></div>                                    <span class="btn btn-file"><i class="icon-picture"></i>                                        <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span>                                        <input name="prize_img[]" type="hidden" value="<!--{{item.stepCondition.image}}-->"/>                                        <input type="file" name="prize_pic[]"  class="img_validate myfile"  >                                    </span>                                    <a data-dismiss="fileupload" class="btn fileupload-exists" href="#">Remove</a>                                    <span style="color: rgb(185, 74, 72);" class="img_note" hidden="hidden">图片不能为空且限于png,gif,jpeg,jpg格式</span>                                </div>                            </div>                        </div> <div class="control-group">    <label class="control-label">上传图片数：</label><div class="controls"><!--{{form_select('uploadPicType[]',uploadPicType,item.stepCondition.uploadPicType,{'style':'width:80px','class':'stepType'})}}--><input type="text"  class="input-small minpic"  value="<!--{{item.stepCondition.uploadPicLimit}}-->" />  </div>    </div>';
    var step_cont_2 = '<div class="control-group"><label class="control-label">内容:</label><div class="controls"><input type="text"  class="input-small" value="<!--{{item.stepCondition.content}}-->" />  </div>    </div>    <div class="control-group" >        </div>';
    var step_cont_3 = '<div class="control-group"><label class="control-label">内容:</label><div class="controls"><input type="text"  class="input-small" value="<!--{{item.stepCondition.content}}-->" />  </div>    </div><div class="control-group"><label class="control-label">bundle id:</label><div class="controls"><input type="text"  class="input-small" value="<!--{{item.stepCondition.bundleId}}-->" />  </div>    </div>    <div class="control-group" >    <label class="control-label">游戏名称:</label>    <div class="controls">    <input type="text"  class="input-small" value="<!--{{item.stepCondition.gameName}}-->" />    </div>    </div>    <div class="control-group">    <label class="control-label">限定在游戏中时间(分)：</label><div class="controls"><input type="text"  class="input-small" value="<!--{{item.stepCondition.trialTime}}-->" />  </div>    </div>';
    var step_cont_8 = '<div><div class="control-group"><label class="control-label">额度:</label><div class="controls"><input type="text" class="input-small limitValue" value="" /></div></div><label class="control-label">奖励:</label><div class="controls"><input type="text" class="input-small rewardValue" value="" data-rule-digits="true" data-msg-digits="只能填写正整数"/></div><div style="margin-top: 20px;"><a class="btn btn-primary addRewardHtml">添加</a><a class="btn btn-danger delRewardHtml" style="margin-left: 20px;">删除</a><div><hr style="height:1px;border:none;border-top:1px dashed #555555;" /></div>';
	var step_cont_9 = '<div class="control-group">	<label class="control-label">物品类别</label>	<div class="controls"><!--{{form_select('backpackType[]',backpackType,item.stepCondition.backpackType,{'style':'width:120px','class':'stepType'})}}--></div></div><div class="control-group">	<label class="control-label">物品模板</label>	<div class="controls">		<div class="input-append">			<input id="selected_templateId" name="templateId" type="hidden" value="<!--{{item.stepCondition.templateId}}-->" />			<input type="text" id="selected_templateName" readonly  class="input-xlarge" style="width: 200px;" value="<!--{{item.stepCondition.templateName}}-->"  />			<span class="add-on select-templateId">选择模版</span>		</div>	</div></div>';
    $(document).off('click', '.addRewardHtml');
    $(document).on('click', '.addRewardHtml', function(){
        var _obj = $(this);
        _obj.parent().parent().parent().append(step_cont_8);
    });

    $(document).off('click', '.delRewardHtml');
    $(document).on('click', '.delRewardHtml', function(){
        var _obj = $(this);
        _obj.parent().parent().remove();
    });


    $(".step_content").html("");
    <!--{%for item in atask.stepList%}-->
    $(".step_content").append('<fieldset style="width: 600px; padding: 10px; border-left: groove" class="step_1"><legend class="step">步骤  <span> 一</span>  <!--{{form_select('stepType[]',stepType,item.stepType,{'style':'width:160px;margin-left:240px;','class':'stepType'})}}--></legend>    <div style="float: left">        </div>    <div style="float: left; margin-left: 60px;">    <input value="插入步骤" type="button"class="add_up" /><br><br>    <input value="删除" type="button" class="btn_del" /> <!--{%if atask.taskId%}-->  <br><br><input value="保存" type="button" class="btn_save"  stepId="<!--{{item.stepId}}-->" /> <!--{%endif%}--> </div>    <div style="clear: both"></div>    </fieldset>');
    var obj = $(".step_content").children(".step_1:last");
    <!--{%if item.stepType==0 %}-->
    obj.children("div:first").html('<div class="control-group"><label class="control-label">内容</label><div class="controls"><input type="text"  class="input-small" value="<!--{{item.stepCondition.content}}-->" />  </div>  </div>    <div class="control-group">    <label class="control-label">*图片</label>                            <div class="controls">                                <div data-provides="fileupload" class="fileupload fileupload-new">                                    <div style="max-width: 60px; max-height: 60px;" class="fileupload-new thumbnail">                                        <img src="<!--{{item.stepCondition.image|default('/static/img/wu_ss.gif')}}-->">                                    </div>                                    <div style="max-width: 60px; max-height: 60px; line-height: 20px;" class="fileupload-preview fileupload-exists thumbnail"></div>                                    <span class="btn btn-file"><i class="icon-picture"></i>                                        <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span>                                        <input name="prize_img[]" type="hidden" value="<!--{{item.stepCondition.image}}-->"/>                                        <input type="file" name="prize_pic[]" class="img_validate myfile"  >                                    </span>                                    <a data-dismiss="fileupload" class="btn fileupload-exists" href="#">Remove</a>                                    <span style="color: rgb(185, 74, 72);" class="img_note" hidden="hidden">图片不能为空且限于png,gif,jpeg,jpg格式</span>                                </div>                            </div>                        </div><div class="control-group"><label class="control-label">喊话</label><div class="controls"><input type="text"  class="input-small" value="<!--{{item.stepCondition.shout}}-->" /> <span style="color:#999">* 选填</span>  </div>  </div>');
    <!--{%elseif item.stepType==1%}-->
    obj.children("div:first").html('<div class="control-group"><label class="control-label">内容</label><div class="controls"><input type="text"  class="input-small" value="<!--{{item.stepCondition.content}}-->" />  </div>    </div>    <div class="control-group">    <label class="control-label">*图片</label>                            <div class="controls">                                <div data-provides="fileupload" class="fileupload fileupload-new">                                    <div style="max-width: 60px; max-height: 60px;" class="fileupload-new thumbnail">                                        <img src="<!--{{item.stepCondition.image|default('/static/img/wu_ss.gif')}}-->">                                    </div>                                    <div style="max-width: 60px; max-height: 60px; line-height: 20px;" class="fileupload-preview fileupload-exists thumbnail"></div>                                    <span class="btn btn-file"><i class="icon-picture"></i>                                        <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span>                                        <input name="prize_img[]" type="hidden" value="<!--{{item.stepCondition.image}}-->"/>                                        <input type="file" name="prize_pic[]" class="img_validate myfile"  >                                    </span>                                    <a data-dismiss="fileupload" class="btn fileupload-exists" href="#">Remove</a>                                    <span style="color: rgb(185, 74, 72);" class="img_note" hidden="hidden">图片不能为空且限于png,gif,jpeg,jpg格式</span>                                </div>                            </div>                        </div> <div class="control-group">    <label class="control-label">上传图片数：</label><div class="controls"><!--{{form_select('uploadPicType[]',uploadPicType,item.stepCondition.uploadPicType,{'style':'width:80px','class':'stepType'})}}--><input type="text"  class="input-small minpic"  value="<!--{{item.stepCondition.uploadPicLimit}}-->" />  </div>    </div> <div class="control-group"><label class="control-label">链接地址</label><div class="controls"><input type="text"  class="input-xlarge" value="<!--{{item.stepCondition.linkValue}}-->" /> <span style="color:#999">* 选填</span>  </div>  </div>');
    <!--{%elseif item.stepType==10%}-->
    obj.children("div:first").html('<div class="control-group"><label class="control-label">随机等级</label><div class="controls"><input type="text"  class="input-small" value="<!--{{item.stepCondition.minlevel}}-->" /> 到 <input type="text"  class="input-small" value="<!--{{item.stepCondition.maxlevel}}-->" /> <span style="color:red">必须为正整数</span>  </div>    </div>    <div class="control-group"><label class="control-label">内容</label><div class="controls"><input type="text"  class="input-small" value="<!--{{item.stepCondition.content}}-->" />  </div>    </div>    <div class="control-group">    <label class="control-label">*图片</label>                            <div class="controls">                                <div data-provides="fileupload" class="fileupload fileupload-new">                                    <div style="max-width: 60px; max-height: 60px;" class="fileupload-new thumbnail">                                        <img src="<!--{{item.stepCondition.image|default('/static/img/wu_ss.gif')}}-->">                                    </div>                                    <div style="max-width: 60px; max-height: 60px; line-height: 20px;" class="fileupload-preview fileupload-exists thumbnail"></div>                                    <span class="btn btn-file"><i class="icon-picture"></i>                                        <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span>                                        <input name="prize_img[]" type="hidden" value="<!--{{item.stepCondition.image}}-->"/>                                        <input type="file" name="prize_pic[]" class="img_validate myfile"  >                                    </span>                                    <a data-dismiss="fileupload" class="btn fileupload-exists" href="#">Remove</a>                                    <span style="color: rgb(185, 74, 72);" class="img_note" hidden="hidden">图片不能为空且限于png,gif,jpeg,jpg格式</span>                                </div>                            </div>                        </div> <div class="control-group">    <label class="control-label">上传图片数：</label><div class="controls"><!--{{form_select('uploadPicType[]',uploadPicType,item.stepCondition.uploadPicType,{'style':'width:80px','class':'stepType'})}}--><input type="text"  class="input-small minpic"  value="<!--{{item.stepCondition.uploadPicLimit}}-->" />  </div>    </div>');
    <!--{%elseif item.stepType==2%}-->
    obj.children("div:first").html('<div class="control-group"><label class="control-label">内容:</label><div class="controls"><input type="text"  class="input-small" value="<!--{{item.stepCondition.content}}-->" />  </div>    </div>    <div class="control-group" >        </div>');
    <!--{%elseif item.stepType==3%}-->
    obj.children("div:first").html('<div class="control-group"><label class="control-label">内容:</label><div class="controls"><input type="text"  class="input-small" value="<!--{{item.stepCondition.content}}-->" />  </div>    </div>    <div class="control-group"><label class="control-label">bundle id:</label><div class="controls"><input type="text"  class="input-small" value="<!--{{item.stepCondition.bundleId}}-->" />  </div>    </div>    <div class="control-group" >    <label class="control-label">游戏名称:</label>    <div class="controls">    <input type="text"  class="input-small" value="<!--{{item.stepCondition.gameName}}-->" />    </div>    </div>    <div class="control-group">    <label class="control-label">限定在游戏中时间(分)：</label><div class="controls"><input type="text"  class="input-small" value="<!--{{item.stepCondition.trialTime}}-->" />  </div>    </div>');
    <!--{%elseif item.stepType==4%}-->
    obj.children("div:first").html('<div class="control-group"><label class="control-label">随机等级</label><div class="controls"><input type="text"  class="input-small" value="<!--{{item.stepCondition.minlevel}}-->" /> 到 <input type="text"  class="input-small" value="<!--{{item.stepCondition.maxlevel}}-->" /> <span style="color:red">必须为正整数</span>  </div>    </div>    <div class="control-group"><label class="control-label">内容</label><div class="controls"><input type="text"  class="input-small" value="<!--{{item.stepCondition.content}}-->" />  </div>    </div>    <div class="control-group">    <label class="control-label">*图片</label>                            <div class="controls">                                <div data-provides="fileupload" class="fileupload fileupload-new">                                    <div style="max-width: 60px; max-height: 60px;" class="fileupload-new thumbnail">                                        <img src="<!--{{item.stepCondition.image|default('/static/img/wu_ss.gif')}}-->">                                    </div>                                    <div style="max-width: 60px; max-height: 60px; line-height: 20px;" class="fileupload-preview fileupload-exists thumbnail"></div>                                    <span class="btn btn-file"><i class="icon-picture"></i>                                        <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span>                                        <input name="prize_img[]" type="hidden" value="<!--{{item.stepCondition.image}}-->"/>                                        <input type="file" name="prize_pic[]" class="img_validate myfile"  >                                    </span>                                    <a data-dismiss="fileupload" class="btn fileupload-exists" href="#">Remove</a>                                    <span style="color: rgb(185, 74, 72);" class="img_note" hidden="hidden">图片不能为空且限于png,gif,jpeg,jpg格式</span>                                </div>                            </div>                        </div> <div class="control-group">    <label class="control-label">上传图片数：</label><div class="controls"><!--{{form_select('uploadPicType[]',uploadPicType,item.stepCondition.uploadPicType,{'style':'width:80px','class':'stepType'})}}--><input type="text"  class="input-small minpic"  value="<!--{{item.stepCondition.uploadPicLimit}}-->" />  </div>    </div>');
    <!--{%elseif item.stepType==5%}-->
    obj.children("div:first").html('<div class="control-group"><label class="control-label">内容</label><div class="controls"><input type="text"  class="input-small" value="<!--{{item.stepCondition.content}}-->" />  </div>    </div>    <div class="control-group">    <label class="control-label">*图片</label>                            <div class="controls">                                <div data-provides="fileupload" class="fileupload fileupload-new">                                    <div style="max-width: 60px; max-height: 60px;" class="fileupload-new thumbnail">                                        <img src="<!--{{item.stepCondition.image|default('/static/img/wu_ss.gif')}}-->">                                    </div>                                    <div style="max-width: 60px; max-height: 60px; line-height: 20px;" class="fileupload-preview fileupload-exists thumbnail"></div>                                    <span class="btn btn-file"><i class="icon-picture"></i>                                        <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span>                                        <input name="prize_img[]" type="hidden" value="<!--{{item.stepCondition.image}}-->"/>                                        <input type="file" name="prize_pic[]" class="img_validate myfile"  >                                    </span>                                    <a data-dismiss="fileupload" class="btn fileupload-exists" href="#">Remove</a>                                    <span style="color: rgb(185, 74, 72);" class="img_note" hidden="hidden">图片不能为空且限于png,gif,jpeg,jpg格式</span>                                </div>                            </div>                        </div> <div class="control-group">    <label class="control-label">上传图片数：</label><div class="controls"><!--{{form_select('uploadPicType[]',uploadPicType,item.stepCondition.uploadPicType,{'style':'width:80px','class':'stepType'})}}--><input type="text"  class="input-small minpic"  value="<!--{{item.stepCondition.uploadPicLimit}}-->" />  </div>    </div>');
    <!--{%elseif item.stepType==6%}-->
    obj.children("div:first").html('<div class="control-group"><label class="control-label">随机等级</label><div class="controls"><input type="text"  class="input-small" value="<!--{{item.stepCondition.minlevel}}-->" /> 到 <input type="text"  class="input-small" value="<!--{{item.stepCondition.maxlevel}}-->" /> <span style="color:red">必须为正整数</span>  </div>    </div>    <div class="control-group"><label class="control-label">内容</label><div class="controls"><input type="text"  class="input-small" value="<!--{{item.stepCondition.content}}-->" />  </div>    </div>    <div class="control-group">    <label class="control-label">*图片</label>                            <div class="controls">                                <div data-provides="fileupload" class="fileupload fileupload-new">                                    <div style="max-width: 60px; max-height: 60px;" class="fileupload-new thumbnail">                                        <img src="<!--{{item.stepCondition.image|default('/static/img/wu_ss.gif')}}-->">                                    </div>                                    <div style="max-width: 60px; max-height: 60px; line-height: 20px;" class="fileupload-preview fileupload-exists thumbnail"></div>                                    <span class="btn btn-file"><i class="icon-picture"></i>                                        <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span>                                        <input name="prize_img[]" type="hidden" value="<!--{{item.stepCondition.image}}-->"/>                                        <input type="file" name="prize_pic[]" class="img_validate myfile"  >                                    </span>                                    <a data-dismiss="fileupload" class="btn fileupload-exists" href="#">Remove</a>                                    <span style="color: rgb(185, 74, 72);" class="img_note" hidden="hidden">图片不能为空且限于png,gif,jpeg,jpg格式</span>                                </div>                            </div>                        </div> <div class="control-group">    <label class="control-label">上传图片数：</label><div class="controls"><!--{{form_select('uploadPicType[]',uploadPicType,item.stepCondition.uploadPicType,{'style':'width:80px','class':'stepType'})}}--><input type="text"  class="input-small minpic"  value="<!--{{item.stepCondition.uploadPicLimit}}-->" />  </div>    </div>');
    <!--{%elseif item.stepType==7%}-->
    obj.children("div:first").html('<div class="control-group"><label class="control-label">随机等级</label><div class="controls"><input type="text"  class="input-small" value="<!--{{item.stepCondition.minlevel}}-->" /> 到 <input type="text"  class="input-small" value="<!--{{item.stepCondition.maxlevel}}-->" /> <span style="color:red">必须为正整数</span>  </div>    </div>    <div class="control-group"><label class="control-label">内容</label><div class="controls"><input type="text"  class="input-small" value="<!--{{item.stepCondition.content}}-->" />  </div>    </div>    <div class="control-group">    <label class="control-label">*图片</label>                            <div class="controls">                                <div data-provides="fileupload" class="fileupload fileupload-new">                                    <div style="max-width: 60px; max-height: 60px;" class="fileupload-new thumbnail">                                        <img src="<!--{{item.stepCondition.image|default('/static/img/wu_ss.gif')}}-->">                                    </div>                                    <div style="max-width: 60px; max-height: 60px; line-height: 20px;" class="fileupload-preview fileupload-exists thumbnail"></div>                                    <span class="btn btn-file"><i class="icon-picture"></i>                                        <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span>                                        <input name="prize_img[]" type="hidden" value="<!--{{item.stepCondition.image}}-->"/>                                        <input type="file" name="prize_pic[]" class="img_validate myfile"  >                                    </span>                                    <a data-dismiss="fileupload" class="btn fileupload-exists" href="#">Remove</a>                                    <span style="color: rgb(185, 74, 72);" class="img_note" hidden="hidden">图片不能为空且限于png,gif,jpeg,jpg格式</span>                                </div>                            </div>                        </div> <div class="control-group">    <label class="control-label">上传图片数：</label><div class="controls"><!--{{form_select('uploadPicType[]',uploadPicType,item.stepCondition.uploadPicType,{'style':'width:80px','class':'stepType'})}}--><input type="text"  class="input-small minpic"  value="<!--{{item.stepCondition.uploadPicLimit}}-->" />  </div>    </div>');
    <!--{%elseif item.stepType==9%}-->
    obj.children("div:first").html('<div class="control-group">	<label class="control-label">物品类别</label>	<div class="controls"><!--{{form_select('backpackType[]',backpackType,item.stepCondition.backpackType,{'style':'width:120px','class':'stepType'})}}--></div></div><div class="control-group">	<label class="control-label">物品模板</label>	<div class="controls">		<div class="input-append">			<input id="selected_templateId" name="templateId" type="hidden" value="<!--{{item.stepCondition.templateId}}-->" />			<input type="text" id="selected_templateName" readonly  class="input-xlarge" style="width: 200px;" value="<!--{{item.stepCondition.templateName}}-->"  />			<span class="add-on select-templateId">选择模版</span>		</div>	</div></div>');
    <!--{%elseif item.stepType==8%}-->
    var tempHtml = '';
        <!--{%if item.stepCondition.recharge%}-->
        var tempRecharge = "<!--{{item.stepCondition.recharge}}-->";
        var tempRechargeArr = new Array();
        tempRechargeArr = tempRecharge.split(',');
        $.each(tempRechargeArr, function(key, value) {
            var tempArr = new Array();
            tempArr = value.split('=');
            var tempLength = tempArr.length;
            if (tempLength == 2) {
                tempHtml += '<div><div class="control-group"><label class="control-label">额度:</label><div class="controls"><input type="text" class="input-small limitValue" value="'+tempArr[0]+'" /></div></div><label class="control-label">奖励:</label><div class="controls"><input type="text" class="input-small rewardValue" value="'+tempArr[1]+'" data-rule-digits="true" data-msg-digits="只能填写正整数"/></div><div style="margin-top: 20px;"><a class="btn btn-primary addRewardHtml">添加</a><a class="btn btn-danger delRewardHtml" style="margin-left: 20px;">删除</a><div><hr style="height:1px;border:none;border-top:1px dashed #555555;" /></div></div></div>';
            } else {
                tempHtml += '<div><div class="control-group"><label class="control-label">额度:</label><div class="controls"><input type="text" class="input-small limitValue" value="" /></div></div><label class="control-label">奖励:</label><div class="controls"><input type="text" class="input-small rewardValue" value="" data-rule-digits="true" data-msg-digits="只能填写正整数"/></div><div style="margin-top: 20px;"><a class="btn btn-primary addRewardHtml">添加</a><a class="btn btn-danger delRewardHtml" style="margin-left: 20px;">删除</a><div><hr style="height:1px;border:none;border-top:1px dashed #555555;" /></div></div></div>';
            }


        });
        <!--{% else %}-->
        tempHtml += '<div><div class="control-group"><label class="control-label">额度:</label><div class="controls"><input type="text" class="input-small limitValue" value="" /></div></div><label class="control-label">奖励:</label><div class="controls"><input type="text" class="input-small rewardValue" value="" data-rule-digits="true" data-msg-digits="只能填写正整数"/></div><div style="margin-top: 20px;"><a class="btn btn-primary addRewardHtml">添加</a><a class="btn btn-danger delRewardHtml" style="margin-left: 20px;">删除</a><div><hr style="height:1px;border:none;border-top:1px dashed #555555;" /></div>';
        <!--{%endif%}-->

        obj.children("div:first").html(tempHtml);


    <!--{%endif%}-->
    <!--{%endfor%}-->
	
    $("input[name='share']").click(function(){
    	if($("input[name='share']").is(':checked')==true) {
            $('.sharestep').fadeIn();
            var taskType = $("input[name='selTaskType']:checked").val();
    		check_taskType(taskType);
    	}else{
    	    $('.sharestep').fadeOut();
    	    var taskType = $("input[name='selTaskType']:checked").val();
    		check_taskType(taskType);
    	}
    });
    
    $(".add_down").live("click",function(){
        $(this).parent().parent().parent().children(".step_content").append(step_model);
        var c = $(this).attr("step_type");
		$(this).parent().parent().parent().find("fieldset").each(function(){
	    	$(this).addClass(c);
	    })
	    set_step_sort(c);
    });
    
    $(".add_up").live('click',function(){
    	var c = $(this).parent().parent().parent().find("fieldset").attr('class');
        var currentStepId = $(this).siblings(".btn_save").attr("stepId");
        $(this).parent().parent().before('<fieldset style="width: 600px; padding: 10px; border-left: groove" class="'+c+'" ><legend class="step">步骤  <span> 一</span>  <!--{{form_select('stepType[]',stepType,item.stepType,{'style':'width:160px;margin-left:240px;','class':'stepType'})}}--></legend>    <div style="float: left"><div class="control-group"><label class="control-label">随机等级</label><div class="controls"><input type="text"  class="input-small" value="<!--{{item.stepCondition.minlevel}}-->" /> 到 <input type="text"  class="input-small" value="<!--{{item.stepCondition.maxlevel}}-->" /> <span style="color:red">必须为正整数</span>  </div>    </div>       <div class="control-group"><label class="control-label">内容</label><div class="controls"><input type="text"  class="input-small" value="<!--{{item.stepCondition.content}}-->" />  </div>    </div>    <div class="control-group">    <label class="control-label">*图片</label>                            <div class="controls">                                <div data-provides="fileupload" class="fileupload fileupload-new">                                    <div style="max-width: 60px; max-height: 60px;" class="fileupload-new thumbnail">                                        <img src="<!--{{item.stepCondition.image|default('/static/img/wu_ss.gif')}}-->">                                    </div>                                    <div style="max-width: 60px; max-height: 60px; line-height: 20px;" class="fileupload-preview fileupload-exists thumbnail"></div>                                    <span class="btn btn-file"><i class="icon-picture"></i>                                        <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span>                                        <input name="prize_img[]" type="hidden" value="<!--{{item.stepCondition.image}}-->"/>                                        <input type="file" name="prize_pic[]"  class="img_validate myfile"  >                                    </span>                                    <a data-dismiss="fileupload" class="btn fileupload-exists" href="#">Remove</a>                                    <span style="color: rgb(185, 74, 72);" class="img_note" hidden="hidden">图片不能为空且限于png,gif,jpeg,jpg格式</span>                                </div>                            </div>                        </div> <div class="control-group">    <label class="control-label">上传图片数：</label><div class="controls"><!--{{form_select('uploadPicType[]',uploadPicType,item.stepCondition.uploadPicType,{'style':'width:80px','class':'stepType'})}}--><input type="text"  class="input-small minpic"  value="<!--{{item.stepCondition.uploadPicLimit}}-->" />  </div></div></div>    <div style="float: left; margin-left: 60px;">    <input value="插入步骤" type="button"class="add_up" /><br><br>    <input value="删除" type="button" class="btn_del" /> <!--{%if atask.taskId%}--> <br><br><input value="保存" type="button" class="btn_save" currentStepId="'+currentStepId+'" />  <!--{%endif%}--> </div>    <div style="clear: both"></div>    </fieldset>');
        set_step_sort(c);
    });

    $(".btn_save").live("click",function(){
        var obj =  $(this).parent().parent();
	    if(obj.find(".minpic").val()<1){
	     	alert("上传图片数必须大于等于1");
	       	return false;
	    }
        var stepType = obj.children("legend").children(".stepType").val();
        var currentStepId = $(this).attr("currentStepId");
        var stepId = $(this).attr("stepId");
        var json_ = '{';
        var conditon = "";
        var img_val =  obj.children().eq(1).children("div").children("div").children("div").children("span").children("input[name='prize_img[]']").val();
        if(img_val){
            img_path = img_val;
        }
        switch(stepType)
        {
            case '0':
                var content = obj.children().eq(1).children("div").eq(0).children("div").children("input").val();
                conditon += '"content":"'+content+'",';
                var shout = obj.children().eq(1).children("div").eq(2).children("div").children("input").val();
                conditon += '"shout":"'+shout+'"';
                if(img_path){
                    conditon += ',"image":"'+img_path+'"';
                }
                break;
            case '1':
                var content = obj.children().eq(1).children("div").eq(0).children("div").children("input").val();
                conditon += '"content":"'+content+'",';
                var uploadPicType =  obj.children().eq(1).children("div").eq(2).children("div").children("select").val();
                conditon += '"uploadPicType":"'+uploadPicType+'",';
                var uploadPicLimit =  obj.children().eq(1).children("div").eq(2).children("div").children("input").val();
                conditon += '"uploadPicLimit":"'+uploadPicLimit+'",';
                var linkValue =  obj.children().eq(1).children("div").eq(3).children("div").children("input").val();
                conditon += '"linkValue":"'+linkValue+'"';
                if(img_path){
                    conditon += ',"image":"'+img_path+'"';
                }
                break;
            case '10':
                var minlevel = obj.children().eq(1).children("div").eq(0).children("div").children("input").eq(0).val();
                conditon += '"minlevel":"'+minlevel+'",';
                var maxlevel = obj.children().eq(1).children("div").eq(0).children("div").children("input").eq(1).val();
                conditon += '"maxlevel":"'+maxlevel+'",';
                var content = obj.children().eq(1).children("div").eq(1).children("div").children("input").val();
                conditon += '"content":"'+content+'",';
                var uploadPicType =  obj.children().eq(1).children("div").eq(3).children("div").children("select").val();
                conditon += '"uploadPicType":"'+uploadPicType+'",';
                var uploadPicLimit =  obj.children().eq(1).children("div").eq(3).children("div").children("input").val();
                conditon += '"uploadPicLimit":"'+uploadPicLimit+'"';
                if(img_path){
                    conditon += ',"image":"'+img_path+'"';
                }
                break;
            case '2':
                var content = obj.children().eq(1).children("div").eq(0).children("div").children("input").val();
                conditon += '"content":"'+content+'",';
                var downloadUrl =  obj.children().eq(1).children("div").eq(1).children("div").children("input").val();
                conditon += '"downloadUrl":"'+downloadUrl+'",';
                var gid =  $("#selected_game_id").val();
                conditon += '"gid":"'+gid+'"';
                break;
            case '3':
                var content = obj.children().eq(1).children("div").eq(0).children("div").children("input").val();
                conditon += '"content":"'+content+'",';
                var bundleId = obj.children().eq(1).children("div").eq(1).children("div").children("input").val();
                conditon += '"bundleId":"'+bundleId+'",';
                var gameName =  obj.children().eq(1).children("div").eq(2).children("div").children("input").val();
                conditon += '"gameName":"'+gameName+'",';
                var trialTime =  obj.children().eq(1).children("div").eq(3).children("div").children("input").val();
                conditon += '"trialTime":"'+trialTime+'"';
                break;
            case '4':
                var minlevel = obj.children().eq(1).children("div").eq(0).children("div").children("input").eq(0).val();
                conditon += '"minlevel":"'+minlevel+'",';
                var maxlevel = obj.children().eq(1).children("div").eq(0).children("div").children("input").eq(1).val();
                conditon += '"maxlevel":"'+maxlevel+'",';
                var content = obj.children().eq(1).children("div").eq(1).children("div").children("input").val();
                conditon += '"content":"'+content+'",';
                var uploadPicType =  obj.children().eq(1).children("div").eq(3).children("div").children("select").val();
                conditon += '"uploadPicType":"'+uploadPicType+'",';
                var uploadPicLimit =  obj.children().eq(1).children("div").eq(3).children("div").children("input").val();
                conditon += '"uploadPicLimit":"'+uploadPicLimit+'"';
                if(img_path){
                    conditon += ',"image":"'+img_path+'"';
                }
                break;
            case '5':
                var content = obj.children().eq(1).children("div").eq(0).children("div").children("input").val();
                conditon += '"content":"'+content+'",';
                var uploadPicType =  obj.children().eq(1).children("div").eq(2).children("div").children("select").val();
                conditon += '"uploadPicType":"'+uploadPicType+'",';
                var uploadPicLimit =  obj.children().eq(1).children("div").eq(2).children("div").children("input").val();
                conditon += '"uploadPicLimit":"'+uploadPicLimit+'"';
                if(img_path){
                    conditon += ',"image":"'+img_path+'"';
                }
                break;
            case '6':
                var minlevel = obj.children().eq(1).children("div").eq(0).children("div").children("input").eq(0).val();
                conditon += '"minlevel":"'+minlevel+'",';
                var maxlevel = obj.children().eq(1).children("div").eq(0).children("div").children("input").eq(1).val();
                conditon += '"maxlevel":"'+maxlevel+'",';
                var content = obj.children().eq(1).children("div").eq(1).children("div").children("input").val();
                conditon += '"content":"'+content+'",';
                var uploadPicType =  obj.children().eq(1).children("div").eq(3).children("div").children("select").val();
                conditon += '"uploadPicType":"'+uploadPicType+'",';
                var uploadPicLimit =  obj.children().eq(1).children("div").eq(3).children("div").children("input").val();
                conditon += '"uploadPicLimit":"'+uploadPicLimit+'"';
                if(img_path){
                    conditon += ',"image":"'+img_path+'"';
                }
                break;
            case '7':
                var minlevel = obj.children().eq(1).children("div").eq(0).children("div").children("input").eq(0).val();
                conditon += '"minlevel":"'+minlevel+'",';
                var maxlevel = obj.children().eq(1).children("div").eq(0).children("div").children("input").eq(1).val();
                conditon += '"maxlevel":"'+maxlevel+'",';
                var content = obj.children().eq(1).children("div").eq(1).children("div").children("input").val();
                conditon += '"content":"'+content+'",';
                var uploadPicType =  obj.children().eq(1).children("div").eq(3).children("div").children("select").val();
                conditon += '"uploadPicType":"'+uploadPicType+'",';
                var uploadPicLimit =  obj.children().eq(1).children("div").eq(3).children("div").children("input").val();
                conditon += '"uploadPicLimit":"'+uploadPicLimit+'"';
                if(img_path){
                    conditon += ',"image":"'+img_path+'"';
                }
                break;
            case '9':
                var backpackType = obj.children().eq(1).children("div").eq(0).children("div").children("select").val();
                conditon += '"backpackType":"'+backpackType+'",';
                var templateId =  obj.children().eq(1).children("div").eq(1).children("div").children("div").children("input").eq(0).val();
                conditon += '"templateId":"'+templateId+'",';
                var templateName =  obj.children().eq(1).children("div").eq(1).children("div").children("div").children("input").eq(1).val();
                conditon += '"templateName":"'+templateName+'"';
                break;
            case '8':
                conditon += '"recharge":{';
                $.each($('.limitValue'), function(key, value){
                    var tempLimitValue = $(this).val();
                    var tempRewardValue = $('.rewardValue').eq(key).val();
                    conditon += '"'+tempLimitValue+'":"'+tempRewardValue+'",';
                });
                conditon = conditon.substring(0,conditon.length-1);
                conditon += '}';
                break;
            default:
        }
        json_ += conditon+"}";
//        console.log(json_);
//        alert(img_path);
        $.post('<!--{{url('IOS_activity/task/step-save')}}-->',{currentStepId:currentStepId,taskId:taskId,stepType:stepType,stepCondition:json_,stepId:stepId},function(data){
            if(data.success=="true"){
                alert(data.mess);
            }
        },"json")
    })

    $(".stepType").live('change',function(){
        var type = $(this).val();
        switch(type)
        {
            case '0':
                $(this).parent().siblings("div").eq(0).html(step_cont_0);
                break;
            case '1':
                $(this).parent().siblings("div").eq(0).html(step_cont_1);
                break;
            case '2':
                $(this).parent().siblings("div").eq(0).html(step_cont_2);
                break;
            case '3':
                $(this).parent().siblings("div").eq(0).html(step_cont_3);
                break;
            case '4':
                $(this).parent().siblings("div").eq(0).html(step_cont_4);
                break;
            case '5':
                $(this).parent().siblings("div").eq(0).html(step_cont_5);
                break;
            case '6':
                $(this).parent().siblings("div").eq(0).html(step_cont_6);
                break;
            case '7':
                $(this).parent().siblings("div").eq(0).html(step_cont_7);
                break;
            case '8':
                $(this).parent().siblings("div").eq(0).html(step_cont_8);
                break;
            case '9':
                $(this).parent().siblings("div").eq(0).html(step_cont_9);
                break;
            case '10':
                $(this).parent().siblings("div").eq(0).html(step_cont_10);
                break;
            default:
        }
    })
    gameselect('#gameselect');
    $(document).on('change','input.myfile',function(){
        if(taskId){
        	var obj =  $(this).parent();
            var timestamp = new Date().getTime();
            var img_id = "id"+timestamp;
            $(this).attr("id",img_id);
            var btn_save = $(this).parent().parent().parent().parent().parent().siblings().eq(1).children(".btn_save");
            btn_save.attr("disabled","disabled");
            $.ajaxFileUpload
            (
                {
                    url:'/IOS_activity/task/ajax-upload-img', //你处理上传文件的服务端
                    type : 'post',
                    fileElementId:img_id,
                    dataType: 'json',
                    success: function (data)
                    {
                        if(data.success=="true"){
                            img_path = data.data;
                            alert("图片上传完毕！");
                            obj.children("input[name='prize_img[]']").val(img_path);
                            btn_save.removeAttr("disabled");
                        }else{
                            alert(data.data);
                        }
                    }
                }
            );
        }
    })
    function check_taskType(type){
        //0普通1子任务2连续
        if(type=="2"){
            $(".linkType").hide();
            $(".step_div").hide();
            $(".step_content").hide();
            $(".allstep").hide();
            $(".sharestep").hide();
            $(".time").show();
            $(".sort").show();
            $(".limitNumbers").show();
            $(".isRecommend").show();
            $(".isLimit").show();
            $(".prizeDiv").hide();
            $(".attendRate").hide();
            $('.task_children_all').show();
            if($("input[name='share']").is(':checked')==true) {
	            $('.task_children_share').show();
	    	}else{
	    	    $('.task_children_share').hide();
	    	}
	    	$(".accessType").show();
        }else{
            if(type=="1"){
                $(".top").hide();
                $(".time").hide();
	            $(".sort").hide();
	            $(".limitNumbers").hide();
	            $(".isRecommend").hide();
	            $(".isLimit").hide();
                $(".attendRate").show();
                $(".accessType").hide();
            }else{
                $(".top").show();
                $(".time").show();
	            $(".sort").show();
	            $(".limitNumbers").show();
	            $(".isRecommend").show();
	            $(".isLimit").show();
                $(".attendRate").hide();
                $(".accessType").show();
            }
            $(".task_children_all").hide();
            $(".task_children_share").hide();
            $(".linkType").show();
            $(".step_div").show();
            $(".step_content").show();
            $(".allstep").show();
            $(".prizeDiv").show();
            if($("input[name='share']").is(':checked')==true) {
	            $('.sharestep').show();
	    	}else{
	    	    $('.sharestep').hide();
	    	}
        }
    }
    
    function check_plizeType(plizeType){
        if (plizeType==1) {
        	$(".prize_radio").parent().parent().parent().parent().parent().find(".div_icon").show();
        	$(".prize_radio").parent().parent().find(".prizeKey").hide();
        } else {
			$(".prize_radio").parent().parent().parent().parent().parent().find(".div_icon").hide();
			$(".prize_radio").parent().parent().find(".prizeKey").show();
        }
    }
    
    function check_plizeType2(plizeType){
        if (plizeType==1) {
        	$(".prize_radio2").parent().parent().parent().parent().parent().find(".div_icon2").show();
        	$(".prize_radio2").parent().parent().find(".prizeKey2").hide();
        } else {
			$(".prize_radio2").parent().parent().parent().parent().parent().find(".div_icon2").hide();
			$(".prize_radio2").parent().parent().find(".prizeKey2").show();
        }
    }
        
    function check_linkType(type){
        if(type=="0"){
            $(".step_div").show().removeAttr("disabled");
            $(".step_content").show().removeAttr("disabled");
            $(".out_url").hide().attr("disabled", "disabled");
        }else{
            $(".step_div").hide().attr("disabled", "disabled");
            $(".step_content").hide().attr("disabled", "disabled");
            $(".out_url").show().removeAttr("disabled");
        }
    }

    function set_step_sort(steptype){
    	var sort=1;
	    $("."+steptype).each(function(){
	    	$(this).children("legend").children("span").html(sort);
	        sort++;
	    })
    }
	set_step_sort("step_1");
	set_step_sort("step_2");
	
    var taskType = "<!--{{selType|default("0")}}-->";
    check_taskType(taskType);
    $("input[name='selTaskType']").on('ifChecked',function(e){
        var check_val = e.currentTarget.value;
        selTaskType = check_val;
        check_taskType(check_val);
    });
    
    var plizeType = "<!--{{atask.prizeList.0.prizeType|default("-1")}}-->";
    check_plizeType(plizeType);
    $(".prize_radio").on('ifChecked',function(e){
        var check_val = e.currentTarget.value;
        check_plizeType(check_val);
    });
    
    $(".prize_radio2").on('ifChecked',function(e){
        var check_val = e.currentTarget.value;
        check_plizeType2(check_val);
    });

    var linkType = "<!--{{atask.linkType|default("0")}}-->";
    check_linkType(linkType);
    $("input[name='selLinkType']").on('ifChecked',function(e){
        var check_val = e.currentTarget.value;
        selLinkType = check_val;
        check_linkType(check_val);
    });

//    $("#show_iframe").click(function(){
//        $("#iframe").show();
//    })

    $('input:radio').iCheck({
        checkboxClass: 'icheckbox_square-orange',
        radioClass: 'iradio_square-orange',
        increaseArea: '20%'
    });

    //组合json
    function set_step_json(steptype){
        var json = "";
        $("."+steptype).each(function(){

            var stepType = $(this).children("legend").children(".stepType").val();
            var json_ = '{"stepType":'+stepType+',"stepCondition":{';
            var conditon = "";
            switch(stepType)
            {
                case '0':
                    var content = $(this).children().eq(1).children("div").eq(0).children("div").children("input").val();
                    conditon += '"content":"'+content+'",';
                    var shout = $(this).children().eq(1).children("div").eq(2).children("div").children("input").val();
                    conditon += '"shout":"'+shout+'"';
                    break;
                case '1':
                    var content = $(this).children().eq(1).children("div").eq(0).children("div").children("input").val();
                    conditon += '"content":"'+content+'",';
                    var uploadPicType =  $(this).children().eq(1).children("div").eq(2).children("div").children("select").val();
                    conditon += '"uploadPicType":"'+uploadPicType+'",';
                    var uploadPicLimit =  $(this).children().eq(1).children("div").eq(2).children("div").children("input").val();
                    conditon += '"uploadPicLimit":"'+uploadPicLimit+'",';
                	var linkValue =  $(this).children().eq(1).children("div").eq(3).children("div").children("input").val();
                	conditon += '"linkValue":"'+linkValue+'"';
                    break;
                case '10':
                    var minlevel = $(this).children().eq(1).children("div").eq(0).children("div").children("input").eq(0).val();
                    conditon += '"minlevel":"'+minlevel+'",';
                    var maxlevel = $(this).children().eq(1).children("div").eq(0).children("div").children("input").eq(1).val();
                    conditon += '"maxlevel":"'+maxlevel+'",';
                    var content = $(this).children().eq(1).children("div").eq(1).children("div").children("input").val();
                    conditon += '"content":"'+content+'",';
                    var uploadPicType =  $(this).children().eq(1).children("div").eq(3).children("div").children("select").val();
                    conditon += '"uploadPicType":"'+uploadPicType+'",';
                    var uploadPicLimit =  $(this).children().eq(1).children("div").eq(3).children("div").children("input").val();
                    conditon += '"uploadPicLimit":"'+uploadPicLimit+'"';
                    break;
                case '2':
                    var content = $(this).children().eq(1).children("div").eq(0).children("div").children("input").val();
                    conditon += '"content":"'+content+'",';
                    var downloadUrl =  $(this).children().eq(1).children("div").eq(1).children("div").children("input").val();
                    conditon += '"downloadUrl":"'+downloadUrl+'",';
                    var gid =  $("#selected_game_id").val();
                    conditon += '"gid":"'+gid+'"';
                    break;
                case '3':
                    var content = $(this).children().eq(1).children("div").eq(0).children("div").children("input").val();
                    conditon += '"content":"'+content+'",';
                    var bundleId = $(this).children().eq(1).children("div").eq(1).children("div").children("input").val();
                    conditon += '"bundleId":"'+bundleId+'",';
                    var gameName =  $(this).children().eq(1).children("div").eq(2).children("div").children("input").val();
                    conditon += '"gameName":"'+gameName+'",';
                    var trialTime =  $(this).children().eq(1).children("div").eq(3).children("div").children("input").val();
                    conditon += '"trialTime":"'+trialTime+'"';
                    break;
                case '4':
                    var minlevel = $(this).children().eq(1).children("div").eq(0).children("div").children("input").eq(0).val();
                    conditon += '"minlevel":"'+minlevel+'",';
                    var maxlevel = $(this).children().eq(1).children("div").eq(0).children("div").children("input").eq(1).val();
                    conditon += '"maxlevel":"'+maxlevel+'",';
                    var content = $(this).children().eq(1).children("div").eq(1).children("div").children("input").val();
                    conditon += '"content":"'+content+'",';
                    var uploadPicType =  $(this).children().eq(1).children("div").eq(3).children("div").children("select").val();
                    conditon += '"uploadPicType":"'+uploadPicType+'",';
                    var uploadPicLimit =  $(this).children().eq(1).children("div").eq(3).children("div").children("input").val();
                    conditon += '"uploadPicLimit":"'+uploadPicLimit+'"';
                    break;
                case '5':
                    var content = $(this).children().eq(1).children("div").eq(0).children("div").children("input").val();
                    conditon += '"content":"'+content+'",';
                    var uploadPicType =  $(this).children().eq(1).children("div").eq(2).children("div").children("select").val();
                    conditon += '"uploadPicType":"'+uploadPicType+'",';
                    var uploadPicLimit =  $(this).children().eq(1).children("div").eq(2).children("div").children("input").val();
                    conditon += '"uploadPicLimit":"'+uploadPicLimit+'"';
                    break;
                case '6':
                    var minlevel = $(this).children().eq(1).children("div").eq(0).children("div").children("input").eq(0).val();
                    conditon += '"minlevel":"'+minlevel+'",';
                    var maxlevel = $(this).children().eq(1).children("div").eq(0).children("div").children("input").eq(1).val();
                    conditon += '"maxlevel":"'+maxlevel+'",';
                    var content = $(this).children().eq(1).children("div").eq(1).children("div").children("input").val();
                    conditon += '"content":"'+content+'",';
                    var uploadPicType =  $(this).children().eq(1).children("div").eq(3).children("div").children("select").val();
                    conditon += '"uploadPicType":"'+uploadPicType+'",';
                    var uploadPicLimit =  $(this).children().eq(1).children("div").eq(3).children("div").children("input").val();
                    conditon += '"uploadPicLimit":"'+uploadPicLimit+'"';
                    break;
                case '7':
                    var minlevel = $(this).children().eq(1).children("div").eq(0).children("div").children("input").eq(0).val();
                    conditon += '"minlevel":"'+minlevel+'",';
                    var maxlevel = $(this).children().eq(1).children("div").eq(0).children("div").children("input").eq(1).val();
                    conditon += '"maxlevel":"'+maxlevel+'",';
                    var content = $(this).children().eq(1).children("div").eq(1).children("div").children("input").val();
                    conditon += '"content":"'+content+'",';
                    var uploadPicType =  $(this).children().eq(1).children("div").eq(3).children("div").children("select").val();
                    conditon += '"uploadPicType":"'+uploadPicType+'",';
                    var uploadPicLimit =  $(this).children().eq(1).children("div").eq(3).children("div").children("input").val();
                    conditon += '"uploadPicLimit":"'+uploadPicLimit+'"';
                    break;
                case '9':
                    var backpackType = $(this).children().eq(1).children("div").eq(0).children("div").children("select").val();
                    conditon += '"backpackType":"'+backpackType+'",';
                    var templateId =  $(this).children().eq(1).children("div").eq(1).children("div").children("div").children("input").eq(0).val();
                    conditon += '"templateId":"'+templateId+'",';
                    var templateName =  $(this).children().eq(1).children("div").eq(1).children("div").children("div").children("input").eq(1).val();
                    conditon += '"templateName":"'+templateName+'"';
                    break;
                case '8':
                    conditon += '"recharge":{';
                    $.each($('.limitValue'), function(key, value){
                        var tempLimitValue = $(this).val();
                        var tempRewardValue = $('.rewardValue').eq(key).val();
                        conditon += '"'+tempLimitValue+'":"'+tempRewardValue+'",';
                    });
                    conditon = conditon.substring(0,conditon.length-1);
                    conditon += '}';
                    break;

                default:
            }
            json_ += conditon+"}}";
            json += json_+",";
        })

        json = json.substring(0,json.length-1);
        return json;
    }


    //根据‘任务类型’调整附加内容
    function set_taskType(type){
        if (type == '3') {
            $('.f_running').show().removeAttr("disabled");
            $(".f_share").hide().attr("disabled", "disabled");
            $("#dd_total_time").show().removeAttr("disabled");
            $("input[name='game_package_name']").show().removeAttr("disabled").parent().parent().show();
            $("input[name='linkValue_']").show().removeAttr("disabled").parent().parent().show();
        } else if (type == "1") {
            $('.f_running').show().removeAttr("disabled");
            $(".f_share").hide().attr("disabled", "disabled");
            $("#dd_total_time").hide().attr("disabled", "disabled");
            $("input[name='game_package_name']").show().removeAttr("disabled").parent().parent().show();
            $("input[name='linkValue_']").show().removeAttr("disabled").parent().parent().show();
        } else if (type == "2") {
            $('.f_share').show().removeAttr("disabled");
            $(".f_running").hide().attr("disabled", "disabled");
            $("input[name='game_package_name']").hide().attr("disabled", "disabled").parent().parent().hide();
            $("input[name='linkValue_']").hide().attr("disabled", "disabled").parent().parent().hide();
        }
    }
    complete_type = $("#complete_type").val();
    set_taskType(complete_type);
    $('#complete_type').change(function(){
        var type = $(this).val();
        set_taskType(type);
    });

    //根据‘奖励类型’调整附加内容
    function set_prizeType(obj){
        var type = obj.val();
        if(type == 'youb'){
            obj.parent().parent().next("div").children(".price1").show();
            obj.parent().parent().next("div").children(".price2").hide();
        }else{
            obj.parent().parent().next("div").children(".price2").show();
            obj.parent().parent().next("div").children(".price1").hide();
        }
    }

    $(".sel_prize").each(function(){
        var obj = $(this);
        set_prizeType(obj);
    })
    $(".sel_prize").live('change',function(){
        var obj = $(this);
        set_prizeType(obj);
    })



    //提交时限制图片为空
    $(".sub").click(function() {
        var ids = "";
        var ids2 = "";
        if(selTaskType!="2"&&selLinkType=="0"){
            var stepListStr = set_step_json("step_1");
            $("input[name='stepListStr']").val(stepListStr);
            var stepListStr_2 = set_step_json("step_2");
            $("input[name='stepListStr_2']").val(stepListStr_2);
        }
        if(selTaskType!="1"){
	        if($('input[name="limitNumbers"]').val()!="" && $('input[name="limitNumbers"]').val()<=0){
	            alert("限定参与人数必须大于零");
	        	return false;
	        }
	        if($('input[name="limitHours"]').val()!="" && $('input[name="limitHours"]').val()<=0){
	            alert("限定参与时间必须大于零");
	        	return false;
	        }
        }
        if($(".step_content").html()=="" && $('input[name="selTaskType"]:checked').val()!=2){
        	alert("步骤不能为空");
        	return false;
        }
        var can_on = 1;
	    $(".minpic").each(function(){
	        if($(this).val()<1){
	        	alert("上传图片数必须大于等于1");
	        	can_on = 0;
	        	return false;
	        }
	    })
		if(can_on == 0){
			return false;
		}
        if($('input[name="isLimit"]:checked').val()==1){
			
        	if($('input[name="start_time"]').val()>$('input[name="limitStartTime"]').val()){
	        	alert("限制开始时间不能早于任务开始时间");
	        	return false;
        	}
        	if($('input[name="limitEndTime"]').val()>$('input[name="end_time"]').val()){
	        	alert("限制结束时间不能晚于任务结束时间");
	        	return false;
        	}
        }
        $("#editable").children("li").each(function(){
            var taskId = $(this).attr("taskId");
            ids +=taskId+",";
            var startTime1 = $(this).attr("startTime");
                startTime1 = startTime1.replace(/-/g,"/");
                startTime1 = new Date(Date.parse(startTime1));

            var endTime1 = $(this).attr("endTime");
                endTime1 = endTime1.replace(/-/g,"/");
                endTime1 = new Date(Date.parse(endTime1));
            if($(this).next("li").html()){
                var startTime2 = $(this).next("li").attr("startTime");
                    startTime2 = startTime2.replace(/-/g,"/");
                    startTime2 = new Date(Date.parse(startTime2));
                var endTime2 = $(this).next("li").attr("endTime");
                    endTime2 = endTime2.replace(/-/g,"/");
                    endTime2 = new Date(Date.parse(endTime2));
                //比较开始和结束时间的大小---
//                if(!(startTime1<startTime2&&endTime1<endTime2)){
//                    alert("子任务排序错误");
//                    return false;
//                }
            }

        });
        $(".ids").val(ids);
        $("#editable2").children("li").each(function(){
            var taskId = $(this).attr("taskId");
            ids2 +=taskId+",";
            var startTime1 = $(this).attr("startTime");
                startTime1 = startTime1.replace(/-/g,"/");
                startTime1 = new Date(Date.parse(startTime1));

            var endTime1 = $(this).attr("endTime");
                endTime1 = endTime1.replace(/-/g,"/");
                endTime1 = new Date(Date.parse(endTime1));
            if($(this).next("li").html()){
                var startTime2 = $(this).next("li").attr("startTime");
                    startTime2 = startTime2.replace(/-/g,"/");
                    startTime2 = new Date(Date.parse(startTime2));
                var endTime2 = $(this).next("li").attr("endTime");
                    endTime2 = endTime2.replace(/-/g,"/");
                    endTime2 = new Date(Date.parse(endTime2));
                //比较开始和结束时间的大小---
//                if(!(startTime1<startTime2&&endTime1<endTime2)){
//                    alert("子任务排序错误");
//                    return false;
//                }
            }

        });
        $(".ids2").val(ids2);
//        return false;
    })

//    var editor = UE.getEditor('container');
    //$('input.datetimepicker').datetimepicker({format: 'Y-m-d H:i:s', lang: 'ch'});//时间插件



//    $(".f_share").hide().attr("disabled","disabled");
//    $("#dd_total_time").hide().attr("disabled", "disabled");

//选择游戏
    $('.select-pop-game').bind('click', function () {
        $.ajax({
            url: '/game/api/game-search',
            dataType: 'json',
            success: function (json) {
                var html = json.html;
                $.dialog({id: 'pop-game-list', title: '提示', padding: 2, content: html, width: 600, height: 580});
            }
        });
    });

    //选择活动弹窗
    $('.select-pop-variation').live('click',function(){
        var url =  '/duang/variation/variation-search';
        $.ajax({
            url:url,
            dataType:'json',
            success:function(json){
                var html = '';
                html = json.html;
                $.dialog({id:'pop-variation-list',title:'提示',padding:2,content:html,width:600});
            }
        });
    });

    //选择子任务
    $(".select-task-code").live('click',function(){
    	var appType=$('input:radio[name="appType"]:checked').val();
        $.ajax({
            url:'/IOS_activity/task/iframe-children-task',
            data:{appType:appType},
            dataType:'json',
            success:function(json){
                var html = json.html;
                $.dialog({id:'pop-task-list',title:'提示',padding:2,content:html,width:650,height:500});
            }
        });
    });
    $(".select-task-code-2").live('click',function(){
    	var appType=$('input:radio[name="appType"]:checked').val();
        $.ajax({
            url:'/IOS_activity/task/iframe-children-task',
            data:{appType:appType,shareType:2},
            dataType:'json',
            success:function(json){
                var html = json.html;
                $.dialog({id:'pop-task-list',title:'提示',padding:2,content:html,width:650,height:500});
            }
        });
    });
    
	//选择礼包
    $(".select-card-code").live('click',function(){
        obj2 = $(this);
        //var val=$('input:radio[name="platforms"]:checked').val();
        //if(val != 'android' && val.length>0){
        //    val = 'ios';
        //}
        var val = 'ios';
        $.ajax({
            url:'/v4giftbag/package/cate-card-select',
            data:{virtualUse:3,platform:val},
            dataType:'json',
            success:function(json){
                var html = json.html;
                $.dialog({id:'pop-card-list',title:'提示',padding:2,content:html,width:600,height:580});
            }
        });
    });
    
    $("#get_gift_new").on('click',function(){
        if($('input[name="card_des[1]"]').val().length == 0){
            alert('分配前请选择礼包!');
            return false;
        }
        var num = parseInt($(this).parent().prev().children(":last").children(":last").html());
        var n = parseInt($(this).prev().val());
        var t = parseInt($('input[name="totalCount[1]"]').val());

        if(num.length == 0 || num == undefined || num == 0 || num == '' || isNaN(num)){
            alert('分配前请重新选择礼包!');
            return false;
        }
        var re = /^([1-9]\d*|[0]{1,1})$/;
        if(isNaN(n) || !re.test(n)){
            alert('请输入有效分配数!');
            return false;
        }
        if(n>num){
            alert('分配数大于总数!');
            return false;
        }
        if(n_new == n && n_new != 0){
            return false;
        }
        n_new = n;
        if(count_new == 0){
            num_new = num;
            t_new = t;
        }
        var e = num_new-n;
        if(e>0){
            count_new = count_new + 1;
        }
        $(this).parent().prev().children(":last").children(":last").html(e);
        $(this).prev().prev().val(n+t_new);
        $('input[name="card_change[1]"]').val('1');
    })
    $("#get_gift_old").on('click',function(){
        if($('input[name="card_des[2]"]').val().length == 0){
            alert('分配前请选择礼包!');
            return false;
        }
        var num = parseInt($(this).parent().prev().children(":last").children(":last").html());
        var n = parseInt($(this).prev().val());
        var t = parseInt($('input[name="totalCount[2]"]').val());
        if(num.length == 0 || num == undefined || num == 0 || num == '' || isNaN(num)){
            alert('分配前请重新选择礼包!');
            return false;
        }
        var re = /^([1-9]\d*|[0]{1,1})$/;
        if(isNaN(n) || !re.test(n)){
            alert('请输入有效分配数!');
            return false;
        }
        if(n>num){
            alert('分配数大于总数!');
            return false;
        }
        if(n_old == n && n_old != 0){
            return false;
        }
        n_old = n;
        if(count_old == 0){
            num_old = num;
            t_old= t;
        }
        var e = num_old-n;
        if(e>0){
            count_old = count_old + 1;
        }

        $(this).parent().prev().children(":last").children(":last").html(e);
        $(this).prev().prev().val(n+t_old);
        $('input[name="card_change[2]"]').val('1');
    })
     
    $('span.select-templateId').live('click',function(){
        $.ajax({
            url:'/v4product/goods/template-select-list',
            dataType:'json',
            success:function(json){
                var html = '';
                html = json.html;
                $.dialog({id:'template-select-list',title:'提示',padding:2,content:html,width:600,height:580});
            }
        });
    });
        
    $(".btn_del").live('click',function(){
        if(confirm("删除后无法恢复，确认删除？")){
        	var c = $(this).parent().parent().parent().find("fieldset").attr('class');
            var stepId = $(this).siblings(".btn_save").attr("stepId");
            if(stepId){
                $.post('<!--{{url('IOS_activity/task/step-del')}}-->',{stepId:stepId},function(data){
                    if(data.success=="true"){
                        alert(data.mess);
                    }
                },"json")
            }
            $(this).parent().parent().remove();
            set_step_sort(c);
        }
    });
    if(taskId){
        $(".taskType").children().attr("disabled","disabled");
        var sel_val = "<!--{{atask.prizeList.0.prizeType}}-->";
        $(".prize_radio").each(function(){

            if($(this).val()!=sel_val){
                //$(this).attr("disabled","disabled");
            }
        });
        if(sort == "100"){
            $(".top").attr("checked","checked");
        }
        if(selType == "2"){
            $(".step_div").remove();
        }
    }
})

var set_selected_game=function(game_id,game_name,icon){
    $('#selected_game_id').val(game_id);
    $('#selected_game_name').val(game_name);
    $('#selected_game_icon').attr('src',icon);
    $("#task_img").val(icon);
};
function set_selected_card(card_code,card_name,card_stock,can_use,card_gid){
    card_code1 = card_code;
    card_name1=card_name;
    can_use1=parseInt(can_use);
    card_gid1=card_gid;
    //obj2.parent().parent().parent().parent().find("img").attr("src",card_img);
    obj2.parent().parent().parent().find(".xxx").val(0);
    obj2.parent().parent().parent().parent().find("input[name='prize_img[]']").val(card_img);
    obj2.parent().parent().parent().parent().find("input[name='prize_img_new[]']").val(card_img);
    $(function(){
        obj2.siblings(".selected_cardCode").val(card_code1);
        obj2.siblings(".selected_card_name").val(card_name1);
        obj2.siblings(".selected_card_gid").val(card_gid1);
        obj2.siblings(".can-use").children().html(can_use1);
        obj2.siblings(".prize_gid").val(prize_gid);
    })
}
function set_selected_variation(activity_id,share_title,share_pic,share_des,share_url){
    $("input[name='share_icon']").val(share_pic);
    $("input[name='share_title']").val(share_title);
    $("input[name='share_desc']").val(share_des);
    $("input[name='share_desc']").val(share_url);
    $("#share_img").attr("src",share_pic);
}

//var el = document.getElementById('editable');
//new Sortable(el);
$(".js-remove").live('click',function(){
    $(this).parent().remove();
})

$(function() {
    $("input[name='isRecommend']:radio").each(function(){
        if(true == $(this).is(':checked')){
            if($(this).val() == 1){
                $('#pic_isRecommend').show();
            }
        }
    });
    $("input[name='isRecommend']").on('ifChecked', function () {
        if ($(this).val() == 1) {
            $('#pic_isRecommend').show();
        } else {
            $('#pic_isRecommend').hide();
        }
        return false;
    })
})

</script>
<!--{%endblock%}-->