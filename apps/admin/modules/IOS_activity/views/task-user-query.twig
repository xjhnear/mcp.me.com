<!--{%extends "base-layout.twig"%}-->
<!--{%block main_content%}-->
<div class="row-fluid">
	<div class="span12">
	    <div class="box box-color box-bordered">
			<div class="box-title">
				<h3>
					<i class="icon-table"></i>
					用户任务报表<span class="badge badge-info"><!--{{totalCount}}--></span>
				</h3>
				<div class="actions">
				    <form action="<!--{{url('a_activity/atask/query-task-user')}}-->" method="GET">
				    <input name="atid" type="hidden" value="<!--{{atid}}-->" />
				    <table class="table-filter">
				        <tr>
				            <td>
				                <div class="input-append date datepick" id="dpStart" data-date="">
									<input name="start_time" type="text" class="input-small" value="<!--{{search.start_time}}-->" readonly="">
									<span class="add-on"><i class="icon-calendar"></i></span>
								</div>
				            </td>
				            <td>
				                <div class="input-append date datepick" id="dpEnd" data-date="">
									<input name="end_time" type="text" class="input-small" value="<!--{{search.end_time}}-->" readonly="">
									<span class="add-on"><i class="icon-calendar"></i></span>
								</div>
							</td>
				            <td>
				                <!--{{form_select('complete_status',complete_status_list,complete_status,{'style':'margin-top:10px;width:80px'})}}-->
				            </td>
				            <td>
				                <!--{{form_select('reward_status',reward_status_list,reward_status,{'style':'margin-top:10px;width:80px'})}}-->
				            </td>
				            <td>
				                <input id="userselect" name="uid" type="hidden" value="<!--{{uid}}-->" class="bigdrop select2-offscreen" style="width:200px" tabindex="-1">
				            </td>
				            <td><button class="btn btn-teal"><i class="icon-search"></i>搜索</button></td>
				        </tr>
				    </table>
				    </form>
				</div>
			</div>
			<div class="box-content nopadding">
			    <table class="table table-hover table-nomargin" >
			        <thead>
						<tr>
						    <th class="col-50">ID</th>
						    <th class="col-150">任务标题</th>
							<th class="col-100">用户名</th>
                            <th class="col-50"></th>
							<th class="col-60">完成状态</th>
							<th class="col-60">奖励状态</th>
							<th>参加时间</th>
                            <th></th>
                            <!--<th>黑名单状态</th>
                            <th>黑名单操作</th>
                            -->
						</tr>
					</thead>
					<tbody>
					    <!--{%for item in datalist%}-->
						<tr >
							<td><!--{{item.uid}}--></td>
							<td><!--{{tasks[item.atid]['title']}}--></td>
							<td><!--{{users[item.uid]['nickname']}}--></td>
                            <td ><a class="btn-primary badge badge-info b_button" nickname="<!--{{users[item.uid]['nickname']}}-->" b_uid="<!--{{item.uid}}-->"   <!--{%if item.black==0 %}--> data-toggle="modal" <!--{%endif%}--> data-target="#exampleModal" data-whatever="@mdo" href="javascript:viod(0);" ><!--{%if item.black==0 %}-->拉黑<!--{%else%}-->已拉黑<!--{%endif%}--></a> </td>
							<td>
							<!--{%if item.complete_status==1%}--><span class="badge badge-info">已完成</span><!--{%endif%}-->
							<!--{%if item.complete_status==2%}--><span class="badge badge-info">待审核</span><!--{%endif%}-->
							<!--{%if item.complete_status==3%}--><span class="badge badge-info">未通过</span><!--{%endif%}-->
							</td>							
							<td>
							    <!--{%if item.reward_status==1%}--><span class="badge badge-info">已奖励</span><!--{%endif%}-->
							    <!--{%if item.reward_status==0%}--><span class="badge badge-info">未奖励</span><!--{%endif%}-->
							    <!--{%if item.reward_status==-1%}--><span class="badge error-info">失败</span><!--{%endif%}-->
							</td>
							<td><!--{{item.create_time|date('Y-m-d H:i:s')}}--></td>
							<td>
							<!--{%if tasks[item.atid]['action_type']==1 and tasks[item.atid]['complete_type']=='screenshot'%}-->
							<a href="#screenshot" data-url="<!--{{url('a_activity/atask/look-screenshot')}}-->?atid=<!--{{item.atid}}-->&uid=<!--{{item.uid}}-->" class="btn btn-primary look-screenshot" data-toggle="modal">查看截屏</a>
							<!--{%if item.complete_status==2 or item.complete_status==3%}-->
							<a href="<!--{{url('a_activity/atask/do-complete-screenshot')}}-->?id=<!--{{item.id}}-->&complete_status=1&atid=<!--{{item.atid}}-->" class="btn btn-primary ajax-confirm">通过审核</a>
							<a href="<!--{{url('a_activity/atask/do-complete-screenshot')}}-->?id=<!--{{item.id}}-->&complete_status=3&atid=<!--{{item.atid}}-->" class="btn btn-primary ajax-confirm">截图不符</a>
							<!--{%endif%}-->
							<!--{%endif%}-->
							<!--{%if tasks[item.atid]['action_type']==3%}-->
							
							<a href="<!--{{url('a_activity/atask/do-complete-recharge')}}-->?id=<!--{{item.id}}-->&complete_status=1&atid=<!--{{item.atid}}-->" class="btn btn-primary ajax-confirm">已完成充值</a>
							<a href="<!--{{url('a_activity/atask/do-complete-recharge')}}-->?id=<!--{{item.id}}-->&complete_status=3&atid=<!--{{item.atid}}-->" class="btn btn-primary ajax-confirm">未完成充值</a>
							<a href="#recharge" data-url="<!--{{url('a_activity/atask/recharge-info')}}-->?atid=<!--{{item.atid}}-->&uid=<!--{{item.uid}}-->" class="btn btn-primary ajax-info" data-toggle="modal">查看充值信息</a>
							<!--{%endif%}-->
							<!--{%if item.complete_status==1%}-->
							<!--{%if item.reward_status==0%}-->
							<a href="<!--{{url('a_activity/atask/do-reward')}}-->?id=<!--{{item.id}}-->&atid=<!--{{item.atid}}-->" class="btn btn-primary ajax-confirm">重新发放奖励</a>
							<!--{%endif%}-->
							<!--{%endif%}-->
							</td>
                            <!--<td class="b_time">2015-09-09至2015-09-11</td>
                            <td>
                                <button id="b_button" type="button" class="btn btn-primary" b_uid="<!--{{item.uid}}-->" b_id="" data-toggle="modal" data-target="#exampleModal" data-whatever="@mdo">编辑</button>
                                <button id="b_clear" type="button" class="btn btn-primary" b_uid="<!--{{item.uid}}-->" b_id=""  >清除</button>
                            </td>
                            -->
						</tr>
						<!--{%endfor%}-->
					</tbody>
			    </table>
			    <div class="pagelink">
			        <!--{{pagelinks}}-->
			    </div>
			    
			    <div class="modal fade" id="screenshot" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
				  <div class="modal-dialog">
				    <div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
						<h3 id="myModalLabel">游戏截图</h3>
					</div>
				    <div id="screenshot-list" class="modal-content">				      
				    </div>
				    <div class="modal-footer">
				        <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
				    </div>
				  </div>
				</div>
			    
			    <div class="modal fade" id="recharge" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
				  <div class="modal-dialog">
				    <div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
						<h3 id="myModalLabel">充值信息</h3>
					</div>
				    <div id="recharge-info" class="modal-content">				      
				    </div>
				    <div class="modal-footer">
				        <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
				    </div>
				  </div>
				</div>
			    
			</div>
		</div>
	</div>
</div>

<!--{#模态框#}-->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="exampleModalLabel">加入黑名单-- <lable id="b_name"></lable></h4>
            </div>
            <div class="modal-body">
                <form>
                    <div class="form-group">
                        <label for="recipient-name" class="control-label">天数:</label>
                        <input type="text" class="form-control" id="date_num" name="date_num" onkeyup="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'')}else{this.value=this.value.replace(/\D/g,'')}"
                               onafterpaste="if(this.value.length==1){this.value=this.value.replace(/[^1-9]/g,'0')}else{this.value=this.value.replace(/\D/g,'')}" >
                        <label id="num_Warning" style="color: red;display: none" >*天数不能为空或者0</label>
                    </div>
                    <div class="form-group">
                        <label for="message-text" class="control-label">备注:</label>
                        <textarea class="form-control" id="b_memo" name="b_memo"></textarea>
                    </div>
                    <input type="hidden"  id="b_uid" name="b_uid" value="" />
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary"  id="save_blacklist">Save</button>
            </div>
        </div>
    </div>
</div>

<!--{%endblock%}-->

<!--{%block footer_js%}-->
<script>
$(function(){  
    userselect('#userselect');
    $('a.ajax-confirm').bind('click',function(){
        if(!confirm('确定要执行吗？')){
            return false;
        }
    });
    
    $('a.look-screenshot').bind('click',function(){
        var url = $(this).attr('data-url');
        $.getJSON(url,function(json){
            $('#screenshot-list').html(json.html);
        });
    });
    
    $('a.ajax-info').bind('click',function(){
        var url = $(this).attr('data-url');
        $.getJSON(url,function(json){
            $('#recharge-info').html(json.html);
        });
    });

    $(".b_button").click(function(){
        $("#b_uid").val();
        var b_uid = $(this).attr("b_uid");
        $("#b_uid").val(b_uid);

        $("#b_name").html();
        var b_name = $(this).attr("nickname");
        $("#b_name").html(b_name);
    })
    $("#save_blacklist").click(function(){
        var but = $(this);
        but.attr("disabled","disabled");
        var b_uid =  $("#b_uid").val();//用户id
        var uname =  $("#b_name").html();//用户名
        var date_num = $("#date_num").val();//限定天数
        var b_memo = $("#b_memo").val();
        if(date_num==""){
            $("#num_Warning").show();
            but.removeAttr("disabled");
            return false;
        }else{
            $("#num_Warning").hide();
            $.post("<!--{{url('a_activity/atask/task-blacklist-save')}}-->",{'date_num':date_num,'memo':b_memo,'uid':b_uid,'uname':uname},function(data){
                if(data.success==true){
                    $("a[b_uid='"+b_uid+"']").html("已拉黑").attr("data-toggle","")
                    $(".fade").hide();
                    but.removeAttr("disabled");
                }else{
                    alert(data.mess);
                }
            },"json")
        }
    })
});    
</script>
<!--{%endblock%}-->