<!--{%extends "base-layout.twig"%}-->
<!--{%block main_content%}-->
<div class="row-fluid">
    <div class="span12">
		<div class="box">
			<div class="box-title">
				<h3><i class="icon-edit"></i>通知信息</h3>
			</div>
			<div class="box-content">
				<form id="form-message" action="<!--{{url('v4message/push/save')}}-->" method="POST" class="form-horizontal form-validate">
				<input name="id" type="hidden" value="<!--{{notice.id}}-->" />										

                <div class="control-group">
                        <div class="control-group">
                            <label class="control-label">平台</label>
                            <div class="controls">
                                <!--{{form_checkbox('appname[]','yxdjqb',1==1)}}-->玩家版
                                <!--{{form_checkbox('appname[]','youxiduojiu3',1==1)}}-->业内版
                                <!--{{form_checkbox('appname[]','youxiduobeiyong2',1==1)}}-->备用版
                            </div>
                        </div>
                </div>
                
				<div class="control-group">
					<label for="textfield" class="control-label">消息内容</label>
					<div class="controls">
						<textarea id="notice" name="content" class="input-xxlarge" rows="5" data-rule-required="true" data-msg-required="内容不能为空"><!--{{notice.content}}--></textarea>
					</div>
				</div>
				<!--{#
				<div class="control-group">
					<label for="textfield" class="control-label">推送</label>
					<div class="controls">
					    <label class="checkbox inline"><!--{{form_checkbox('is_push',1,notice.is_push==1)}}-->消息推送</label>
					</div>
				</div>
				#}-->

                    <div class="row-fluid" id="radio">
                        <div class="span4">
                            <div class="control-group">
                                <label class="control-label">链接类型：</label>
                                <div class="controls">
                                    <!--{{form_select('linktype',linkTypeList,notice.linktype,{'id':'href_type'})}}-->
                                </div>
                            </div>
                        </div>
                        <div class="span4" id="span_search" style="display: none">
                            <div class="control-group">
                                <label class="control-label">检索功能：</label>
                                <div class="controls">
                                    <input name="searchName" style="width: 122px;" id="search_name" type="text" class="input-medium" value="" >
                                </div>
                            </div>
                        </div>
                    </div>
				<div class="control-group">
					<label for="textfield" class="control-label">链接参数</label>
					<div class="controls">
						<input type="text" id="link_id" name="link" class="input-xxlarge" value="<!--{{notice.link}}-->">
                        <input type="hidden" id="gameId" name="gameId" />
                        <input type="hidden" id="other" name="other" />
						<span class="help-block">当链接类型为游戏推荐时此处填游戏ID</span>
					</div>
				</div>
				<div class="control-group">
					<label for="textfield" class="control-label">
					定向发送
					<input name="msgtype" type="radio" class="validate[required]" value="1">
					</label>
					<div class="controls">
						<textarea id="to_uids" name="to_uids" class="input-xxlarge input-selected-uids" rows="3"></textarea>
						<span class="help-inline">此处填写用户的UID,多个用户之间用<b style="color:red">逗号(英文)</b>分割</span>
					</div>
				</div>
				<div class="control-group">
					<label for="textfield" class="control-label">全局推送 <input name="msgtype" type="radio" class="validate[required]" value="2"></label>
				</div>
				<div class="form-actions">
					<button id="submit-btn" type="submit" class="btn btn-primary"><i class="icon-ok"></i>保存</button>
				</div>    
				</form>
			</div>
		</div>
    </div>
</div>
<!--{%endblock%}-->
<!--{%block footer_js%}-->
<script src="/static/js/jquery.validationEngine.js" ></script>
<script src="/static/js/jquery.validationEngine-en.js" ></script>
<link rel="stylesheet" href="<!--{{asset('/static/js/autosuggest_v2.1.3/css/autosuggest_inquisitor.css')}}-->">
<script src="<!--{{asset('/static/js/autosuggest_v2.1.3/js/bsn.AutoSuggest_2.1.3.js ')}}-->"></script>

<script type="text/javascript">
jQuery(document).ready(function(){
	// binds form submission and fields to the validation engine
	jQuery("#form-message").validationEngine();
	$("#submit-btn").click(function(){
		if($("input[name='msgtype']:checked").val() == 1 && !$.trim($("#to_uids").val())){
			alert("定向发送请填写用户UID");return false;
		}
	});

    $("#href_type").change(function(){
        var Value=$(this).find("option:selected").text();

        if(Value == '手游新闻详情'){
            Value='新闻文章';
        }else if(Value == '手游新闻详情'){
            Value='新闻文章';
        }else if(Value == '新游预告详情'){
            Value='新游预告';
        }
        //var arr_=['专题','新游预告','新闻文章','礼包详情','视频详情','任务详情','商品详情','指定聊天室','游戏详情'];
        var arr_=['专题','新游预告','新闻文章','礼包详情','活动详情','视频详情','商品详情','任务详情','指定聊天室','游戏详情'];
        if(jQuery.inArray(Value,arr_)!=-1){
            $('#span_search').fadeIn();
            span_search(Value);
        }else{
            $('#span_search').fadeOut();
        }
    });
});
function span_search(Value){
    var options = {
        script: "/v4message/push/autosearch?key="+Value+"&",
        varname: "variableName",
        json: true,
        maxresults: 35,
        callback:function(object){
            $("#link_id").val(object.id).attr('readonly','readonly');
            $("#gameId").val(object.info).attr('readonly','readonly');
            $("#other").val(object.other).attr('readonly','readonly');
//            var str = JSON.stringify(object);
//            alert(str);
        }
    };
    var as_json = new bsn.AutoSuggest('search_name', options);
//    return as_json;
}
</script>
<!--{%endblock%}-->   