<!--{%extends "sub-layout-giftbag.twig"%}-->
<!--{%block main_content%}-->
<div class="row-fluid">
	<div class="span12">
		<div class="box">
			<div class="box-title">
				<h3><i class="icon-edit"></i>编辑礼包信息</h3>
			</div>
			<div class="box-content">
				<form id="gift-info-form" action="<!--{{url('v4agiftbag/gift/edit')}}-->" method="POST" class='form-horizontal form-validate' enctype="multipart/form-data">
					<input type="hidden" name="product_code" value="<!--{{ result.productCode }}-->">
					<div class="control-group">
						<label class="control-label">名称</label>
						<div class="controls">
							<input type="text" name="title" class="input-large" value="<!--{{ result.productName }}-->" data-rule-required="true" data-msg-required="请填写名称"/>
						</div>
					</div>
					<div class="control-group">
						<label class="control-label">关联游戏</label>
						<div class="controls">
							<div class="input-append">
								<input id="selected_game_id" name="game_id" type="hidden" value="<!--{{ result.game_info.gid }}-->"/>
								<img id="selected_game_icon" class="add-on" src="<!--{{ result.game_info.ico }}-->"/>
								<input type="text" id="selected_game_name" name="game_name" class="input-medium" value="<!--{{ result.game_info.shortgname }}-->" data-rule-required="true" data-msg-required="关联游戏不能为空" />
								<span class="add-on select-pop-game">选择游戏</span>
							</div>
						</div>
					</div>
					<div class="control-group">
						<label for="textfield" class="control-label">礼包种类</label>
						<div class="controls">
							<div class="input-append">
								<input id="selected_categoryId" name="category_id" value="<!--{{ result.category.categoryId }}-->" type="hidden"/>
								<input type="text" id="selected_cate_name" readonly class="input-medium" value="<!--{{ result.category.categoryName }}-->" data-rule-required="true" data-msg-required="请选择种类" />
								<span class="add-on select-pop-cate">选择种类</span>
							</div>
						</div>
					</div>
					<div class="control-group">
						<label for="textfield" class="control-label">类型</label>
						<div class="controls">
							<select name="invented_type">
								<option <!--{{ result.inventedType == 0 ? 'selected' : '' }}--> value="0">普通卡密</option>
								<option <!--{{ result.inventedType == 1 ? 'selected' : '' }}--> value="1">礼包码</option>
							</select>
						</div>
					</div>
					<div class="control-group" id="select_cardCode">
						<label for="textfield" class="control-label">卡密</label>
						<div class="controls">
							<div class="input-append">
								<input id="selected_cardCode" name="card_code" value="<!--{{ result.cardCode }}-->" type="hidden"/>
								<input type="text" id="selected_card_name" readonly class="input-medium" value="<!--{{ card_name }}-->" data-rule-required="true" data-msg-required="请选择卡密" />
								<span class="add-on select-card-code">选择卡密</span>
							</div>
						</div>
					</div>
					<div class="row-fluid">
						<div class="span4">
							<div class="control-group">
								<label class="control-label">开始时间</label>
								<div class="controls">
									<div class="input-append date">
										<input name="start_time" type="text" class="input-medium datetimepicker" value="<!--{{ result.startTimeStr }}-->" readonly="">
										<span class="add-on"><i class="icon-calendar"></i></span>
									</div>
								</div>
							</div>
						</div>
						<div class="span4">
							<div class="control-group">
								<label class="control-label">结束时间</label>
								<div class="controls">
									<div class="input-append date">
										<input name="end_time" type="text" class="input-medium datetimepicker" value="<!--{{ result.endTimeStr }}-->" readonly="">
										<span class="add-on"><i class="icon-calendar"></i></span>
									</div>
								</div>
							</div>
						</div>
					</div>

					<div class="control-group">
						<label class="control-label">属性</label>
						<div class="controls">
							<label class="checkbox inline">
								<!--{{form_checkbox('is_hot',1,result.isHot)}}-->热门
							</label>
							<label class="checkbox inline">
								<!--{{form_checkbox('is_top',1,result.isTop)}}-->置顶
							</label>
							<label class="checkbox inline">
								<!--{{form_checkbox('is_new',1,result.isNewest)}}-->最新
							</label>
							<label class="checkbox inline">
								<!--{{form_checkbox('is_recommend',1,result.isRecommend)}}-->推荐
							</label>
						</div>
					</div>
					<div class="control-group">
						<label class="control-label">专属礼包</label>
						<div class="controls">
							<input id="exclusive-switch" name="is_exclusive" <!--{{ result.isExclusive ? 'checked' : '' }}--> data-on-color="success" data-on-text="专属" data-off-color="danger" data-off-text="无" class="switchbox" type="checkbox"/>
						</div>
					</div>
					<div id="exclusive" style="display: none;" class="row-fluid">
						<div class="control-group">
							<label class="control-label">用户ID</label>
							<div class="controls">
								<textarea id="account_ids" name="account_ids" class="input-xlarge validate[condRequired[exclusive-switch]]"><!--{{ result.accountList }}--></textarea>
								<label>注：每个ID间请用逗号<span class="text-warning">（英文）</span>分割</label>
							</div>
						</div>
					</div>
					<div class="row-fluid">
						<div class="span3">
							<div class="control-group">
								<label class="control-label">游币</label>
								<div class="controls">
									<input type="text" name="coin" value="<!--{{ result.productGamePrice }}-->" class="input-small" data-rule-required="true" data-msg-required="请填写游币"/>
								</div>
							</div>
						</div>
						<div class="span3">
							<div class="control-group">
								<label class="control-label">售价（RMB）</label>
								<div class="controls">
									<input type="text" name="sell_price" value="<!--{{ result.productPrice }}-->" class="input-small" data-rule-required="true" data-msg-required="请填写售价"/>
								</div>
							</div>
						</div>
						<div class="span3">
							<div class="control-group">
								<label class="control-label">成本（RMB）</label>
								<div class="controls">
									<input type="text" name="cost_price" class="input-small" value="<!--{{ result.productCost }}-->" />
								</div>
							</div>
						</div>
					</div>
					<div class="row-fluid">
						<div class="span3">
							<div class="control-group">
								<label class="control-label">库存</label>
								<div class="controls">
									<input type="text" name="stock" class="input-small" value="<!--{{ result.totalCount }}-->" data-rule-required="true" data-msg-required="请填写库存"/>
								</div>
							</div>
						</div>
						<div class="span3">
							<div class="control-group">
								<label class="control-label">限领数</label>
								<div class="controls">
									<input type="text" name="limit" class="input-small" value="<!--{{ result.singleLimit }}-->" />
								</div>
							</div>
						</div>
						<div class="span3">
							<div class="control-group">
								<label class="control-label">排序</label>
								<div class="controls">
									<input type="text" name="sort" class="input-small" value="<!--{{ result.productSort }}-->" />
								</div>
							</div>
						</div>
					</div>
					<div class="control-group">
						<label for="textfield" class="control-label">礼包简介</label>
						<div class="controls">
							<script id="summary" name="summary" type="text/plain"><!--{{ result.productSummary }}--></script>
						</div>
					</div>
					<div class="control-group">
						<label for="textfield" class="control-label">礼包说明</label>
						<div class="controls">
							<script id="intro" name="intro" type="text/plain"><!--{{ result.productInstruction }}--></script>
						</div>
					</div>
					<div class="control-group">
						<label for="textfield" class="control-label">礼包备注</label>
						<div class="controls">
							<script id="des" name="des" type="text/plain"><!--{{ result.productDesc }}--></script>
						</div>
					</div>
					<div class="control-group">
						<label class="control-label">展示图</label>
						<div class="controls">
							<div data-provides="fileupload" class="fileupload fileupload-new">
								<div style="max-width: 160px; max-height: 60px;" class="fileupload-new thumbnail">
									<img src="/static/img/wu_ss.gif">
								</div>
								<div style="max-width: 160px; max-height: 60px; line-height: 20px;" class="fileupload-preview fileupload-exists thumbnail"></div>
								<span class="btn btn-file"><i class="icon-picture"></i>
									<span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span>
									<input type="file" name="list_pic">
								</span>
								<a data-dismiss="fileupload" class="btn fileupload-exists" href="#">Remove</a>
							</div>
						</div>
					</div>
					<div class="control-group">
						<label class="control-label">详细图</label>
						<div class="controls">
							<div data-provides="fileupload" class="fileupload fileupload-new">
								<div style="max-width: 160px; max-height: 60px;" class="fileupload-new thumbnail">
									<img src="/static/img/wu_ss.gif">
								</div>
								<div style="max-width: 160px; max-height: 60px; line-height: 20px;" class="fileupload-preview fileupload-exists thumbnail"></div>
								<span class="btn btn-file"><i class="icon-picture"></i>
									<span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span>
									<input type="file" name="detail_pic">
								</span>
								<a data-dismiss="fileupload" class="btn fileupload-exists" href="#">Remove</a>
							</div>
						</div>
					</div>
					<div class="control-group">
						<label class="control-label">是否上架</label>
						<div class="controls">
							<input name="is_shelf" <!--{{ result.isOnshelf ? 'checked' : '' }}--> data-on-color="success" data-on-text="上架" data-off-color="danger" data-off-text="下架" class="switchbox" type="checkbox"/>
						</div>
					</div>

					<div class="form-actions">
						<button type="submit" class="btn btn-primary"><i class="icon-ok"></i>保存</button>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>
<!--{%endblock%}-->
<!--{%block footer_js%}-->
<script src="<!--{{asset('/static/js/ueditor/ueditor.config.js')}}-->"></script>
<script src="<!--{{asset('/static/js/ueditor/ueditor.all.js')}}-->"></script>
<script src="<!--{{asset('/static/js/ueditor/lang/zh-cn/zh-cn.js')}}-->"></script>
<script src="/static/js/jquery.validationEngine.js"></script>
<script src="/static/js/jquery.validationEngine-en.js"></script>
<script>
	function set_selected_cate(cate_id,cate_name){
		$('#selected_categoryId').val(cate_id);
		$('#selected_cate_name').val(cate_name);
		$("input[name='category_name']").val(cate_name);
	};

	function set_selected_card(card_id,card_name,card_stock){
		$('#selected_cardCode').val(card_id);
		$('#selected_card_name').val(card_name);
		$("input[name='card_name']").val(card_name);
		$("input[name='stock']").val(card_stock);
	}

	function set_selected_game(game_id,game_name,icon){
		$('#selected_game_id').val(game_id);
		$('#selected_game_icon').attr('src',icon);
		$('#selected_game_name').val(game_name);
		$("input[name='name']").val(game_name);
		$("input[name='icon']").val(icon);
	};
	$(function(){
		UE.getEditor('summary',{toolbars:[['undo', 'redo']],initialFrameHeight:100});
		UE.getEditor('intro',{toolbars:[['undo', 'redo']],initialFrameHeight:100});
		UE.getEditor('des',{toolbars:[['undo', 'redo']],initialFrameHeight:100});
		$('input').iCheck({
			checkboxClass: 'icheckbox_square-orange',
			radioClass: 'iradio_square-orange',
			increaseArea: '20%' // optional
		});
		$('.switchbox').bootstrapSwitch();
		$('input.datetimepicker').datetimepicker({format:'Y-m-d H:i',lang:'ch'});

		//初始化显示
		if($("input[name='is_exclusive']").attr('checked')) $("#exclusive").show();

		$("#exclusive-switch").on('switchChange.bootstrapSwitch', function (e, data) {
			if(data){
				$("#exclusive").fadeIn();
			}else{
				$("#exclusive").fadeOut();
			}
		});

		$('input.datetimepicker').datetimepicker({format:'Y-m-d H:i',lang:'ch'});

		$(".select-card-code").on('click',function(){
			$.ajax({
				url:'/v4aproduct/goods/cate-card-select',
				dataType:'json',
				success:function(json){
					var html = json.html;
					$.dialog({id:'pop-card-list',title:'提示',padding:2,content:html,width:600,height:580});
				}
			});
		})
		$('.select-pop-cate').on('click',function(){
			$.ajax({
				url:'/v4aproduct/goods/cate-list-select',
				dataType:'json',
				success:function(json){
					var html = json.html;
					$.dialog({id:'pop-cate-list',title:'提示',padding:2,content:html,width:600,height:580});
				}
			});
		});

		$('.select-pop-game').bind('click',function(){
			$.ajax({
				url:'/game/api/game-search',
				dataType:'json',
				success:function(json){
					var html = json.html;
					$.dialog({id:'pop-game-list',title:'提示',padding:2,content:html,width:600,height:580});
				}
			});
		});

		//关联验证
		jQuery("#gift-info-form").validationEngine({'custom_error_messages':{
			"#account_ids":{
				"condRequired": {'message':'请填写用户ID'}
			}
		}});
	});
</script>
<!--{%endblock%}-->