<!--{%extends "../sub-layout-giftbag.twig"%}-->
<!--{%block main_content%}-->
<div class="row-fluid">
	<div class="span12">
		<div class="box">
			<div class="box-title">
				<h3><i class="icon-edit"></i>礼包导入</h3>
			</div>
			<div class="box-content">
				<form id="card_from" action="<!--{{url('v4agiftbag/package/add')}}-->" method="POST" class='form-horizontal form-validate' enctype="multipart/form-data">
					<div class="control-group">
						<label class="control-label">礼包导入说明</label>
						<div class="controls">
							<span class="label">TXT文件导入</span>
							<p>请将要导入的卡密号写入一个TXT文件！</p>
						</div>
					</div>

                    <div class="row-fluid virtual">
                        <div class="span3">
                            <div class="control-group"  id="card-import">
                                <label class="control-label">礼包文件</label>
                                <div class="controls">
                                    <div class="fileupload fileupload-new" data-provides="fileupload">
                                        <div class="fileupload-new thumbnail"style="max-width: 120px; max-height: 120px;">
                                                请选择文件
                                        </div>
                                        <div class="fileupload-preview fileupload-exists thumbnail" style="max-width: 120px; max-height: 120px; line-height: 20px;"  id="uploadTxt" ></div>
                                        <div>
                                            <span class="btn btn-file uploadNow"><i class="icon-picture"></i><span class="fileupload-new">选择文件</span><span class="fileupload-exists">重新选择</span><input class="validate[condRequired[virtual]]" type="file" name='importFile' id="file_upload" /></span>
                                        </div><span class="add-on text-error  card-line" id="upload-kami"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="span3">
                            <a class="btn btn-lime upload-card" style="display: none;" href="#">上传</a>卡密类产品 请上传卡密-不然会添加失败!
                        </div>
                    </div>



					<div class="control-group">
						<label class="control-label">礼包库名称</label>
						<div class="controls">
							<input type="text" name="cardDesc" id="cardDesc" data-rule-required="true" data-msg-required="请填写礼包库名称"  class="input-large" value="" />
						</div>
					</div>
                    <div class="control-group">
                        <label class="control-label">用途</label>
                        <div class="controls">
                            <!--{{form_select('virtualUse',{'1':'活动','2':'礼包','3':'任务'},{'style':'width:80px;margin-bottom:0px;'})}}-->
                        </div>
                    </div>


                    <div class="control-group">
                        <label class="control-label">所属游戏</label>
                        <div class="controls">
                            <div class="input-append">
                                <input id="selected_game_id" name="gid" type="hidden" value="<!--{{ input_old('gid') }}-->"/>
                                <input name="virtualImgpath" id="virtualImgpath" type="hidden" value="<!--{{ input_old('icon') }}-->"/>
                                <img id="selected_game_icon"  class="add-on" src="<!--{{ input_old('icon')|default('/static/img/wu_ss.gif') }}-->"/>
                                <input type="text"  id="selected_game_name" data-rule-required="true" data-msg-required="请选所属游戏" name="gname" class="input-medium"
                                       value="<!--{{ input_old('gname') }}-->"  readonly/>
                                <span class="add-on select-pop-game">选择游戏</span>
                            </div>
                        </div>
                    </div>

                    <div class="control-group">
                        <label for="textfield" class="control-label">礼包简介</label>
                        <div class="controls">
                            <script id="summary" data-rule-required="true" data-msg-required="请填写礼包简介" name="virtualSummary" type="text/plain"><!--{{input_old('virtualSummary') }}--></script>
                        </div>
                    </div>
                    <div class="control-group">
                        <label for="textfield" class="control-label">礼包说明</label>
                        <div class="controls">
                            <script id="intro" name="virtualInstruction" type="text/plain"><!--{{ input_old('virtualInstruction') }}--></script>
                        </div>
                    </div>


                    <div id="clone_" >
                        <input type="hidden" name="tmp" id="tmp" value="">
                        <input type="hidden" name="filename" id="filename" value="">
                    </div>
					<div class="form-actions">
						<button type="submit" class="btn btn-primary"><i class="icon-ok"></i>提交入库</button>
					</div>

				</form>
			</div>
		</div>
	</div>
</div>
<!--{%endblock%}-->

<!--{%block footer_js%}-->
<script src="<!--{{asset('/static/js/ueditor/ueditor.config.js')}}-->"></script>
<script src="<!--{{asset('/static/js/ueditor/ueditor.all.js')}}-->"></script>
<script src="<!--{{asset('/static/js/ueditor/lang/zh-cn/zh-cn.js')}}-->"></script>
<script src="/static/js/ajaxfileupload.js"></script>
<script src="/static/js/jquery.validationEngine.js"></script>
<script src="/static/js/jquery.validationEngine-en.js"></script>
<script>
    function set_selected_game(game_id,game_name,icon){
        $('#selected_game_id').val(game_id);
        $('#selected_game_icon').attr('src',icon);
        $('#selected_game_name').val(game_name);
        $("input[name='name']").val(game_name);
        $("#virtualImgpath").val(icon);
    };

	$(function(){
        $('#is-append').bootstrapSwitch();
		$('input.datetimepicker').datetimepicker({format:'Y-m-d H:i:s',lang:'ch'});
		//$("input:file").uniform({'fileBtnText':'选择文件'});
        UE.getEditor('summary',{toolbars:[['undo', 'redo']],initialFrameHeight:100});
        UE.getEditor('intro',{initialFrameHeight:100});
        UE.getEditor('des',{toolbars:[['undo', 'redo']],initialFrameHeight:100});

        $('span.select-pop-game').bind('click',function(){
            $.ajax({
                url:'/a_game/api/game-search',
                dataType:'json',
                success:function(json){
                    var html = json.html;
                    $.dialog({id:'pop-game-list',title:'提示',padding:2,content:html,width:600,height:580});
                }
            });
        });
        //var i=2;
        $(document).on('change','#file_upload',function(){
             $('#upload-kami').html("载入数据中...");
             $("#uploadTxt").html($("#file_upload").val());
             $.ajaxFileUpload({
				url:'/v4agiftbag/package/file-count',
				type : 'post',
				secureuri :false,
				fileElementId :'file_upload',
				dataType : 'JSON',
				success : function (data){
					var dataObj=eval("("+data+")");
                    if(dataObj.errorCode == 0){
                        $('#upload-kami').html("上传卡密数为:"+dataObj.size);
						alertify.success('礼包数确认成功!');
                        $("#tmp").val(dataObj.file.tmp);
                        $("#filename").val(dataObj.file.filename);
                    }else{
						alertify.error(dataObj.errortxt);
						$('#upload-kami').html("载入数据错误");
                        $('#tmp,#filename').val('');
                    }
                    return ;
				}

			});
        });



		
	});
</script>
<!--{%endblock%}-->
