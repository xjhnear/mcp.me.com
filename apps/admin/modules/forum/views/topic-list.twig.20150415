<!--{%extends "sub-layout-forum.twig"%}-->
<!--{%block main_content%}-->
<div class="row-fluid">
	<div class="span12">
	    <div class="box box-color box-bordered">
			<div class="box-title">
				<h3>
					<i class="icon-table"></i>
					帖子列表
					<span class="badge badge-warning"><!--{{totalcount}}--></span>
				</h3>
				<div class="actions">
				    <form action="<!--{{url('forum/topic/search')}}-->">
				    <table class="table-filter">
				        <tr>
				            <td><input id="gameselect" name="game_id" type="hidden" value="<!--{{search.game_id}}-->" class="bigdrop select2-offscreen width_150" tabindex="-1"></td>
				            <td>
				                <div class="input-append date datepick" id="dpStart" data-date="">
									<input name="startdate" type="text" class="input-small" value="<!--{{search.startdate}}-->" readonly="">
									<span class="add-on"><i class="icon-calendar"></i></span>
								</div>
				            </td>
				            <td>
				                <div class="input-append date datepick" id="dpEnd" data-date="">
									<input name="enddate" type="text" class="input-small" value="<!--{{search.enddate}}-->" readonly="">
									<span class="add-on"><i class="icon-calendar"></i></span>
								</div>
							</td>
							<td><!--{{form_select('keytype',{title:'标题',uid:'用户UID',tid:'帖子ID'},search.keytype,{'style':'width:80px;margin-bottom:0px'})}}--></td>
				            <td><input type="text" name="keyword" id="" class="input-small" placeholder="关键词" value="<!--{{search.keyword}}-->"/></td>				          
				            <td>
					            <label class='radio inline'><!--{{form_radio('sort','dateline',search.sort=='dateline')}}-->最新</label>
				            </td>
				            <td>
								<label class='radio inline'><!--{{form_radio('sort','replies',search.sort=='replies')}}-->热门</label>
				            </td>
				            <td>
								<label class='radio inline'><!--{{form_radio('sort','likes',search.sort=='likes')}}-->赞</label>
				            </td>
				            <td>
								<label class='checkbox inline'><!--{{form_checkbox('recycle','1',search.recycle==1)}}-->回收站</label>
				            </td>
				            <td><button class="btn btn-teal"><i class="icon-search"></i>搜索</button></td>
				        </tr>
				    </table>
				    </form>
				</div>
			</div>
			<div class="box-content nopadding">
			    <table class="table table-hover table-nomargin">
			        <thead>
						<tr>
						    <th class="col-50">
						        <input type="checkbox" name="all" value="" /><div class="btn-group">
							        <a data-toggle="dropdown" class="btn dropdown-toggle"><span class="caret"></span></a>
							        <ul class="dropdown-menu">
							            <li><a href="javascript:void(0);" data-act="del" class="ajax-del">删除</a></li>
							        </ul>
							    </div>
							</th>
						    <th class="col-40">ID</th>
						    <th class="col-50">游戏</th>
							<th>标题</th>
							<th class="col-100">版块</th>
							<th class="col-100">发布时间</th>
							<th class="col-60">回复</th>
							<th class="col-60">赞</th>
							<th class="col-60">发帖人</th>
							<th class="col-60">状态</th>
							<th class="table-btn-group">操作</th>
						</tr>
					</thead>
					<tbody>
					    <!--{%for item in datalist%}-->
						<tr>
						    <td><input type="checkbox" name="tids" value="<!--{{item.tid}}-->" /></td>
							<td><!--{{item.tid}}--></td>
							<td class="user-avatar"><img title="<!--{{games[item.gid]['shortgname']}}-->" src="http://img.youxiduo.com<!--{{games[item.gid]['ico']}}-->"/></td>
							<td><a href="<!--{{url('forum/topic/info',{'id':item.tid})}}-->" target="_blank"><!--{{item.subject}}--></a></td>
							<td><!--{{item.channel_name}}--></td>
							<td><!--{{item.dateline|date('Y-m-d H:i')}}--></td>
							<td><!--{{item.replies}}--></td>
							<td><a href="<!--{{url('forum/topic/likes',{'target':item.tid})}}-->"><!--{{item.likes}}--></a></td>
							<td><span class="badge badge-info"><!--{{item.author_uid}}--></span><a href="<!--{{url('user/users/edit',{'id':item.author_uid})}}-->" target="_blank"><!--{{users[item.author_uid]['nickname']}}--></a></td>
							<td>
							    <!--{%if item.stick==1%}--><img alt="置顶" src="/static/img/common/pin.gif" /><!--{%endif%}-->
							    <!--{%if item.digest==1%}--><img alt="精华" src="/static/img/common/digest.gif" /><!--{%endif%}-->
							</td>
							<td>
							    <a href="<!--{{url('forum/topic/edit',{tid:item.tid})}}-->" class="btn btn-primary">编辑</a>
							    
							    <div class="btn-group">
							        <a data-toggle="dropdown" class="btn  btn-primary dropdown-toggle"><span class="caret"></span></a>
							        <ul class="dropdown-menu dropdown-primary">
							            <li><a href="<!--{{url('comment/comments/search')}}-->?target_table=yxd_forum_topic&target_id=<!--{{item.tid}}-->" target="_blank">查看评论</a></li>
							            <!--{%if item.digest==0%}-->
							            <li><a href="<!--{{url('forum/topic/digest')}}-->" data-act="on" data-tid="<!--{{item.tid}}-->" class="ajax-digest">加精</a></li>
							            <!--{%else%}-->
							            <li><a href="<!--{{url('forum/topic/digest')}}-->" data-act="off" data-tid="<!--{{item.tid}}-->" class="ajax-digest">取消加精</a></li>
							            <!--{%endif%}-->
							            <!--{%if item.stick==0%}-->
							            <li><a href="<!--{{url('forum/topic/stick')}}-->" data-act="on" data-tid="<!--{{item.tid}}-->" class="ajax-stick">置顶</a></li>
							            <!--{%else%}-->
							            <li><a href="<!--{{url('forum/topic/stick')}}-->" data-act="off" data-tid="<!--{{item.tid}}-->" class="ajax-stick">取消置顶</a></li>
							            <!--{%endif%}-->
							            <li><a href="<!--{{url('forum/topic/export',{'tid':item.tid,'type':'reply_user_floor'})}}-->">导出所有回帖的用户及楼层</a></li>
							        </ul>
							    </div>
							    <!--{%if search.recycle==1%}-->
							    <a href="<!--{{url('forum/topic/restore',{'tid':item.tid})}}-->" class="btn btn-primary">恢复</a>
							    <!--{%else%}-->
							    <a href="<!--{{url('forum/topic/del',{'tid':item.tid})}}-->" class="btn btn-primary ajax-del">删除</a>
							    <!--{%endif%}-->
							</td>
						</tr>
						<!--{%endfor%}-->
					</tbody>
			    </table>
			    <div class="pagelink">
			        <!--{{pagelinks}}-->
			    </div>
			</div>
		</div>
	</div>
</div>
<!--{%endblock%}-->

<!--{%block footer_js%}-->
<script>
$(function(){
    $('a.ajax-del').bind('click',function(){
        if(!confirm('确定要删除数据吗？')){
            return false;
        }
        if($(this).attr('data-act')=='del'){
            var tids = [];
            $('input[name="tids"]:checked').each(function(){
                tids.push($(this).val());
            });
            if(tids.length==0) return false;
            $.ajax({
                url:'<!--{{url('forum/topic/del')}}-->',
                type:'POST',
                data:{'tids':tids},
                dataType:'json',
                success:function(data){
                    if(data.status==200){
                        window.location.href = window.location.href;
                    }else{
                        
                    }
                }
            });
        }
    });
    
    $('a.ajax-digest').bind('click',function(){
        var url = $(this).attr('href');
        $(this).attr('href','javascript:void(0);')
        var act = $(this).attr('data-act');
        var tid = $(this).attr('data-tid');
        $.ajax({
            url:url,
            type:'POST',
            data:{'act':act,'tid':tid},
            dataType:'json',
            success:function(data){
                if(data.status==200){
                    window.location.href = window.location.href;
                }else{
                    
                }
            }
        });
        return false;
    });
    
    $('a.ajax-stick').bind('click',function(){
        var url = $(this).attr('href');
        $(this).attr('href','javascript:void(0);')
        var act = $(this).attr('data-act');
        var tid = $(this).attr('data-tid');
        $.ajax({
            url:url,
            type:'POST',
            data:{'act':act,'tid':tid},
            dataType:'json',
            success:function(data){
                if(data.status==200){
                    window.location.href = window.location.href;
                }else{
                    
                }
            }
        });
        return false;
    });
    
    $('input[name="all"]').bind('click',function(){
        if($(this).prop('checked')==true){
            $('input[name="tids"]').prop('checked',true);
        }else{
            $('input[name="tids"]').prop('checked',false);
        }
    });
    
    gameselect('#gameselect');
});
</script>
<!--{%endblock%}-->