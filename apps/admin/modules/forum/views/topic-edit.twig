<!--{%extends "sub-layout-forum.twig"%}-->
<!--{%block main_content%}-->
<div class="row-fluid">
    <div class="span12">
		<div class="box">
			<div class="box-title">
				<h3><i class="icon-edit"></i>主题帖信息</h3>
			</div>
			<div class="box-content">
				<form id="form-topic" action="<!--{{url('forum/topic/save')}}-->" method="POST" class="form-horizontal form-validate" enctype="multipart/form-data">
				<input name="tid" type="hidden" value="<!--{{topic.tid}}-->" />
				<div class="control-group">
					<label for="textfield" class="control-label">发帖人UID</label>
					<div class="controls">
						<input type="text" name="author_uid" class="input-small" value="<!--{{topic.author_uid}}-->"  data-rule-required="true" data-msg-required="发帖人UID"/>
					</div>
				</div>				
				<div class="control-group">
					<label for="textfield" class="control-label">所属论坛</label>
					<div class="controls">
					    <div class="input-append">
					        <input id="selected_game_id" name="game_id" type="hidden" value="<!--{{topic.gid}}-->" />
						    <img id="selected_game_icon" alt=""  class="add-on" src="/static/img/wu_ss.gif" />
							<input type="text" id="selected_game_name" name="game_name" class="input-xlarge" value="<!--{{game.shortgname}}-->" data-rule-required="true" data-msg-required="请选择入口游戏" />
							<span class="add-on select-pop-game">选择游戏</span>
						</div>												
					</div>
				</div>	
				<div class="control-group">
					<label for="textfield" class="control-label">所属版块</label>
					<div class="controls">					    
						<select id="cid" name="cid" data-cid="<!--{{topic.cid}}-->" data-rule-required="true" data-msg-required="请选择版块">
						    <option value="">选择版块</option>
						</select>
					</div>
				</div>
				<div class="control-group">
					<label for="textfield" class="control-label">悬赏游币</label>
					<div class="controls">
						<input type="text" name="reward" class="input-small" value="<!--{{topic.award}}-->" />
						<span class="help-inline">非问答版块此处无效</span>
					</div>
				</div>						
				<div class="control-group">
					<label for="textfield" class="control-label">标题</label>
					<div class="controls">
						<input type="text" name="subject" class="input-xxlarge" value="<!--{{topic.subject}}-->"  data-rule-required="true" data-msg-required="标题不能为空"/>
					</div>
				</div>
				<div class="control-group">
					<label for="textfield" class="control-label">缩略图</label>
					<div class="controls">
						<div class="fileupload fileupload-new" data-provides="fileupload">
						    <div class="input-append">
						        <div class="uneditable-input span3"><i class="icon-file fileupload-exists"></i><span class="fileupload-preview"><!--{{topic.listpic}}--></span></div>
						        <span class="btn btn-file">
						            <span class="fileupload-new">选择图片</span>
						            <span class="fileupload-exists">更改图片</span>
						            <input type="file" name="listpic"/>
						        </span>						        
						    </div>
						</div>
					</div>
				</div>
				<!--{#
				<div class="control-group">
					<label for="textfield" class="control-label">摘要</label>
					<div class="controls">
						<textarea name="summary" class="input-xxlarge"><!--{{topic.summary}}--></textarea>
					</div>
				</div>
				#}-->
				<div class="control-group">
					<label class="control-label">回复状态</label>
					<div class="controls">					    
				        <label class="checkbox inline">
				        <!--{{form_checkbox('highlight',1,topic.highlight==1)}}-->回复内容不可见					        					        
				        </label>				        				        				        				     
					</div>
				</div>	
				<div class="control-group">
					<label for="textfield" class="control-label">内容</label>
					<div class="controls">
					    <script id="container" name="format_message" type="text/plain"><!--{{topic.format_message}}--></script>
					</div>
				</div>
				<div class="form-actions">
					<button type="submit" class="btn btn-primary"><i class="icon-ok"></i>保存</button>
				</div>    
				</form>
			</div>
		</div>
    </div>
</div>
<!--{%endblock%}-->

<!--{%block footer_js%}-->
<script src="<!--{{asset('/static/js/ueditor/ueditor.config.js')}}-->"></script>
<script src="<!--{{asset('/static/js/ueditor/ueditor.all.js')}}-->"></script>
<script src="<!--{{asset('/static/js/ueditor/lang/zh-cn/zh-cn.js')}}-->"></script>
<script>

var set_selected_game = function(game_id,game_name,icon){
    $('#selected_game_id').val(game_id);
    $('#selected_game_icon').attr('src',icon);
    $('#selected_game_name').val(game_name);
    init_channel(game_id,0);
    
};

var init_channel = function(game_id,cid){
    $.ajax({
        url:'/forum/channel/api-channel-option',
        type:'GET',
        data:{'game_id':game_id},
        dataType:'json',
        success:function(json){
            if(json.status==200){
                var len = json.data.length;
                var options = '';
                $.each(json.data,function(i,n){
                    options += '<option value="'+i+'">'+n+'</option>';
                });
                $('#cid').empty();
                $('#cid').append(options);
                $('#cid option[value="'+cid+'"').prop('selected',true);                
            }
        }
    });
};

$(function(){
    var editor = UE.getEditor('container');
    
    $('input[name="type"]:checkbox').click(function(){
        if($(this).prop('checked')){
            $('#relation_game').hide();
        }else{
            $('#relation_game').show();
        }
    });
    $('.select-pop-game').bind('click',function(){        
        $.ajax({
            url:'/forum/api/game-search',
            dataType:'json',
            success:function(json){
                var html = '';
                html = json.html;
                $.dialog({id:'pop-game-list',title:'提示',padding:2,content:html,width:600,height:580});
            }
        });        
    });
    if($('input[name="type"]:checkbox').prop('checked')){
        $('#relation_game').hide();
    }else{
        $('#relation_game').show();
    }
    if($('#selected_game_id').val().length){
        var cid = $('#cid').attr('data-cid');
        init_channel($('#selected_game_id').val(),cid);
    }
});   
</script>
<!--{%endblock%}-->   