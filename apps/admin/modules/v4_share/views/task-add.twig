<!--{%extends "base-layout.twig"%}-->
<!--{%block main_content%}-->
<div class="row-fluid">
    <div class="span12">
		<div class="box">
			<div class="box-title">
				<h3>自分享信息</h3>
			</div>
			<div class="box-content">
                <form id="activity-task" action="<!--{{url('v4_share/home/v4share-add')}}-->" method="POST" class='form-horizontal form-validate' enctype="multipart/form-data">

                    <div class="control-group">
                        <label class="control-label">平台区分</label>
                        <div class="controls">
                            <input type="radio" name="platforms" <!--{% if data.platform %}-->disabled='disabled' <!--{% endif %}--> value="ios" <!--{% if data.platform == 'ios' %}-->checked<!--{% endif %}--> <!--{% if data.platform != 'ios' and data.platform != 'glwzry' %}-->checked<!--{% endif %}--> >游戏多IOS
                            <input type="radio" name="platforms" <!--{% if data.platform %}-->disabled='disabled' <!--{% endif %}--> value="glwzry" <!--{% if data.platform == 'glwzry' %}-->checked<!--{% endif %}--> >王者大宝鉴
                            <input type="radio" name="platforms" <!--{% if data.platform %}-->disabled='disabled' <!--{% endif %}--> value="android" <!--{% if data.platform == 'android' %}-->checked<!--{% endif %}--> >安卓
                        </div>
                    </div>

                    <div class="control-group">
                        <label class="control-label">用途</label>
                        <div class="controls">
                            <select name="useType" id="">
                                <option value="1" <!--{% if data.useType == '1' %}-->selected<!--{% endif %}--> >活动</option>
                                <option value="2" <!--{% if data.useType == '2' %}-->selected<!--{% endif %}--> >礼包</option>
                                <option value="3" <!--{% if data.useType == '3' %}-->selected<!--{% endif %}--> >商城</option>
                                <option value="4" <!--{% if data.useType == '4' %}-->selected<!--{% endif %}--> >任务</option>
                            </select>
                        </div>
                    </div>

                    <div class="control-group">
                        <label class="control-label">标题</label>
                        <div class="controls">
                            <input type="text" name="title" class="input-xlarge" value="<!--{{data.title}}-->" data-rule-required="true" data-msg-required="标题不能为空"  />
                        </div>
				    </div>

                    <div class="row-fluid task_time">
                        <div class="span4">
                            <div class="control-group">
                                <label class="control-label">*开始时间</label>
                                <div class="controls">
                                    <div class="input-append date">
                                        <input name="startTime" type="text" class="input-medium" onclick="laydate({istime: true, format: 'YYYY-MM-DD hh:mm:ss'})"  value="<!--{{data.startTime|date('Y-m-d H:i:s')}}-->" >
                                        <span class="add-on"><i class="icon-calendar"></i></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="span4">
                            <div class="control-group">
                                <label class="control-label">*结束时间</label>
                                <div class="controls">
                                    <div class="input-append date">
                                        <input name="endTime" type="text" class="input-medium " onclick="laydate({istime: true, format: 'YYYY-MM-DD hh:mm:ss'})" value="<!--{{data.endTime|date('Y-m-d H:i:s')}}-->" >
                                        <span class="add-on"><i class="icon-calendar"></i></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="control-group">
                        <label class="control-label">H5页面背景图</label>
                        <div class="controls">
                            <div data-provides="fileupload" class="fileupload fileupload-new">
                                <div style="max-width: 60px; max-height: 60px;" class="fileupload-new thumbnail">
                                    <img src="<!--{{ data.backgroundPic }}-->">
                                </div>
                                <div style="max-width: 60px; max-height: 60px; line-height: 20px;" class="fileupload-preview fileupload-exists thumbnail"></div>
                                    <span class="btn btn-file">
                                        <i class="icon-picture"></i>
                                        <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span>
                                        <input name="prize_img[]" type="hidden" value="<!--{{data.backgroundPic}}-->" />
                                        <input type="file" name="backgroundPic" class="img_validate"  <!--{% if data.backgroundPic == '' %}-->data-rule-required="true" data-msg-required="请选择H5页面背景!"<!--{% endif %}-->/>
                                    </span>
                                <a data-dismiss="fileupload" class="btn fileupload-exists" href="#">Remove</a>
                                <span style="color: rgb(185, 74, 72);" class="img_note" >图片最佳尺寸：640*468</span>
                                <span style="color: rgb(185, 74, 72);" class="img_note" hidden="hidden">图片不能为空且限于png,gif,jpeg,jpg格式</span>
                            </div>
                        </div>
                    </div>

                    <div class="control-group">
                        <label class="control-label">APP下载地址</label>
                        <div class="controls">
                            <input type="text" name="downloadUrl" class="input-xlarge" value="<!--{{data.downloadUrl}}-->" data-rule-required="true" data-msg-required="APP下载地址不为空"  />
                        	<span style="color: rgb(185, 74, 72);" class="img_note" >下载地址必须填完整	例：http://www.youxiduo.com</span>
                        </div>
                    </div>

                    <fieldset class="f_price">
                        <div class="for_del">
                            <div class="control-group">
                                <label class="control-label">新用户奖励</label>
                                <input type="hidden" name="id_new" value="<!--{{data.newReward.id}}-->">
                                <input type="hidden" name="shareConfigId[1]" value="<!--{{data.newReward.shareConfigId}}-->">
                                <div class="controls">
                                    <select id="rewardType_new" name="rewardType[1]" class="rwtype_new">
                                        <option value="5" <!--{% if data.newReward.rewardType == '5' %}-->selected<!--{% endif %}--> >无奖励</option>
                                        <option value="3" <!--{% if data.newReward.rewardType == '3' %}-->selected<!--{% endif %}--> >礼包</option>
                                        <option value="4" <!--{% if data.newReward.rewardType == '4' %}-->selected<!--{% endif %}--> >钻石</option>
                                        <!--{%if data.platform and data.platform != 'ios' %}-->
                                        <option value="1" <!--{% if data.newReward.rewardType == '1' %}-->selected<!--{% endif %}--> >实物</option>
                                        <option value="2" <!--{% if data.newReward.rewardType == '2' %}-->selected<!--{% endif %}--> >代充</option>
                                        <!--{% else %}-->
                                        <option value="6" <!--{% if data.newReward.rewardType == '6' %}-->selected<!--{% endif %}--> >背包物品</option>
                                        <!--{% endif %}-->
                                    </select>
                                </div>
                            </div>
                            <div class="control-group">
                                <div class="controls">
                                    <div data-provides="fileupload" class="fileupload fileupload-new">
                                        <div style="max-width: 60px; max-height: 60px;" class="fileupload-new thumbnail">
                                            <img id="img_f" src="<!--{{ data.newReward.iconUrl }}-->">
                                        </div>
                                        <div style="max-width: 60px; max-height: 60px; line-height: 20px;" class="fileupload-preview fileupload-exists thumbnail"></div>
                                            <span class="btn btn-file">
                                                <i class="icon-picture"></i>
                                                <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span>
                                                <input name="prize_img[]" type="hidden" value="<!--{{data.newReward.iconUrl}}-->"/>
                                                <input type="file" name="iconUrl[1]" class="img_validate"  <!--{% if data.newReward.iconUrl == '' %}-->data-rule-required="true" data-msg-required="请选择照片!"<!--{% endif %}-->/>
                                            </span>
                                        <a data-dismiss="fileupload" class="btn fileupload-exists" href="#">Remove</a>
                                        <span style="color: rgb(185, 74, 72);" class="img_note" >图片最佳尺寸：221*130</span>
                                        <span style="color: rgb(185, 74, 72);" class="img_note" hidden="hidden">图片不能为空且限于png,gif,jpeg,jpg格式</span>
                                    </div>
                                </div>
                            </div>
                            <div class="control-group">
                                <div class="controls"  id="div_icon_new" style="display:none;">
                                    <div class="input-append">
                                        <input class="selected_cardCode" name="card_code[1]" value="<!--{%if data.newReward.giftId %}--><!--{{data.newReward.giftId}}--><!--{%endif%}-->" type="hidden"/>
                                        <input type="text" readonly class="input-small selected_card_name" name="card_des[1]" value="<!--{{ data.newReward.giftName }}-->" data-rule-required="true" data-msg-required="请选择礼包" />
                                        <!--{%if data.newReward.giftId %}--><input type="hidden" name="card_code_old[1]" value="<!--{{data.newReward.giftId}}-->"/><!--{%endif%}-->
                                        <span class="add-on select-card-code">选择</span>
                                        <span class="add-on can-use">可上架礼包<span class="text-error"><!--{% if data.newReward.cardnum %}--><!--{{data.newReward.cardnum}}--><!--{% else %}-->0<!--{% endif %}--></span>个</span>
                                    </div>
                                    <div class="input-append">
                                        &nbsp;
                                        <input type="hidden" name="card_change[1]" value=""/>
                                        <input type="text" name="totalCount[1]" class="input-min xxx totalCount" value="<!--{% if data.newReward.rewardType == '3' %}--><!--{{data.newReward.totalCount}}--><!--{% else %}-->0<!--{% endif %}-->" readonly="readonly">
                                        <input type="text" name="total[1]" class="input-min" value="" />
                                        <span class="add-on get_gift" id="get_gift_new">分配</span>
                                    </div>
                                </div>
                                
                                <div class="controls"  id="div_backpack_new" style="display:none;">
                                    <div class="input-append">
                                        <input class="selected_backpackCode" name="backpack_code[1]" value="<!--{%if data.newReward.giftId %}--><!--{{data.newReward.giftId}}--><!--{%endif%}-->" type="hidden"/>
                                        <input type="text" readonly class="input-small selected_backpack_name" name="backpack_name[1]" value="<!--{{ data.newReward.giftName }}-->" data-rule-required="true" data-msg-required="请选择背包物品" />
                                        <span class="add-on select-backpack-code">选择</span>
                                    </div>
                                </div>
                            </div>
                            <div class="control-group">
                                <div class="controls">
                                    <label class="control-label">名称[例：辣条]</label>
                                    <input type="text" name="rewardName[1]" class="input-large rewardName" value="<!--{{data.newReward.rewardName}}-->" data-rule-required="true" data-msg-required="名称不能为空"  />
                                </div>
                            </div>
                            <div class="control-group">
                                <div class="controls">
                                    <label class="control-label">规格[例：10]</label>
                                    <input type="text" name="rewardContent[1]" class="input-large rewardContent" value="<!--{{data.newReward.rewardContent}}-->" data-rule-required="true" data-msg-required="内容不能为空"  />
                                </div>
                            </div>
                            <div class="control-group">
                                <div class="controls" id="div_num_new">
                                    <label class="control-label">份数</label>
                                    <input type="text" name="totalCount_s[1]" class="input-large" value="<!--{% if data.newReward.rewardType != '3' and  data.newReward.totalCount != -1 %}--><!--{{data.newReward.totalCount}}--><!--{% endif %}-->" />
                                    <span style="color: rgb(185, 74, 72);" class="img_note" >不填表示无限份数</span>
                                </div>
                            </div>
                        </div>
                    </fieldset>

                    <fieldset class="f_price">
                        <div class="for_del">
                            <div class="control-group">
                                <label class="control-label">老用户奖励</label>
                                <input type="hidden" name="id_old" value="<!--{{data.oldReward.id}}-->">
                                <input type="hidden" name="shareConfigId[2]" value="<!--{{data.oldReward.shareConfigId}}-->">
                                <div class="controls">
                                    <select id="rewardType_old" name="rewardType[2]" class="rwtype_old">
                                    	<option value="5" <!--{% if data.oldReward.rewardType == '5' %}-->selected<!--{% endif %}--> >无奖励</option>
                                        <option value="3" <!--{% if data.oldReward.rewardType == '3' %}-->selected<!--{% endif %}--> >礼包</option>
                                        <option value="4" <!--{% if data.oldReward.rewardType == '4' %}-->selected<!--{% endif %}--> >钻石</option>
                                        <!--{%if data.platform and data.platform != 'ios' %}-->
                                        <option value="1" <!--{% if data.oldReward.rewardType == '1' %}-->selected<!--{% endif %}--> >实物</option>
                                        <option value="2" <!--{% if data.oldReward.rewardType == '2' %}-->selected<!--{% endif %}--> >代充</option>
										<!--{% else %}-->
										<option value="6" <!--{% if data.oldReward.rewardType == '6' %}-->selected<!--{% endif %}--> >背包物品</option>
                                        <!--{% endif %}-->
                                    </select>
                                </div>
                            </div>
                            <div class="control-group">
                                <div class="controls">
                                    <div data-provides="fileupload" class="fileupload fileupload-new">
                                        <div style="max-width: 60px; max-height: 60px;" class="fileupload-new thumbnail">
                                            <img id="img_s" src="<!--{{ data.oldReward.iconUrl }}-->">
                                        </div>
                                        <div style="max-width: 60px; max-height: 60px; line-height: 20px;" class="fileupload-preview fileupload-exists thumbnail"></div>
                                            <span class="btn btn-file">
                                                <i class="icon-picture"></i>
                                                <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span>
                                                <input name="prize_img[]" type="hidden" value="<!--{{data.oldReward.iconUrl}}-->"/>
                                                <input type="file" name="iconUrl[2]" class="img_validate"  <!--{% if data.oldReward.iconUrl == '' %}-->data-rule-required="true" data-msg-required="请选择照片!"<!--{% endif %}-->/>
                                            </span>
                                        <a data-dismiss="fileupload" class="btn fileupload-exists" href="#">Remove</a>
                                        <span style="color: rgb(185, 74, 72);" class="img_note" >图片最佳尺寸：221*130</span>
                                        <span style="color: rgb(185, 74, 72);" class="img_note" hidden="hidden">图片不能为空且限于png,gif,jpeg,jpg格式</span>
                                    </div>
                                </div>
                            </div>

                            <div class="control-group">
                                <div class="controls"  id="div_icon_old" style="display:none;">
                                    <div class="input-append">
                                        <input class="selected_cardCode" name="card_code[2]" value="<!--{%if data.oldReward.giftId %}--><!--{{data.oldReward.giftId}}--><!--{%endif%}-->" type="hidden"/>
                                        <input type="text" readonly class="input-small selected_card_name" name="card_des[2]" value="<!--{{ data.oldReward.giftName }}-->" data-rule-required="true" data-msg-required="请选择礼包" />
                                        <!--{%if data.oldReward.giftId %}--><input type="hidden" name="card_code_old[2]" value="<!--{{data.oldReward.giftId}}-->"/><!--{%endif%}-->
                                        <span class="add-on select-card-code">选择</span>
                                        <span class="add-on can-use">可上架礼包<span class="text-error"><!--{% if data.oldReward.cardnum %}--><!--{{data.oldReward.cardnum}}--><!--{% else %}-->0<!--{% endif %}--></span>个</span>
                                    </div>
                                    <div class="input-append">
                                        &nbsp;
                                        <input type="hidden" name="card_change[2]" value=""/>
                                        <input type="text" name= "totalCount[2]" class="input-min xxx totalCount" value="<!--{% if data.oldReward.rewardType == '3' %}--><!--{{data.oldReward.totalCount}}--><!--{% else %}-->0<!--{% endif %}-->" readonly="readonly">
                                        <input type="text" name="total[2]" class="input-min" value=""  />
                                        <span class="add-on get_gift" id="get_gift_old">分配</span>
                                    </div>
                                </div>
                                
                                <div class="controls"  id="div_backpack_old" style="display:none;">
                                    <div class="input-append">
                                        <input class="selected_backpackCode" name="backpack_code[2]" value="<!--{%if data.oldReward.giftId %}--><!--{{data.oldReward.giftId}}--><!--{%endif%}-->" type="hidden"/>
                                        <input type="text" readonly class="input-small selected_backpack_name" name="backpack_name[2]" value="<!--{{ data.oldReward.giftName }}-->" data-rule-required="true" data-msg-required="请选择背包物品" />
                                        <span class="add-on select-backpack-code">选择</span>
                                    </div>
                                </div>
                            </div>
                            <div class="control-group">
                                <div class="controls">
                                    <label class="control-label">名称[例：辣条]</label>
                                    <input type="text" name="rewardName[2]" class="input-large rewardName" value="<!--{{data.oldReward.rewardName}}-->" data-rule-required="true" data-msg-required="名称不能为空"  />
                                </div>
                            </div>
                            <div class="control-group">
                                <div class="controls">
                                    <label class="control-label">规格[例：10]</label>
                                    <input type="text" name="rewardContent[2]" class="input-large rewardContent" value="<!--{{data.oldReward.rewardContent}}-->" data-rule-required="true" data-msg-required="内容不能为空"  />
                                </div>
                            </div>
                            <div class="control-group">
                                <div class="controls" id="div_num_old">
                                    <label class="control-label">份数</label>
                                    <input type="text" name="totalCount_s[2]" class="input-large" value="<!--{% if data.oldReward.rewardType != '3' and  data.oldReward.totalCount != -1 %}--><!--{{data.oldReward.totalCount}}--><!--{% endif %}-->" />
                                	<span style="color: rgb(185, 74, 72);" class="img_note" >不填表示无限份数</span>
                                </div>
                            </div>
                        </div>
                    </fieldset>

                    <div class="control-group">
                        <label class="control-label">活动规则</label>
                        <div class="controls">
                            <textarea name="ruleDescription" class="input-xxlarge" data-rule-required="true" data-msg-required="请输入活动规则"><!--{{ data.ruleDescription }}--></textarea>
                            <span class="add-on"></span>
                        </div>
                    </div>

                    <div class="control-group">
                        <label class="control-label">分享达标人数</label>
                        <div class="controls">
                            <input type="text" name="minStandard" class="input-large" value="<!--{{data.minStandard}}-->" data-rule-required="true" data-msg-required="分享达标人数不能为空"  />
                        </div>
                    </div>

                    <div class="control-group">
                        <label class="control-label">注册限定时间奖励取消</label>
                        <div class="controls">
                            <input type="text" name="timeLimit" class="input-large" value="<!--{{data.timeLimit}}-->" data-rule-required="true" data-msg-required="注册限定时间奖励取消不能为空"  />(分钟)
                        </div>
                    </div>

                    <div class="control-group">
                        <label class="control-label">分享icon</label>
                        <div class="controls">
                            <div data-provides="fileupload" class="fileupload fileupload-new">
                                <div style="max-width: 160px; max-height: 60px;" class="fileupload-new thumbnail">
                                    <img src="<!--{{ data.shareContext.icon }}-->">
                                </div>
                                <div style="max-width: 160px; max-height: 60px; line-height: 20px;" class="fileupload-preview fileupload-exists thumbnail"></div>
                                <span class="btn btn-file"><i class="icon-picture"></i>
                                    <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span>
                                    <input name="backgroundPicUrl" type="hidden" value="<!--{{ data.shareContext.icon }}-->"/>
                                    <input type="file" name="icon" <!--{% if data.shareContext.icon == '' %}-->data-rule-required="true" data-msg-required="请选择分享icon!"<!--{% endif %}-->>
                                </span>
                                <a data-dismiss="fileupload" class="btn fileupload-exists" href="#">Remove</a>
                            </div>
                        </div>
                    </div>

                    <div class="control-group">
                        <label class="control-label">分享标题</label>
                        <div class="controls">
                            <input type="text" name="title_s" class="input-xlarge" value="<!--{{data.shareContext.title}}-->" data-rule-required="true" data-msg-required="分享标题不能为空"  />
                        </div>
                    </div>

                    <div class="control-group">
                        <label class="control-label">分享内容</label>
                        <div class="controls">
                            <input type="text" name="content" class="input-xlarge" value="<!--{{data.shareContext.content}}-->" data-rule-required="true" data-msg-required="分享内容不能为空"  />
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary sub"><i class="icon-ok"></i>保存</button>
                        <input type="hidden" name="id" value="<!--{{data.id}}-->"/>
                    </div>
			    </form>
            </div>
		</div>
    </div>
</div>
<!--{%endblock%}-->
<!--{%block footer_js%}-->
<script src="/static/js/ajaxfileupload.js"></script>
<script src="/static/js/jquery.validationEngine.js"></script>
<script src="/static/js/jquery.validationEngine-en.js"></script>
<script src="/static/js/laydate/laydate.js"></script>
<script src="/static/js/plugins/multiselect/bootstrap-multiselect.js"></script>
<script>
var card_code1="";
var card_name1="";
var can_use1="";
var obj= "";
var complete_type;
var card_img = "";
var prize_gid = "";
var num_new = 0;
var num_old = 0;
var n_new = 0;
var n_old = 0;
var count_new = 0;
var count_old = 0;
var t_new = 0;
var t_old = 0;

var set_selected_game=function(game_id,game_name,icon){
    $('#selected_game_id').val(game_id);
    $('#selected_game_name').val(game_name);
    $('#selected_game_icon').attr('src',icon);
    $("#task_img").val(icon);
};
	
function platform_fade(check_val){
	switch(check_val){
		case 'ios' :
			$("#rewardType_old option[value='1']").remove();
			$("#rewardType_old option[value='2']").remove();
			$("#rewardType_old").append("<option value='6'>背包物品</option>");
			$("#rewardType_new option[value='1']").remove();
			$("#rewardType_new option[value='2']").remove();
			$("#rewardType_new").append("<option value='6'>背包物品</option>");
			$(".rwtype_old").click();
			$(".rwtype_new").click();
			break;
		default:
			$("#rewardType_old option[value='6']").remove();
			$("#rewardType_old").append("<option value='1'>实物/option>");
			$("#rewardType_old").append("<option value='2'>代充</option>");
			$("#rewardType_new option[value='6']").remove();
			$("#rewardType_new").append("<option value='1'>实物</option>");
			$("#rewardType_new").append("<option value='2'>代充</option>");
			$(".rwtype_old").click();
			$(".rwtype_new").click();
	}
}
function set_selected_card(card_code,card_name,card_stock,can_use,card_gid){
    card_code1 = card_code;
    card_name1=card_name;
    can_use1=parseInt(can_use);
    //obj.parent().parent().parent().parent().find("img").attr("src",card_img);
    obj.parent().parent().parent().find(".xxx").val(0);
    obj.parent().parent().parent().parent().find("input[name='prize_img[]']").val(card_img);
    obj.parent().parent().parent().parent().find("input[name='prize_img_new[]']").val(card_img);
    $(function(){
        obj.siblings(".selected_cardCode").val(card_code1);
        obj.siblings(".selected_card_name").val(card_name1);
        obj.siblings(".can-use").children().html(can_use1);
        obj.siblings(".prize_gid").val(prize_gid);
    })
}
function set_selected_backpack(backpack_code,backpack_name,backpack_desc,img){
    backpack_code1 = backpack_code;
    backpack_name1=backpack_name;
    backpack_desc1=backpack_desc;
    //obj.parent().parent().parent().parent().find("input[name='prize_img[]']").val(card_img);
    //obj.parent().parent().parent().parent().find("input[name='prize_img_new[]']").val(card_img);
    $(function(){
        obj.siblings(".selected_backpackCode").val(backpack_code1);
        obj.siblings(".selected_backpack_name").val(backpack_name1);
        obj.parent().parent().parent().parent().find(".rewardName").val(backpack_name1);
        obj.parent().parent().parent().parent().find(".rewardContent").val(backpack_desc1);
    })
}
function set_selected_variation(activity_id,share_title,share_pic,share_des,share_url){
    $("input[name='activity_id']").val(activity_id);
    $("input[name='share_icon']").val(share_pic);
    $("input[name='share_title']").val(share_title);
    $("input[name='share_desc']").val(share_des);
    $("input[name='share_url']").val(share_url);
    $("#share_img").attr("src",share_pic);
}

$(function() {
    $('.switchbox').bootstrapSwitch();
	//var app_platform = "<!--{{ data.platform }}-->";
    //platform_fade(app_platform);
    //提交时限制图片为空
    $(".sub").click(function() {
        var check = "true";
        $("input[name='prize_pic[]']").each(function(){
            var img = $(this).val();

            var old_img = $(this).siblings("input[name='prize_img[]']").val();
            if(!img&&!old_img){
                $(this).parent().siblings(".img_note").show();
                check = "false";
            }else{
                $(this).parent().siblings(".img_note").hide();
            }
        })

        if(!$("input[name='task_icon']").val()&&!$("#task_img").val()){
            $("#task_img").parent().siblings(".img_note").show();
            check = "false";
        }else{
            $("#task_img").parent().siblings(".img_note").hide();
        }
        if(check=="false"){
//            return false;
        }
    });

//选择游戏
//    $('.select-pop-game').bind('click', function () {
//        $.ajax({
//            url: '/a_game/api/game-search',
//            dataType: 'json',
//            success: function (json) {
//                var html = json.html;
//                $.dialog({id: 'pop-game-list', title: '提示', padding: 2, content: html, width: 600, height: 580});
//            }
//        });
//    });



//选择礼包
    $(".select-card-code").live('click',function(){
        obj = $(this);
        var val=$('input:radio[name="platforms"]:checked').val();
        if(val != 'android' && val.length>0){
            val = 'ios';
        }
        $.ajax({
            url:'/v4giftbag/package/cate-card-select',
            data:{virtualUse:1,platform:val},
            dataType:'json',
            success:function(json){
                var html = json.html;
                $.dialog({id:'pop-card-list',title:'提示',padding:2,content:html,width:600,height:580});
            }
        });
    });
    
//选择背包物品
    $(".select-backpack-code").live('click',function(){
        obj = $(this);
        var val=$('input:radio[name="platforms"]:checked').val();
        if(val != 'android' && val.length>0){
            val = 'ios';
        }
        $.ajax({
            url:'/v4backpack/goods/cate-backpack-select',
            data:{platform:val},
            dataType:'json',
            success:function(json){
                var html = json.html;
                $.dialog({id:'pop-backpack-list',title:'提示',padding:2,content:html,width:600,height:580});
            }
        });
    });

    //选择实物
//    $(".select-material-list").live('click',function(){
//        obj = $(this);
//        $.ajax({
//            url:'/v4giftbag/package/material-select',
//            dataType:'json',
//            success:function(json){
//                var html = json.html;
//                $.dialog({id:'pop-card-list',title:'提示',padding:2,content:html,width:600,height:580});
//            }
//        });
//    });

	$("input[name='platforms']").click(function() {
		var check_val = $('input[name="platforms"]:checked').val();
		platform_fade(check_val);
	})
    
    //选择活动弹窗
    $('.select-pop-activity').bind('click',function(){
        var no = $(this).attr('data-no');
        var url =  '/a_activity/activity/pop-search/'+ no;
        $.ajax({
            url:url,
            dataType:'json',
            success:function(json){
                var html = '';
                html = json.html;
                $.dialog({id:'pop-data-list',title:'提示',padding:2,content:html,width:600});
            }
        });
    });

//选择活动
//var set_selected_activity = function(id,title){
//    $('#selected_activity_aid').val(id);
//    $('#selected_activity_title').text(title);
//};
    $("#get_gift_new").on('click',function(){
        if($('input[name="card_des[1]"]').val().length == 0){
            alert('分配前请选择礼包!');
            return false;
        }
        var num = parseInt($(this).parent().prev().children(":last").children(":last").html());
        var n = parseInt($(this).prev().val());
        var t = parseInt($('input[name="totalCount[1]"]').val());

        if(num.length == 0 || num == undefined || num == 0 || num == '' || isNaN(num)){
            alert('分配前请重新选择礼包!');
            return false;
        }
        var re = /^([1-9]\d*|[0]{1,1})$/;
        if(isNaN(n) || !re.test(n)){
            alert('请输入有效分配数!');
            return false;
        }
        if(n>num){
            alert('分配数大于总数!');
            return false;
        }
        if(n_new == n && n_new != 0){
            return false;
        }
        n_new = n;
        if(count_new == 0){
            num_new = num;
            t_new = t;
        }
        var e = num_new-n;
        if(e>0){
            count_new = count_new + 1;
        }
        $(this).parent().prev().children(":last").children(":last").html(e);
        $(this).prev().prev().val(n+t_new);
        $('input[name="card_change[1]"]').val('1');
    })
    $("#get_gift_old").on('click',function(){
        if($('input[name="card_des[2]"]').val().length == 0){
            alert('分配前请选择礼包!');
            return false;
        }
        var num = parseInt($(this).parent().prev().children(":last").children(":last").html());
        var n = parseInt($(this).prev().val());
        var t = parseInt($('input[name="totalCount[2]"]').val());
        if(num.length == 0 || num == undefined || num == 0 || num == '' || isNaN(num)){
            alert('分配前请重新选择礼包!');
            return false;
        }
        var re = /^([1-9]\d*|[0]{1,1})$/;
        if(isNaN(n) || !re.test(n)){
            alert('请输入有效分配数!');
            return false;
        }
        if(n>num){
            alert('分配数大于总数!');
            return false;
        }
        if(n_old == n && n_old != 0){
            return false;
        }
        n_old = n;
        if(count_old == 0){
            num_old = num;
            t_old= t;
        }
        var e = num_old-n;
        if(e>0){
            count_old = count_old + 1;
        }

        $(this).parent().prev().children(":last").children(":last").html(e);
        $(this).prev().prev().val(n+t_old);
        $('input[name="card_change[2]"]').val('1');
    })
    $(".rwtype_new").on('click',function(){
        if($(this).val() == 3){
	        $('#div_icon_new').show();
	        $('#div_backpack_new').hide();
	        $('#div_num_new').hide();
	    }else if($(this).val() == 6){
	        $('#div_icon_new').hide();
	        $('#div_backpack_new').show();
	        $('#div_num_new').show();
        }else{
	        $('#div_icon_new').hide();
	        $('#div_backpack_new').hide();
	        $('#div_num_new').show();
        }
    })
    $(".rwtype_old").on('click',function(){
        if($(this).val() == 3){
	        $('#div_icon_old').show();
	        $('#div_backpack_old').hide();
	        $('#div_num_old').hide();
	    }else if($(this).val() == 6){
	    	$('#div_icon_old').hide();
	        $('#div_backpack_old').show();
	        $('#div_num_old').show();
        }else{
	        $('#div_icon_old').hide();
	        $('#div_backpack_old').hide();
	        $('#div_num_old').show();
        }
    })	
    if($('.rwtype_old option:selected').val() == 3){
        $('#div_icon_old').show();
        $('#div_backpack_old').hide();
        $('#div_num_old').hide();
    }else if($('.rwtype_old option:selected').val() == 6){
    	$('#div_icon_old').hide();
        $('#div_backpack_old').show();
        $('#div_num_old').show();
    }else{
        $('#div_icon_old').hide();
        $('#div_backpack_old').hide();
        $('#div_num_old').show();
    }
    if($('.rwtype_new option:selected').val() == 3){
        $('#div_icon_new').show();
        $('#div_backpack_new').hide();
        $('#div_num_new').hide();
    }else if($('.rwtype_new option:selected').val() == 6){
        $('#div_icon_new').hide();
        $('#div_backpack_new').show();
        $('#div_num_new').show();
    }else{
        $('#div_icon_new').hide();
        $('#div_backpack_new').hide();
        $('#div_num_new').show();
    }
});
</script>
<!--{%endblock%}-->