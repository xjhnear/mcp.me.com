<!--{%extends "sub-layout-topic.twig"%}-->
<!--{%block main_content%}-->
<div class="row-fluid">
	<div class="span12">
		<div class="box">
			<div class="box-title">
				<h3>
					<i class="icon-edit"></i>
					编辑专题合集
				</h3>
				<div class="actions">
				</div>
			</div>
			<div class="box-content">
				<form id="form-activity" action="<!--{{url('topic/topicinfo/add-edit',datainfo.id)}}-->" method="POST" class="form-horizontal form-validate" enctype="multipart/form-data">
					<input type="hidden" id="platform" name="platform" value="<!--{{datainfo.apptype}}-->" >
					<div class="control-group">
						<label for="textfield" class="control-label">*专题标题</label>
						<div class="controls">
							<input id="title" class="input-xlarge" data-rule-required="true" data-msg-required="请填写专题标题" type="text" value="<!--{{datainfo.ztitle}}-->" name="ztitle">
						</div>
					</div>
					<div class="control-group">
						<label for="textfield" class="control-label">*发布平台<span class="help-block">至少选择一个</span></label>
						<div class="controls">
							<label class="checkbox inline"><input id="check-plat_ios" class="checkboxer" type="checkbox" name="checkname"  value="1"   data-rule-required="true" data-msg-required="至少选择1个"   > IOS</label>
							<label class="checkbox inline"><input class="checkboxer" id="check-plat_a" type="checkbox" name="checkname" value="2"  data-rule-required="true" data-msg-required="至少选择1个"> Android</label>
						</div>
					</div>
					<div class="control-group" id="iosganme"  style="display:none;"  >
						<label for="textfield" class="control-label">*IOS游戏</label>
						<div class="controls">
						    <div class="input-append">
						        <input type="text" id="selected_ios_gameId" name="iosId"   class="input-xlarge" value="<!--{{datainfo.gid}}-->" data-rule-required="true" data-msg-required="请选择IOS游戏" />
								<span datatype='ios' class="add-on select-pop-select">选择IOS游戏
								</span>
								<span class="help-block">至少选择一个</span>
							</div>												
						</div>
				    </div>
				    <div class="control-group" id="androidgame"  style="display:none;"  >
						<label for="textfield" class="control-label">*安卓游戏</label>
						<div class="controls">
						    <div class="input-append">
						        <input type="text" id="selected_a_gameId" name="androidId" class="input-xlarge" value="<!--{{datainfo.agid}}-->" data-rule-required="true" data-msg-required="请选择安卓游戏" />
								<span  datatype='a' class="add-on select-pop-select">选择安卓游戏</span>

							</div>												
						</div>

				    </div>
					<div class="control-group">
							<label class="control-label">*主页推荐</label>
							<div class="controls">
								<input id="discount" name="toggle" data-on-color="success" data-on-text="开" data-off-color="danger" data-off-text="关" class="switchbox" type="checkbox"
								<!--{% if datainfo.flag == 1 %}--> 
							        checked
							   	<!--{% endif %}--> />
							</div>
					</div>
					<div class="control-group">
						<label class="control-label">*作者</label>
						<div class="controls">
							<input id="title" class="input-xlarge" data-rule-required="true" data-msg-required="请填写作者" value="<!--{{datainfo.writer}}-->" type="text" name="writer">
						</div>
					</div>
					<div class="control-group">
						<label class="control-label">*专题介绍</label>
						<div class="controls">
							<textarea id="description"  data-rule-required="true" data-msg-required="请专题介绍"  class="input-xlarge valid" name="description" rows="3">
							</textarea>
						</div>
					</div>
					

					<div class="control-group">
                        <label class="control-label">*专题缩略图</label>
                        <div class="controls">
                            <div class="fileupload fileupload-new" data-provides="fileupload">
                                <div class="fileupload-new thumbnail" style="max-width: 120px; max-height: 120px;"><img id="listpic_img" src="<!--{%if datainfo.litpic%}--><!--{%endif%}--><!--{{datainfo.litpic|default('/static/img/nopic.gif')}}-->" /></div>
                                <div class="fileupload-preview fileupload-exists thumbnail" style="max-width: 120px; max-height: 120px; line-height: 20px;"></div>
                                <div>
                                    <span class="btn btn-file"><i class="icon-picture"></i><span class="fileupload-new">选择照片</span><span class="fileupload-exists">重新选择</span><input id="litpic" type="file" name='litpic' /></span>
                                </div>
                            </div>
                            <span class="help-inline"></span>
                        </div>
                    </div>
					<div class="control-group">
						<label class="control-label"></label>
						<div class="controls">
							<input type="submit" value="确认" class="btn btn-primary">
						</div>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>
<!--{%endblock%}-->
<!--{%block footer_js%}-->

<script src="/static/js/laypage.js"></script>
<script src="/static/js/elastic-dialog.js"></script>
<script>
	$(function(){
		var ag=$("#androidgame"),ig=$("#iosganme"),pf=$("#platform");
		<!--{% if datainfo.description %}-->
			$("#description").html($.trim("<!--{{datainfo.description}}-->"));
		<!--{%endif%}-->
		<!--{% if datainfo.apptype == 3 %}-->
			$("#check-plat_ios,#check-plat_a").attr('checked','checked'); 
			ag.show();
			ig.show();
		<!--{% elseif datainfo.apptype == 1 %}-->
			$("#check-plat_ios").attr('checked','checked');
			ig.show();	
		<!--{% elseif datainfo.apptype == 2 %}-->	
			$("#check-plat_a").attr('checked','checked');
			ag.show();
		<!--{%endif%}-->
		$('input').iCheck({
			checkboxClass: 'icheckbox_square-orange',
			radioClass: 'iradio_square-orange',
			increaseArea: '20%' // optional
		});

		
		$('.switchbox').bootstrapSwitch();
		
		$("input").on('ifChecked',function(){
			 var t=$(this).val();
			 if(t == 2){
			 	ag.show();
			 	pf.val((pf.val() == '') ? 2 : 3);
			 }else if(t == 1){
			 	ig.show();
			 	pf.val((pf.val() == '') ? 1 : 3);
			 }
		}).on('ifUnchecked',function(){
			 var t=$(this).val();
			 if(t == 2){
			 	ag.hide();
			 	pf.val((pf.val() == 3) ? 1 : '');
			 }else if(t == 1){
				ig.hide();
			 	pf.val((pf.val() == 3) ? 2 : '');
			 }
		});
		$('.select-pop-select').on('click',function(){
			var opt_={
        			url:'/topic/topicinfo/select-layer/2',
        			returnInput:['selected_a_gameId'],
        			//table:'games_apk',
        			//select:['games_apk.id','games_apk.ico as ico','games_apk.shortgname as //shortgname','typename'],
        	}
        	if($(this).attr('datatype') == 'ios'){
        		var opt_={
        			url:'/topic/topicinfo/select-layer/1',
        			returnInput:['selected_ios_gameId'],
        			//table:'games',
        			//select:['games.id','games.ico as ico','games.shortgname as //shortgname','typename'],
        		}
        	}
        	var opt={	
				 url:opt_.url,
			 	 threadth:['ID','图标','游戏','类型'],
				 trWidth:['120','120','120','120'],
			 	 //table:opt_.table,
			 	 //database:'cms',	
			 	 //jointables:[{'jointables':'game_type','key_1':'game_type.//id','fuhao':'=','key_2':'type'}],
			 	 //select:opt_.select,
			 	 searchkey:['=yxd_www.m_games.id','=shortgname'],
			 	 selectkey:['id','ico','shortgname','typename'],
			 	 tbodytd:['text','img','text','text'],
			 	 returnField:['id'],
			 	 returnInput:opt_.returnInput,
			 	 needFilter:[{"is_del":"0"}],
			 	 is_checkboxs:1,
			 	 searchhtml:['<input type="text" placeholder="请填写游戏ID"  name="=yxd_www.m_games.id">','<input type="text" name="=shortgname" placeholder="请填写游戏名称">'],
			 	 
			}
			selectdialog(opt);
		});
		
	});

</script>
<!--{%endblock%}-->
