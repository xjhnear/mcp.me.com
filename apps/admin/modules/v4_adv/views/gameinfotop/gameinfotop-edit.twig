<!--{%extends "../sub-layout-giftbag.twig"%}-->
<!--{%block main_content%}-->
<div class="row-fluid">
    <div class="span12">
        <div class="box">
            <div class="box-title">
                <h3><i class="icon-edit"></i>修改游戏详情广告</h3>
            </div>

            <div class="box-content">
                <form id="gift-info-form" action="<!--{{url('/v4adv/gameinfotop/edit')}}-->" method="POST" class='form-horizontal form-validate' enctype="multipart/form-data">
                    <input name="id" type="hidden" value="<!--{{data.id}}-->"  />
                    <div class="control-group">
                        <label class="control-label">平台区分</label>
                        <div class="controls">
                        	<!--{% if data.platform == 'ios' %}-->
                            	<input type="radio" name="platform" value="ios" <!--{% if data.platform == 'ios' %}-->checked<!--{% endif %}--> >游戏多IOS
                            <!--{% else %}-->
                            	<input type="radio" name="platform" value="iosyn" <!--{% if data.platform == 'iosyn' %}-->checked<!--{% endif %}--> >游戏多IOS业内版
                            <!--{% endif %}-->
                        </div>
                    </div>
                    <!-- <div class="control-group" >
                        <label class="control-label">广告名:</label>
                        <div class="controls">
                            <input type="text" name="adv_name" class="input-large" value="<!--{{data.adv_name}}-->" data-rule-required="true"  data-msg-required="请填写广告名" />
                        </div>
                    </div> -->
                    <div class="control-group">
                        <label class="control-label">推荐游戏</label>
                        <div class="controls">
                            <div class="input-append">
                                <input id="selected_game_id" name="game_id" type="hidden" value="<!--{{ data.game_id }}-->"/>
                                <input type="text" readonly id="selected_game_name" name="name" class="input-medium" value="<!--{{ data.name }}-->" />
                                <span class="add-on select-pop-game">选择游戏</span>
                            </div>
                        </div>
                    </div>

                    <div class="row-fluid" id="radio">
                        <div class="span3">
                            <div class="control-group">
                                <label class="control-label">广告类型：</label>
                                <div class="controls">
                                    <input name="adv_type" type="radio" value="1" <!--{{ data.adv_type == 1 ? 'checked' : '' }}--> />广告图
                                </div>
                            </div>
                        </div>
                        <div class="span3">
                            <div class="controls">
                                <input name="adv_type" type="radio" value="2" <!--{{ data.adv_type == 2 ? 'checked' : '' }}--> />广告视频
                            </div>
                        </div>

                    </div>


                    <div class="row-fluid">
                        <div class="span4">
                            <div class="control-group">
                                <label class="control-label">*开始时间</label>
                                <div class="controls">
                                    <input name="startTime" id="StartDate" type="text" class="input-medium laydate-icon" value="<!--{{ data.startTime }}-->" data-rule-required="false"  data-msg-required="请填写开始时间"  readonly>


                                </div>
                            </div>
                        </div>
                        <div class="span4">
                            <div class="control-group">
                                <label class="control-label">*结束时间</label>
                                <div class="controls">
                                    <input name="endTime" id="EndDate" type="text" class="input-medium laydate-icon" value="<!--{{ data.endTime }}-->" data-rule-required="false"  data-msg-required="请填写结束时间" readonly>

                                </div>
                            </div>
                        </div>
                        <span style = "color:red;">* 开始结束时间不填写默认无限长 </span>
                    </div>


                    <div class="row-fluid" id="radio">
                        <div class="span3">
                            <div class="control-group">
                                <label class="control-label">属性：</label>
                                <div class="controls">
                                    <input name="attribute" type="radio" value="1" <!--{{data.attribute == 1 ? 'checked' : '' }}--> />上架
                                </div>
                            </div>
                        </div>
                        <!--
                        <div class="span3">
                            <div class="controls">
                                <input name="attribute" type="radio" value="2" <!--{{data.attribute == 2 ? 'checked' : '' }}--> />到开始时间自动上架
                            </div>
                        </div>
                        <div class="span3">
                            <div class="controls">
                                <input name="attribute" type="radio" value="3" <!--{{data.attribute == 3 ? 'checked' : '' }}--> />到结束时间自动下架
                            </div>
                        </div>
                         -->
                        <div class="span3">
                            <div class="controls">
                                <input name="attribute" type="radio" value="4" <!--{{ data.attribute == 4 ? 'checked' : '' }}--> />下架
                            </div>
                        </div>
                    </div>

                    <div class="control-group" id="video_url">
                            <label class="control-label">视频链接:</label>
                            <div class="controls">
                                <input type="text" name="urlAddress_video" class="input-large" value="<!--{{data.urlAddress}}-->"  data-rule-required="true" data-msg-required="请填写视频链接" />
                            </div>
                    </div>
                    <div class="row-fluid">
                        <div class="span3">
                            <div class="control-group">
                                <label class="control-label">广告图:</label>
                                <div class="controls">
                                    <div class="fileupload fileupload-new" data-provides="fileupload">
                                        <div class="fileupload-new thumbnail" style="max-width: 120px; max-height: 120px;">
                                            <img src="<!--{{data.adv_img|default('/static/img/nopic.gif')}}-->" />
                                        </div>
                                        <div class="fileupload-preview fileupload-exists thumbnail" style="max-width: 120px; max-height: 120px; line-height: 20px;"></div>
                                        <div>
                                            <span class="btn btn-file"><i class="icon-picture"></i><span class="fileupload-new">选择图片</span><span class="fileupload-exists">重新选择</span><input type="file" name='adv_img' /></span>
                                        </div>
                                    </div>
                                    <span class="help-inline"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="control-group" id="adv_pic">
                                        

                    <div class="row-fluid" id="radio_type">
                        <div class="span4">
                            <div class="control-group">
                                <label class="control-label">广告跳转类型：</label>
                                <div class="controls">
                                    <!--{{form_select('adv_href_type',type,data.adv_href_type,{'class':'input-small','id':'adv_href_type'})}}-->
                                </div>
                            </div>
                        </div>
                        <div class="span4" id="span_search">
                            <div class="control-group">
                                <label class="control-label">检索功能：</label>
                                <div class="controls">
                                    <input name="searchName" id="search_name" type="text" class="input-medium" value="<!--{{ data.searchName }}-->" >
                                </div>
                            </div>
                        </div>
                    </div>
                        <div class="row-fluid" id="isautologin_div" <!--{% if data.adv_href_type!="外部url" and data.adv_href_type!="内部safari" %}--> style="display:none" <!--{%endif%}--> >
                        <div class="span3">
                            <div class="control-group">
                                <label class="control-label">是否自动登录：</label>
                                <div class="controls">
                                    <!--{{form_radio('isAutoLogin',1,data.isAutoLogin==1)}}-->是
                                </div>
                            </div>
                        </div>
                        <div class="span3">
                            <div class="control-group">
                                <div class="controls">
                                    <!--{{form_radio('isAutoLogin',2,data.isAutoLogin==2)}}-->否
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="control-group" id="data_id">
                        <label class="control-label">id：</label>
                        <div class="controls">
                            <input type="text" name="urlId" class="input-large" value="<!--{{data.urlId}}-->" data-rule-required="true" data-msg-required="请填写id"/>
                        </div>
                    </div>
                    <intput type="hidden" name="thirdParty_" value="<!--{{data.thirdParty}}-->"/>

                    <div id="three">             	
                    <div id="third">
                    	<input id="third-count" name="third-count" type="hidden" value="<!--{{data.thirdcount}}-->" />
                    	<input id="third-delids" name="third-delids" type="hidden" value="" />
	                    <div class="control-group"id="data_url" >
	                        <label class="control-label">url地址:</label>
	                        <div class="controls">
	                            <input type="text" name="urlAddress" class="input-large" value="<!--{{data.urlAddress}}-->" />
	                        </div>
	                    </div>
						<!--{% for third in data.thirdVendorsList %}-->
                    	<!--{% set i = 1 %}-->
                    	<div id="third-sub-<!--{{i}}-->" >
                    	<button type="button" class="btn btn-danger third-del control-group">X</button> 
                    	<input name="thirdid[]" type="hidden" class="input-xxlarge thirdid" value="<!--{{third.id}}-->" />

                        <intput type="hidden" name="thirdParty_" value="<!--{{data.thirdParty}}-->">
                        <div class="control-group" >
                            <label class="control-label">第三方地址:</label>
                            <div class="controls">
                                <input type="text" name="address[]" class="input-large" value="<!--{{third.address}}-->" />
                            </div>
                        </div>
                        <div class="control-group" >
                            <label class="control-label">第三方MAC:</label>
                            <div class="controls">
                                <input type="text" name="mac[]" class="input-large" value="<!--{{third.mac}}-->" />
                            </div>
                        </div>
                        <div class="control-group" >
                            <label class="control-label">第三方idfa:</label>
                            <div class="controls">
                                <input type="text" name="idfa[]" class="input-large" value="<!--{{third.idfa}}-->" />
                            </div>
                        </div>
                        <div class="control-group" >
                            <label class="control-label">第三方openudid:</label>
                            <div class="controls">
                                <input type="text" name="openudid[]" class="input-large" value="<!--{{third.openudid}}-->" />
                            </div>
                        </div>
                        <div class="control-group" >
                            <label class="control-label">第三方OS:</label>
                            <div class="controls">
                                <input type="text" name="os[]" class="input-large" value="<!--{{third.os}}-->" />
                            </div>
                        </div>
                        <div class="control-group" >
                            <label class="control-label">第三方PLAT:</label>
                            <div class="controls">
                                <input type="text" name="plat[]" class="input-large" value="<!--{{third.plat}}-->" />
                            </div>
                        </div>
                        <div class="control-group" >
                            <label class="control-label">第三方callback:</label>
                            <div class="controls">
                                <input type="text" name="callback[]" class="input-large" value="<!--{{third.callback}}-->" />
                            </div>
                        </div>
                        </div>
                    	<!--{% set i = i + 1 %}-->
                    	<!--{% endfor %}-->
                    </div>
                    <div>
                        <button type="button" class="btn btn-primary third-add">新增第三方链接</button>
                    </div>
                    </div>
					</div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary"><i class="icon-ok"></i>保存</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div id="third-module" style="display:none">
                    	<button type="button" class="btn btn-danger third-del control-group">X</button> 
                    	<input name="thirdid[]" type="hidden" class="input-xxlarge thirdid" value="" />
                        <div class="control-group" >
                            <label class="control-label">第三方地址:</label>
                            <div class="controls">
                                <input type="text" name="address[]" class="input-large" value="" />
                            </div>
                        </div>
                        <div class="control-group" >
                            <label class="control-label">第三方MAC:</label>
                            <div class="controls">
                                <input type="text" name="mac[]" class="input-large" value="" />
                            </div>
                        </div>
                        <div class="control-group" >
                            <label class="control-label">第三方idfa:</label>
                            <div class="controls">
                                <input type="text" name="idfa[]" class="input-large" value="" />
                            </div>
                        </div>
                        <div class="control-group" >
                            <label class="control-label">第三方openudid:</label>
                            <div class="controls">
                                <input type="text" name="openudid[]" class="input-large" value="" />
                            </div>
                        </div>
                        <div class="control-group" >
                            <label class="control-label">第三方OS:</label>
                            <div class="controls">
                                <input type="text" name="os[]" class="input-large" value="" />
                            </div>
                        </div>
                        <div class="control-group" >
                            <label class="control-label">第三方PLAT:</label>
                            <div class="controls">
                                <input type="text" name="plat[]" class="input-large" value="" />
                            </div>
                        </div>
                        <div class="control-group" >
                            <label class="control-label">第三方callback:</label>
                            <div class="controls">
                                <input type="text" name="callback[]" class="input-large" value="" />
                            </div>
                        </div>
</div>
<!--{%endblock%}-->
<!--{%block footer_js%}-->

<script src="/static/js/jquery.validationEngine.js"></script>
<script src="/static/js/jquery.validationEngine-en.js"></script>
<script src="<!--{{asset('/static/js/laydate/laydate.js')}}-->"></script>
<link rel="stylesheet" href="<!--{{asset('/static/js/autosuggest_v2.1.3/css/autosuggest_inquisitor.css')}}-->">
<script src="<!--{{asset('/static/js/autosuggest_v2.1.3/js/bsn.AutoSuggest_2.1.3_comp.js ')}}-->"></script>
<script src="<!--{{asset('/static/js/MyHelp.js')}}-->"></script>
<script>
    $("#adv_href_type").change(function () {
        var select_type_val = $(this).children('option:selected').val();
        if(select_type_val == "外部url" || select_type_val == "内部safari" ){
            $("#isautologin_div").fadeIn();
        }else{
            $("#isautologin_div").fadeOut();
        }
    })
    $("#radio > input").iCheck({
        checkboxClass: 'icheckbox_square-orange',
        radioClass: 'iradio_square-orange',
        increaseArea: '20%' // optional
    });
    getStart_End_date();

	setAdv_href_type($("#adv_href_type").val())
    set_adv_type($("input[name='adv_type']:checked").val());

    $("input[name='adv_type']").on('ifChecked',function(){
        var adv_type = $(this).val();
        setAdv_href_type($("#adv_href_type").val());
        set_adv_type(adv_type);
    });

    function set_adv_type(adv_type){
        if(adv_type == 2){
        	$('#adv_pic').fadeOut();
        	$('#video_url').fadeIn();
        	$("#adv_href_type").val('内部safari');
	        setAdv_href_type($("#adv_href_type").val());
        }else{
        	$('#adv_pic').fadeIn();
        	$('#video_url').fadeOut();
        }
    }
    
    
    $("#adv_href_type").on('change',function(){
        setAdv_href_type($(this).val())
    });

    var set_selected_game=function(game_id,game_name,icon){
        $('#selected_game_id').val(game_id);
        $('#selected_game_name').val(game_name);
    };

    $('span.select-pop-game').bind('click',function(){
        $.ajax({
            url:'/game/api/game-search',
            dataType:'json',
            success:function(json){
                var html = json.html;
                $.dialog({id:'pop-game-list',title:'提示',padding:2,content:html,width:600,height:580});
            }
        });
    });
        $('.third-add').bind('click',function(){
        	var c = Number($('#third-count').val());
        	c = c + 1;
        	$('#third-count').val(c);
			$('#third').append('<div id="third-sub-'+c+'">'+$('#third-module').html()+'</div>');
        });
        $('.third-del').live('click',function(){
        	if ($(this).parent().children('.thirdid').val()) {
        		var ids = $('#third-delids').val();
        		if (ids) {
        			ids += ',';
        		}
        		ids += $(this).parent().children('.thirdid').val();
        		$('#third-delids').val(ids);
        	}
        	var c = Number($('#third-count').val());
        	c = c - 1;
        	$('#third-count').val(c);
        	$(this).parent().remove();
        });
</script>
<!--{%endblock%}-->