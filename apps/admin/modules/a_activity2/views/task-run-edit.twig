<!--{%extends "base-layout.twig"%}-->
<!--{%block main_content%}-->
<div class="row-fluid">
    <div class="span12">
		<div class="box">
			<div class="box-title">
				<h3><i class="icon-edit"></i>活动信息</h3>
			</div>
			<div class="box-content">
			    <form id="activity-task" action="<!--{{url('a_activity/atask/do-task')}}-->" method="POST" class='form-horizontal form-validate' enctype="multipart/form-data">
			    <input id="id" name="id" type="hidden" value="<!--{{atask.id}}-->" />
			    <input name="action_type" type="hidden" value="<!--{{atask.action_type}}-->" />
				<div class="control-group">
					<label class="control-label">标题</label>
					<div class="controls">
						<input type="text" name="title" class="input-xxlarge" value="<!--{{atask.title}}-->" data-rule-required="true" data-msg-required="标题不能为空"  />
					</div>
				</div>				
				<div class="control-group">
					<label class="control-label">类型</label>
					<div class="controls">
					    <!--{{action_types[atask.action_type]}}-->
					</div>
				</div>
				<div class="control-group">
					<label class="control-label">任务线</label>
					<div class="controls">
					    <label class="checkbox inline">
				        <!--{{form_checkbox('is_relation_task',1,atask.is_relation_task==1,{'id':'is_relation_task'})}}-->属于任务线					        					        
				        </label>
					</div>
				</div>
				<div class="control-group">
					<label class="control-label">前置任务</label>
					<div class="controls">
				        <input name="relation_task_id" type="text" class="input-small" value="<!--{{atask.relation_task_id|default(0)}}-->" />
					</div>
				</div>
				<!--{%if atask.action_type==1%}-->
				<div class="control-group">
				    <label class="control-label">试玩完成条件</label>
					<div class="controls">
					    <!--{{form_select('complete_type',conditions,atask.complete_type,{'id':'complete_type'})}}-->
					</div>
				</div>
				<div id="dd_total_time" class="control-group">
					<label class="control-label">试玩时长</label>
					<div class="controls">
						<div class="input-append">
							<input type="text" name="total_time" class="input-min" value="<!--{{atask.complete_condition.total_time}}-->" />
							<span class="add-on">分钟</span>
						</div>
					</div>
				</div>
				<!--{%endif%}-->
				<!--{%if atask.action_type==2%}-->
				<div class="control-group">
					<label for="textfield" class="control-label">分享标题</label>
					<div class="controls">
						<input name="share_title" type="text" class="input-xxlarge" value="<!--{{atask.complete_condition.share_title}}-->" data-rule-required="true" data-msg-required="分享标题不能为空" />
					</div>
				</div>				
				<div class="control-group">
					<label class="control-label">小图</label>
					<div class="controls">
						<div class="fileupload fileupload-new" data-provides="fileupload">
						    <input name="share_icon" type="hidden" value="<!--{{atask.complete_condition.share_icon}}-->" />
							<div class="fileupload-new thumbnail" style="max-width: 120px; max-height: 120px;"><img src="<!--{%if atask.complete_condition.share_icon%}--><!--{%endif%}--><!--{{atask.complete_condition.share_icon|default('/static/img/nopic.gif')}}-->" /></div>
							<div class="fileupload-preview fileupload-exists thumbnail" style="max-width: 120px; max-height: 120px; line-height: 20px;"></div>
							<div>
								<span class="btn btn-file"><i class="icon-picture"></i><span class="fileupload-new">选择照片</span><span class="fileupload-exists">重新选择</span><input type="file" name='icon'  /></span>
							</div>
						</div>
						<span class="help-inline">小图最佳尺寸：120*120</span>
					</div>
				</div>
				<div class="control-group">
					<label for="textfield" class="control-label">微信模板内容</label>
					<div class="controls">
						<textarea name="share_weixin" class="input-xxlarge" rows="3" data-rule-required="true" data-msg-required="分享内容不能为空" ><!--{{atask.complete_condition.share_weixin}}--></textarea>
					</div>
				</div>
				<div class="control-group">
					<label for="textfield" class="control-label">跳转URL</label>
					<div class="controls">
					    <input name="redirect_url" type="text" class="input-xxlarge" value="<!--{{atask.complete_condition.share_redirect_url}}-->" data-rule-required="true" data-msg-required="跳转链接不能为空"  />
					</div>
				</div>
				<div class="control-group">
					<label for="textfield" class="control-label">完成需独立点击IP数</label>
					<div class="controls">
					    <input name="ip_limit_times" type="text" class="input-small" value="<!--{{atask.complete_condition.ip_limit_times|default(3)}}-->" data-rule-required="true" data-msg-required="IP数不能为空"  />
					</div>
				</div>
				<!--{%endif%}-->
				<!--{%if atask.action_type==3%}-->
				<div class="control-group">
					<label class="control-label">表单选项</label>
					<div class="controls">
						<!--{% for key,fset in formset %}-->
						<input type="checkbox" class="validate[minCheckbox[1]]" name="<!--{{ key }}-->" checked><!--{{ fset }}-->						
						<!--{% endfor %}-->
					</div>
				</div>
				<!--{%endif%}-->
				<div class="control-group">
					<label class="control-label">所属游戏</label>
					<div class="controls">
					    <input id="gameselect" name="gid" data-from="android" type="hidden" value="<!--{{atask.gid}}-->" class="bigdrop select2-offscreen" style="width:200px" tabindex="-1" data-rule-required="true" data-msg-required="请选择游戏" />
					</div>					
				</div>
				<div class="control-group">
					<label class="control-label">游戏包名</label>
					<div class="controls">
						<input type="text" name="game_package_name" class="input-xlarge" value="<!--{{atask.game_package_name}}-->" data-rule-required="true" data-msg-required="游戏包名不能为空"  />
					</div>
				</div>							
				<div class="row-fluid">	
				    <div class="span4">			
						<div class="control-group">
							<label class="control-label">开始时间</label>
							<div class="controls">
								<div class="input-append date">
									<input name="start_time" type="text" class="input-medium datetimepicker" value="<!--{{atask.start_time|date('Y-m-d')}}-->" readonly="">
									<span class="add-on"><i class="icon-calendar"></i></span>
								</div>
							</div>
						</div>
					</div>
					<div class="span4">						
						<div class="control-group">
							<label class="control-label">结束时间</label>
							<div class="controls">
								<div class="input-append date">
									<input name="end_time" type="text" class="input-medium datetimepicker" value="<!--{{atask.end_time|date('Y-m-d')}}-->" readonly="">
									<span class="add-on"><i class="icon-calendar"></i></span>
								</div>
							</div>
						</div>
				    </div>
				</div>
				
				<div class="control-group">
					<label class="control-label">游币奖励</label>
					<div class="controls">
					    <div class="input-append input-prepend">
					    <!--{{form_radio('reward_type','money',atask.reward_type=='money')}}-->
						<input type="text" name="money" class="input-small" value="<!--{{atask.money|default('0')}}-->"  />
						</div>
					</div>
				</div>
				<!--{#
				<div class="control-group">
					<label class="control-label">礼包奖励</label>
					<div class="controls">
					    <div class="input-append input-prepend">
					        <!--{{form_radio('reward_type','giftbag',atask.reward_type=='giftbag')}}-->
						    <input id="selected_giftbag_aid" type="hidden" name="giftbag_id" value="<!--{{atask.giftbag_id|default('')}}-->"  />
							<span id="selected_giftbag_title" class="input-xlarge uneditable-input"></span>
							<span class="add-on select-pop-giftbag">选择礼包</span>
							<a class="add-on" href="<!--{{url('a_giftbag/gift/add')}}-->" target="_blank">添加新礼包</a>
						</div>
					</div>
				</div>
				<div class="control-group">
					<label class="control-label">商品奖励</label>
					<div class="controls">
					    <div class="input-append input-prepend">
					    <!--{{form_radio('reward_type','goods',atask.reward_type=='goods')}}-->
						<input type="text" name="goods" class="input-medium" value="<!--{{atask.goods_id|default('')}}-->"  />
						</div>
					</div>
				</div>
				<div class="control-group">
					<label class="control-label">代充奖励</label>
					<div class="controls">
					    <div class="input-append input-prepend">
					    <!--{{form_radio('reward_type','charge',atask.reward_type=='charge')}}-->
						<input type="text" name="charge" class="input-medium" value="<!--{{atask.goods_id|default('')}}-->"  />
						</div>
					</div>
				</div>
				<div class="control-group">
					<label class="control-label">Q币奖励</label>
					<div class="controls">
					    <div class="input-append input-prepend">
					    <!--{{form_radio('reward_type','qb',atask.reward_type=='qb')}}-->
						<input type="text" name="qb" class="input-medium" value="<!--{{atask.goods_id|default('')}}-->"  />
						</div>
					</div>
				</div>
				#}-->
				<!--{%if atask.id%}-->
				<div class="control-group">
					<label class="control-label">修改奖励量</label>
					<div class="controls">
						<input type="text" name="change_num" class="input-small" value="0" />
						<span class="help-inline">增加为正值,减少为负值</span>
					</div>
				</div>
				<!--{%else%}-->
				<div class="control-group">
					<label class="control-label">奖励数量</label>
					<div class="controls">
						<input type="text" name="total_num" class="input-small" value="<!--{{atask.total_num}}-->" />
					</div>
				</div>				
				<!--{%endif%}-->
				<div class="control-group">
					<label class="control-label">属性</label>
					<div class="controls">					    
				        <label class="checkbox inline">
				        <!--{{form_checkbox('is_top',1,atask.is_top==1)}}-->置顶					        					        
				        </label>
				        <label class="checkbox inline">
				        <!--{{form_checkbox('is_show',1,atask.is_show==1)}}-->显示					        					        
				        </label>				        				      
					</div>
				</div>	
				<div class="control-group">
					<label class="control-label">排序</label>
					<div class="controls">
						<input type="text" name="sort" class="input-small" value="<!--{{atask.sort|default('0')}}-->" />
					</div>
				</div>													
				<div class="control-group">
					<label for="textfield" class="control-label">内容</label>
					<div class="controls">
					    <script id="container" name="content" type="text/plain"><!--{{atask.content}}--></script>
					</div>
				</div>							
			    <div class="form-actions">
					<button type="submit" class="btn btn-primary"><i class="icon-ok"></i>保存</button>
				</div> 
			    </form>
			</div>
		</div>
    </div>
</div>
<!--{%endblock%}-->
<!--{%block footer_js%}-->
<script src="<!--{{asset('/static/js/ueditor/ueditor.config.js')}}-->"></script>
<script src="<!--{{asset('/static/js/ueditor/ueditor.all.js')}}-->"></script>
<script src="<!--{{asset('/static/js/ueditor/lang/zh-cn/zh-cn.js')}}-->"></script>
<script>
//选择礼包
var set_selected_giftbag = function(id,title){
    $('#selected_giftbag_aid').val(id);
    $('#selected_giftbag_title').text(title);
};
$(function(){
    var editor = UE.getEditor('container');
    gameselect('#gameselect');
    $('input.datetimepicker').datetimepicker({format:'Y-m-d',lang:'ch'});
    var complete_type = $('#complete_type').val();
    if(complete_type=='running'){
        $('#dd_total_time').show();
    }else{
        $('#dd_total_time').hide();
    }
    
    $('#complete_type').change(function(){
        if($(this).val()=='running'){
	        $('#dd_total_time').show();
	    }else{
	        $('#dd_total_time').hide();
	    }
    });
    
    $('input').iCheck({
		checkboxClass: 'icheckbox_square-orange',
		radioClass: 'iradio_square-orange',
		increaseArea: '20%' // optional
	});
	$('.switchbox').bootstrapSwitch();
	
	//选择礼包弹窗
	$('.select-pop-giftbag').bind('click',function(){
        var no = $(this).attr('data-no');
        var url =  '/a_giftbag/gift/pop-search/'+ no;        
        $.ajax({
            url:url,
            dataType:'json',
            success:function(json){
                var html = '';
                html = json.html;
                $.dialog({id:'pop-data-list',title:'提示',padding:2,content:html,width:600});
            }
        });        
    }); 
    //初始化礼包
    if($('#selected_giftbag_aid').val()>0){
        $.ajax({
            url:'/a_giftbag/gift/pop-info/'+$('#selected_giftbag_aid').val(),
            dataType:'json',
            success:function(json){
                $('#selected_giftbag_title').html(json.giftbag.title);
            },
            error:function(err){alert(err);}
        });
    } 
});
</script>
<!--{%endblock%}-->