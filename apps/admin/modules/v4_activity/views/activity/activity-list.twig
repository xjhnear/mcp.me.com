<!--{%extends "../sub-layout-giftbag.twig"%}-->
<!--{%block main_content%}-->
<div class="row-fluid">
	<div class="span12">
		<div class="box box-color box-bordered">
			<div class="box-title">
				<h3>
					<i class="icon-table"></i>
					活动管理
				</h3>
				<div class="actions">
					<form action="<!--{{url('v4activity/activity/list')}}-->">
						<table class="table-filter">
							<tr>
								<td colspan=2></td>
								<td>开始时间
									<div class="input-append date " >
										<input name="activityStartTime" onclick="laydate({istime: true, format: 'YYYY-MM-DD hh:mm:ss'})" type="text" class="input-medium datetimepicker" id="date_timepicker_start" value="<!--{{activityStartTime}}-->" readonly>
										<span class="add-on"><i class="icon-calendar"></i></span>
									</div>
								</td>
								<td>结束时间
									<div class="input-append date "  data-date="">
										<input name="activityEndTime" onclick="laydate({istime: true, format: 'YYYY-MM-DD hh:mm:ss'})" type="text" class="input-medium datetimepicker"  value="<!--{{activityEndTime}}-->" id="date_timepicker_end" readonly>
										<span class="add-on"><i class="icon-calendar"></i></span>
									</div>
								</td>
							</tr>
							<tr>
                                <td>
                                    <!--{{form_select('appName',platforms,appName,{'style':'width:100px'})}}-->
                                </td>
								<td>
									<input name="name"  placeholder="活动标题" style="width:177px;" type="text" class="input-small" value="<!--{{name}}-->" >
								</td>
								<td>
									<input id="gameselect" name="gid" data-rule-required="true" data-from="ios" data-msg-required="请填写游戏"  type="hidden" value="<!--{{gid}}-->" class="bigdrop select2-offscreen" style="width:200px;" tabindex="-1">
								</td>
								<td>
									<!--{{form_radio('selType',0,selType==0)}}-->全部活动
									<!--{{form_radio('selType',1,selType==1)}}-->进行中	
									<!--{{form_radio('selType',2,selType==2)}}-->已结束
								</td>
								<td colspan=1>
									<button class="btn btn-teal search_btn"><i class="icon-search"></i>搜索</button> <a href="<!--{{url('v4activity/activity/activity-info')}}-->" class="btn btn-teal">添加活动</a>
								</td>
							</tr>
						</table>
					</form>
				</div>
			</div>
			<div class="box-content nopadding">
				<table class="table table-hover table-nomargin">
					<thead>
					<tr>
						<th>活动图片</th>
						<th>活动标题/ID</th>
                        <th>平台</th>
						<th>关联游戏</th>
						<th>排序</th>
						<th>是否推送</th>
						<th>开始时间/结束时间</th>
						<th>活动类型</th>
						<th>状态</th>
						<th>操作</th>
					</tr>
					</thead>
					<tbody>
						<!--{% for key,item in datalist%}-->
							<tr id="tr_<!--{{item.id}}-->">
								<td class="user-avatar"><img src='<!--{{item.pic}}-->'/></td>
								<td><!--{{item.name}}--><br/><!--{{item.id}}--></td>
                                <td><!--{{platforms[item.appName]}}--></td>
								<td><!--{{item.gname ? item.gname : '没有关联游戏'}}--></td>
								<td><!--{{item.top}}--></td>
								<td><!--{{ item.pushStatus=='2' ? '是' : '否' }}--></td>
								<td><!--{{item.activityStartTime}}--></br><!--{{item.activityEndTime}}--></td>
								<td>
									<!--{% if item.activityType == 2 %}-->
									普通活动
									<!--{% elseif item.activityType == 3  %}-->
									自分享活动
									<!--{% else %}-->
									任务活动
									<!--{% endif %}-->
								</td>
                            <td>
                                <!--{%if item.isOnOff %}-->
                                    	上架
                                <!--{%else%}-->
                                    	下架
                                <!--{%endif%}-->

                            </td>
								<td>
									<a href="<!--{{url('v4activity/activity/activity-info',{id:item.id,'gId':item.gid,'gname':item.gname,'other_id':item.other_id})}}-->" class="btn btn-primary">编辑</a>
									<div class="btn-group">
										<a data-toggle="dropdown" href="#" class="btn btn-primary dropdown-toggle">操作<span class="caret"></span></a>
										<ul class="dropdown-menu dropdown-primary">	
										  <li>
												<a class="ajax-on" ifon="<!--{{ item.isOnOff }}-->" data="<!--{{ item.id }}-->" href="javascript:void(0);">
													<!--{{ item.isOnOff ? '下架' : '上架'  }}-->
												</a>
										  </li>
										  <li>
										  		<a href="<!--{{url('v4activity/activity/top',{id:item.id,val:item.isTop?0:1})}}-->">置顶<!--{%if item.isTop %}--><i class="icon-ok"></i><!--{%endif%}--></a>
										  </li>
										  <!--{% if item.isActive == 1 %}-->
											  <li>
											  		<a href='<!--{{url('v4activity/activity/close',{id:item.id,other_id:item.other_id})}}-->'  >关闭</a>
											  </li>
										  <!--{% else %}-->
											  <li>
											  		<a href='<!--{{url('v4activity/activity/enable',{id:item.id})}}-->'  >启用</a>
											  </li>
										  <!--{% endif %}-->
										</ul>
									</div>
								</td>
								
							</tr>
						<!--{%endfor%}-->
					</tbody>
				</table>
				<div class="pagelink">
					<!--{{pagelinks}}-->
				</div>
			</div>
		</div>
	</div>
</div>

<!-- 模态框（Modal） -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close"
				        data-dismiss="modal" aria-hidden="true">
					&times;
				</button>
				<h4 class="modal-title" id="myModalLabel">
					导出
				</h4>
			</div>
			<div class="modal-body">
				<div class="box-content">
					<div class="control-group">
						<label class="control-label">导出状态</label>
						<div class="controls">
							<select id="my_status" name="status">
								<option value="0">未使用(库存中) </option>
								<option value="1">已使用(平台已发放）</option>
							</select>
						</div>

					</div>
					<div class="control-group">
						<label class="control-label">导出卡密数量</label>
						<div class="controls">
							<input type="text" name="cardNumber" id="cardNumber" >
						</div>

					</div>
				</div>
			</div>
			<div id="modal-footer" class="modal-footer">
				<button type="button" class="btn btn-default"
				        data-dismiss="modal">关闭
				</button>
				<a href="javascript:;" id="go_" class="btn btn-primary"> 确定</a>
			</div>
		</div><!-- /.modal-content -->
	</div><!-- /.modal -->
</div>
<!--{%endblock%}-->
<!--{%block footer_js%}-->
<script src="/static/js/laydate/laydate.js"></script>
<script>
	$(function(){
        /*
		  $('#date_timepicker_start').datetimepicker({
  				format:'Y/m/d H:i:s',
  				onShow:function( ct ){
	   				this.setOptions({
	    			maxDate:jQuery('#date_timepicker_end').val()?jQuery('#date_timepicker_end').val():false
	   				})
  				},
  				timepicker:false,
  				onSelectDate:function(current_time,$input){
  					$('#date_timepicker_end').datetimepicker({
  						format:'Y/m/d H:i:s',
  						onShow:function( ct ){
					    	this.setOptions({
					    			minDate:$input.val()?$input.val():false
					    	})
  						},
  						timepicker:false
 					});
  				}
  		});
*/
 			
		gameselect('#gameselect');
		$('a.ajax-del').bind('click',function(){
        	if(!confirm('确定要删除数据吗？')){
            return false;
        	}
    	});
		$('input').iCheck({
			checkboxClass: 'icheckbox_square-orange',
			radioClass: 'iradio_square-orange',
			increaseArea: '20%' // optional
		});
        $(".search_btn").click(function(){

            var startTime=$("#date_timepicker_start").val();
            var endTime=$("#date_timepicker_end").val();
            
            if(startTime&&endTime){
                startTime = startTime.replace(/-/g,"/");
                var startTime1 = new Date(Date.parse(startTime));
                endTime = endTime.replace(/-/g,"/");
                var endTime1 = new Date(Date.parse(endTime));
                if(startTime1>endTime1){
                    alert("结束时间不能早于开始时间！");
                    return false;
                }
            }
        })
		$('.ajax-on').bind('click',function(){
			var p_code = $(this).attr('data');
			var ifon = $(this).attr('ifon')=='1' ? 0 : 1;
			var valid_str = ifon ? '上架' : '下架';
			alertify.confirm('是否更改为' + valid_str + '？',function(e){
				if(e){
					$.get('/v4activity/activity/ajax-shelf',{'p_code':p_code,'state':ifon},function(resp){
						if(resp.state){
							alertify.success(resp.msg);
							setTimeout(function(){
								location.reload();
							},1000);
						}else{
							alertify.error(resp.msg);
						}
					},'json')
				}
			});
		});
	});
</script>
<!--{%endblock%}-->