<!--{%extends "../sub-layout-giftbag.twig"%}-->
<!--{%block main_content%}-->
<div class="row-fluid">
	<div class="span12">
		<div class="box">
			<div class="box-title">
				<h3><i class="icon-edit"></i>活动编辑</h3>
			</div>
			<div class="box-content">
				<form id="card_from" action="<!--{{url('v4activity/activity/add')}}-->" method="POST" class='form-horizontal form-validate' enctype="multipart/form-data">
					<input type="hidden" name="activityType" value="2">
					<div class="control-group">
						<label class="control-label">*活动名称</label>
						<div class="controls">
							<input type="text" name="name" id="name" data-rule-required="true" data-msg-required="请填写活动名称"
							       class="input-large" value="<!--{{ input_old('name') }}-->"/>
						</div>
					</div>
					<div class="control-group">
                        <label class="control-label">*活动图片</label>
                        <div class="controls">
                            <div class="fileupload fileupload-new" data-provides="fileupload">
                                <div class="fileupload-new thumbnail" style="max-width: 120px; max-height: 120px;"><img id="listpic_img" src="<!--{{asset('/static/img/nopic.gif')}}-->" /></div>
                                <div class="fileupload-preview fileupload-exists thumbnail img1" style="max-width: 120px; max-height: 120px; line-height: 20px;"></div>
                                <div>
                                    <span class="btn btn-file"><i class="icon-picture"></i><span class="fileupload-new">选择图片</span><span class="fileupload-exists">重新选择</span><input id="pic" type="file" name='pic' /></span>
                                    <span style="color: #B94A48; display: none" id="note_sp1">图片不能为空且限于png,gif,jpeg,jpg格式</span>
                                </div>
                            </div>
                            <span class="help-inline">图片最佳尺寸:550*277</span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label">*置顶活动图片</label>
                        <div class="controls">
                            <div class="fileupload fileupload-new" data-provides="fileupload">
                                <div class="fileupload-new thumbnail" style="max-width: 120px; max-height: 120px;"><img id="listpic_img" src="<!--{{asset('/static/img/nopic.gif')}}-->" /></div>
                                <div class="fileupload-preview fileupload-exists thumbnail img2" style="max-width: 120px; max-height: 120px; line-height: 20px;"></div>
                                <div>
                                    <span class="btn btn-file"><i class="icon-picture"></i><span class="fileupload-new">选择图片</span><span class="fileupload-exists">重新选择</span><input id="topPic" type="file" name='topPic' /></span>
                                    <span style="color: #B94A48; display: none" id="note_sp2">图片不能为空且限于png,gif,jpeg,jpg格式</span>
                                </div>
                            </div>
                            <span class="help-inline">图片最佳尺寸:1149*297</span>
                        </div>
                    </div>
					<div class="control-group">
						<label class="control-label">*关联游戏</label>
						<div class="controls">
							<div class="input-append">
								<input id="selected_game_id" name="game_id" type="hidden" value="<!--{{ input_old('game_id') }}-->"/>
								<input type="text" readonly id="selected_game_name" name="game_name" class="input-medium" data-rule-required="true" data-msg-required="请选择游戏" value="<!--{{ input_old('game_name') }}-->" />
								<span class="add-on select-pop-game">选择游戏</span>
							</div>
						</div>
					</div>
					<div class="control-group">
						<label class="control-label">是否置顶</label>
						<div class="controls">
							<input id="if-isTop" name="isTopIntMax" data-on-color="success" data-on-text="置顶"
							       data-off-color="danger" data-off-text="不置顶" class="switchbox" type="checkbox" <!--{{ input_old('top') ? 'checked' : '' }}-->/>
						</div>
					</div>
					<div class="control-group" id="top">
						<label class="control-label">排序</label>
						<div class="controls">
							<input type="text" name="top"   class="input-small" value="" />
						</div>
					</div>
					<div class="row-fluid">
						<div class="span4">
							<div class="control-group">
								<label class="control-label">*开始时间</label>
								<div class="controls">
									<div class="input-append date">
										<input name="activityStartTime" id="date_timepicker_start" onclick="laydate({istime: true, format: 'YYYY-MM-DD hh:mm:ss'})" type="text" class="input-medium " value="<!--{{ input_old('activityStartTime') }}-->" data-rule-required="true"  data-msg-required="请填写开始时间"  readonly>
										<span class="add-on"><i class="icon-calendar"></i></span>
									</div>
								</div> 
							</div>
						</div>
						<div class="span4">
							<div class="control-group">
								<label class="control-label">*结束时间</label>
								<div class="controls">
									<div class="input-append date">
										<input name="activityEndTime" id="date_timepicker_end" onclick="laydate({istime: true, format: 'YYYY-MM-DD hh:mm:ss'})" type="text" class="input-medium " value="<!--{{ input_old('activityEndTime') }}-->" data-rule-required="true"  data-msg-required="请填写结束时间" readonly>
										<span class="add-on"><i class="icon-calendar"></i></span>
									</div>
								</div>
							</div>
						</div>
					</div>


					<div class="row-fluid">
						<div class="span3">
							<div class="control-group">
								<label class="control-label">活动类型</label>
								<div class="controls">
									<!--{{form_radio('Type',2,input_old('Type')==0)}}-->普通活动
								</div>
							</div>
						</div>
						<div class="span3">
							<div class="control-group">
								<div class="controls">
									<!--{{form_radio('Type',3,input_old('Type')==3)}}-->自分享活动
								</div>
							</div>
						</div>
						<div class="span3">
							<div class="control-group">
								<div class="controls">
									<!--{{form_radio('Type',4,input_old('Type')==4)}}-->任务活动
								</div>
							</div>
						</div>
					</div>
					
					<div class="control-group" id="normal" >
					<div class="row-fluid">
						<div class="span3">
							<div class="control-group">
								<label class="control-label">活动展示类型</label>
								<div class="controls">
									<!--{{form_radio('linkType',0,input_old('linkType')==0,{'id':'virtual'})}}-->帖子
								</div>
							</div>
						</div>
						<div class="span3">
							<div class="control-group">
								<div class="controls">
									<!--{{form_radio('linkType',2,input_old('linkType')==2)}}-->内部html页面
								</div>
							</div>
						</div>
						<div class="span3">
							<div class="control-group">
								<div class="controls">
									<!--{{form_radio('linkType',1,input_old('linkType')==1,{'id':'p-taobao'})}}-->外部html页面
								</div>
							</div>
						</div>
						<div class="span3">
							<div class="control-group">
								<div class="controls">
									<!--{{form_radio('linkType',3,input_old('linkType')==3,{'id':'p-taobao'})}}-->文章详情(攻略用)
								</div>
							</div>
						</div>
					</div>
					<div class="control-group" id="isautologindiv" style="display: none;">
						<div class="row-fluid">
							<div class="span3">
								<div class="control-group">
									<label class="control-label">是否自动登录</label>
									<div class="controls">
										<!--{{form_radio('isAutoLogin',1,input_old('isAutoLogin')==1)}}-->是
									</div>
								</div>
							</div>
							<div class="span3">
								<div class="control-group">
									<div class="controls">
										<!--{{form_radio('isAutoLogin',0,input_old('isAutoLogin')==0)}}-->否
									</div>
								</div>
							</div>
						</div>
					</div>


					<div class="control-group" id="tiezi_id" >
						<label class="control-label">帖子ID</label>
						<div class="controls">
							<input type="text" name="linkValue" id="linkValue" data-rule-required="true" data-msg-required="帖子ID"
							       class="input-large linkValue" value="<!--{{ input_old('linkValue') }}-->"/>
						</div>
					</div>
					<div class="control-group" id="url_address" style="display:none" >
						<label class="control-label">url地址</label>
						<div class="controls">
							<input type="text" name="linkValue_" id="linkValue" data-rule-required="true" data-msg-required="请填写url地址"
							       class="input-large linkValue" value="<!--{{ input_old('linkValue_') }}-->"/>
						</div>
					</div>
					</div>
					<div class="control-group" id="share" style="display:none" >
						<div class="control-group">
							<label class="control-label">*自分享</label>
							<div class="controls">
								<div class="input-append">
									<input id="selected_share_id" name="linkValue_s" type="hidden" value="<!--{{ input_old('linkValue') }}-->"/>
									<input id="selected_share_startTime" name="selected_share_startTime" type="hidden" value="<!--{{ info.createTime }}-->"/>
									<input id="selected_share_endTime" name="selected_share_endTime" type="hidden" value="<!--{{ info.updateTime}}-->"/>
									<input type="text" readonly id="selected_share_name" name="share_name" class="input-medium" data-rule-required="true" data-msg-required="请选择分享" value="<!--{{ input_old('v4share_name') }}-->" />
									<span class="add-on select-pop-share">选择分享</span>
								</div>
							</div>
						</div>
						<div class="control-group">
							<label for="textfield" class="control-label">自分享内容</label>
							<div class="controls">
								<script id="intro" name="descHtml" type="text/plain"><!--{{ input_old('descHtml') }}--></script>
							</div>
						</div>
					</div>

                    <input type="hidden" class="app_inp" value="" name="appName" id="appName" />

                    <div class="control-group app_sel">
                        <label class="control-label">*平台</label>
                        <div class="controls">
                            <!--{{form_select('appName',platforms,info.appname,{'class':'app_sel'})}}-->
                        </div>
                    </div>

					<div class="control-group" id="task" style="display:none" >
						<div class="control-group">
							<label class="control-label">*任务</label>
							<div class="controls">
								<div class="input-append">
									<input id="selected_task_id" name="linkValue_t" type="hidden" value="<!--{{ input_old('linkValue') }}-->"/>
									<input type="text" readonly id="selected_task_name" name="task_name" class="input-medium" data-rule-required="true" data-msg-required="请选择任务" value="<!--{{ input_old('task_name') }}-->" />
									<span class="add-on select-pop-task">选择任务</span>
								</div>
							</div>
						</div>
						<div class="control-group">
							<label for="textfield" class="control-label">任务活动页面显示内容</label>
							<div class="controls">
								<script id="intro_t" name="descHtml_t" type="text/plain"><!--{{ input_old('descHtml') }}--></script>
							</div>
						</div>
					</div>

                    <div class="control-group append">
                        <label class="control-label">是否推送</label>
                        <div class="controls">
                            <input id="isPush" name="isPush" data-on-color="success" data-on-text="是"
                            data-off-color="danger" data-off-text="否" class="switchbox" type="checkbox"/>
                        </div>
                    </div>
                    
					<div class="row-fluid">
						<div class="span3">
							<div class="control-group">
								<label class="control-label">上架设定</label>
								<div class="controls">
									<input name="shelf_set" type="radio" value="1"
											<!--{{ input_old('shelf_set') == 1 ? 'checked' : 'checked' }}-->/>上架
								</div>
							</div>
						</div>
						<div class="span3">
							<div class="controls">
								<input name="shelf_set" type="radio" value="2"
										<!--{{ input_old('shelf_set') == 2 ? 'checked' : '' }}-->/>下架
							</div>
						</div>
						
					</div>
                    
					<div class="form-actions">
						<button type="submit" class="btn btn-primary sub"><i class="icon-ok"></i>发布活动</button>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>
<!--{%endblock%}-->

<!--{%block footer_js%}-->
<script src="/static/js/jquery.uniform.min.js"></script>
<script src="/static/js/ajaxfileupload.js"></script>
<script src="<!--{{asset('/static/js/ueditor/ueditor.config.js')}}-->"></script>
<script src="<!--{{asset('/static/js/ueditor/ueditor.all.js')}}-->"></script>
<script src="<!--{{asset('/static/js/ueditor/lang/zh-cn/zh-cn.js')}}-->"></script>
<script src="/static/js/jquery.validationEngine.js"></script>
<script src="/static/js/jquery.validationEngine-en.js"></script>
<script src="/static/js/laydate/laydate.js"></script>
<script>
	$(function(){
		var linktype_val = $("input[name='linkType']:checked").val();
		if(linktype_val == 0){
			$('#isautologindiv').fadeOut();
		}else{
			$('#isautologindiv').fadeIn();
		}
		UE.getEditor('intro',{initialFrameHeight:100});
		UE.getEditor('intro_t',{initialFrameHeight:100});
		
		$('input:radio').iCheck({
			checkboxClass: 'icheckbox_square-orange',
			radioClass: 'iradio_square-orange',
			increaseArea: '20%'
		});
		$('.switchbox').bootstrapSwitch();
		var d=new Date(),str=''; 
			str +=d.getFullYear()+'-'; //获取当前年份 
			str +=d.getMonth()+1+'-'; //获取当前月份（0——11） 
			str +=d.getDate();
        /*
		jQuery('#date_timepicker_start').datetimepicker({
  				format:'Y/m/d',
  				minDate:str,
  				onShow:function( ct ){
	   				this.setOptions({
	    			maxDate:jQuery('#date_timepicker_end').val()?jQuery('#date_timepicker_end').val():false
	   				})
  				},
  				timepicker:false,
  				onSelectDate:function(current_time,$input){ 
  					jQuery('#date_timepicker_end').datetimepicker({
  						format:'Y/m/d',
  						onShow:function( ct ){
					    	this.setOptions({
					    			minDate:$input.val()?$input.val():false
					    	})
  						},
  						timepicker:false
 					});
  				}
 		});

 		//置顶
		$('#if-isTop').on('switchChange.bootstrapSwitch', function (e, data) {
			e.preventDefault();
			if(data){
				$("#top").fadeOut();
			}else{
				$("#top").fadeIn();
			}
		});
         */
		$("input[name='linkType']").on('ifChecked',function(e){
			var check_val = e.currentTarget.value;
			linktype_fade(check_val);
		});
		$("input[name='Type']").on('ifChecked',function(e){
			var check_val = e.currentTarget.value;
			type_fade(check_val);
		});
		$('.select-pop-game').bind('click',function(){
			$.ajax({
				url:'/game/api/game-search',
				dataType:'json',
				success:function(json){
					var html = json.html;
					$.dialog({id:'pop-game-list',title:'提示',padding:2,content:html,width:600,height:580});
				}
			});
		});
		
		$('.select-pop-task').bind('click',function(){
			$.ajax({
				url:'/IOS_activity/task/task-pop-list',
				dataType:'json',
				success:function(json){
					var html = json.html;
					$.dialog({id:'pop-task-list',title:'提示',padding:2,content:html,width:600,height:580});
				}
			});
		});
		
		$('.select-pop-share').bind('click',function(){
			$.ajax({
				url:'/v4_share/home/v4share-search',
				dataType:'json',
				success:function(json){
					var html = json.html;
					$.dialog({id:'pop-v4share-list',title:'提示',padding:2,content:html,width:600,height:580});
				}
			});
		});
        //图片不能为空
        $(".sub").live('click',function(){
            var pic1 = $(".img1").children("img").attr("src");
            var pic2 = $(".img2").children("img").attr("src");
            var a = 0;
            if(pic1){
                $("#note_sp1").hide();
            }else{
                $("#note_sp1").show();
                var a = 1;
            }
            if(pic2){
                $("#note_sp2").hide();
            }else{
                $("#note_sp2").show();
                var a = 1;
            }
            if(a == 1){
                return false;
            }

            var startTime=$("#date_timepicker_start").val();
            var endTime=$("#date_timepicker_end").val();
            if(startTime&&endTime){
                startTime = startTime.replace(/-/g,"/");
                var startTime1 = new Date(Date.parse(startTime));
                endTime = endTime.replace(/-/g,"/");
                var endTime1 = new Date(Date.parse(endTime));
                if(startTime1>endTime1){
                    alert("结束时间不能早于开始时间！");
                    return false;
                }
            }
             var id=$('#selected_task_id').val(); 
            startTime = startTime.replace(/-/g,"/");
            endTime = endTime.replace(/-/g,"/");
             var startTime1 = new Date(Date.parse(startTime));
             var endTime1 = new Date(Date.parse(endTime));
            
           var createTime=$('#selected_share_startTime').val();
		   var updateTime=$('#selected_share_endTime').val();  
		    createTime = createTime.replace(/-/g,"/");
            updateTime= updateTime.replace(/-/g,"/"); 
             var createTime1 = new Date(Date.parse(createTime));
             var updateTime1 = new Date(Date.parse(updateTime));
             if(startTime&&endTime){
             if(startTime1>createTime1){
                  alert("活动的开始时间需早于自分享的开始时间！");
                  return false;
             }
             if(endTime1<updateTime1){
                  alert("活动的结束时间需晚于自分享的结束时间！");
                  return false;
             }
             }
        })
      	
});
	 
	var set_selected_game=function(game_id,game_name,icon){
		$('#selected_game_id').val(game_id);
		$('#selected_game_name').val(game_name);
	};
	var set_selected_task=function(task_id,task_name,task_icon,task_endTime,task_isLine,mutextask_id){
		$('#selected_task_id').val(task_id);
		$('#selected_task_name').val(task_name);
	};
	var set_selected_v4share=function(share_id,share_name,share_icon,share_des,share_url,rewards,startTime,endTime,platform){
		$('#selected_share_id').val(share_id);
		$('#selected_share_name').val(share_name);
		$('#selected_share_startTime').val(startTime);
		$('#selected_share_endTime').val(endTime);
        if(platform=="gl"){
            $('#appName').val("glwzry");
        }else{
            $('#appName').val("yxdjqb");
        }
	};
	function linktype_fade(check_val){
		switch(check_val){
			case '0' :
				$('#url_address').fadeOut();
				$('#tiezi_id').fadeIn();
				$('#isautologindiv').fadeOut();
				break;
			case '3' :
				$('#url_address').fadeOut();
				$('#tiezi_id').fadeIn();
				$('#isautologindiv').fadeOut();
				break;
			default:
				$('#tiezi_id').fadeOut();
				$('#url_address').fadeIn();
				$('#isautologindiv').fadeIn();
		}
	}
	function type_fade(check_val){
		switch(check_val){
			case '4' :
				$('#normal').fadeOut();
				$('#share').fadeOut();
				$('#task').fadeIn();
                $(".app_sel").show().removeAttr("disabled");
                $(".app_inp").attr("disabled","disabled");
				break;
			case '3' :
				$('#normal').fadeOut();
				$('#task').fadeOut();
				$('#share').fadeIn();
                $(".app_sel").hide().attr("disabled","disabled");
                $(".app_inp").removeAttr("disabled");
				break;
			default:
				$('#share').fadeOut();
				$('#task').fadeOut();
				$('#normal').fadeIn();
                $(".app_sel").show().removeAttr("disabled");
                $(".app_inp").attr("disabled","disabled");
		}
	}
    $(function(){
        $("input[name='displayOrder']").on('ifChecked',function(e){
            var check_val = $(this).val();
        });
    })
</script>
<!--{%endblock%}-->
