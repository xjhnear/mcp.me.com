<!--{%extends "base-layout.twig"%}-->
<!--{%block main_content%}-->
<link href="/static/css/app.css" rel="stylesheet" type="text/css"/>
<div class="row-fluid">
    <div class="box">
        <div class="box-title">
            <h3>添加任务线1.4</h3>
        </div>
        <div class="box-content">
            <form id="activity-task" action="<!--{{url('v4_task/task/add-task-line')}}-->" method="POST" class='form-horizontal form-validate' enctype="multipart/form-data">
                <div class="control-group">
                    <label class="control-label">平台类型</label>
                    <div class="controls appType">
                        <!--{{form_radio('platformType','I',atask.platformType=='I')}}-->IOS
                        <!--{{form_radio('platformType','A',atask.platformType=='A')}}-->Android
                    </div>
                </div>

                <div class="control-group">
                    <label class="control-label">任务版本</label>
                    <div class="controls">
                        <input type="text" name="version" class="input-small" value="<!--{{atask.version}}-->" data-rule-required="true" data-msg-required="版本不能为空"  />
                    </div>
                </div>

                <div class="control-group">
                    <label class="control-label">任务标题</label>
                    <div class="controls">
                        <input type="text" name="taskName" class="input-xxlarge" value="<!--{{atask.taskName}}-->" data-rule-required="true" data-msg-required="标题不能为空"  />
                    </div>
                </div>

                <div class="control-group">
                    <label class="control-label">任务描述</label>
                    <div class="controls">
                        <textarea rows="4" name="taskDesc"><!--{{ atask.taskDesc }}--></textarea>
                    </div>
                </div>

                <div class="control-group">
                    <label class="control-label">*关联游戏</label>
                    <div class="controls">
                        <div class="input-append">
                            <input id="selected_game_id" name="game_id" type="hidden" value="<!--{{atask.gid}}-->"/>
                            <input type="text" readonly id="selected_game_name" name="gname" class="input-medium" data-rule-required="true" data-msg-required="请选择游戏" value="<!--{{ atask.gname }}-->" />
                            <span class="add-on select-pop-game">选择游戏</span>
                        </div>
                    </div>
                </div>

                <div class="control-group">
                    <label class="control-label">图片</label>
                    <div class="controls">
                        <div data-provides="fileupload" class="fileupload fileupload-new">
                            <div style="max-width: 60px; max-height: 60px;" class="fileupload-new thumbnail">
                                <img id="selected_game_icon" src="<!--{{atask.taskIcon|default('/static/img/wu_ss.gif')}}-->">
                            </div>
                            <div style="max-width: 60px; max-height: 60px; line-height: 20px;" class="fileupload-preview fileupload-exists thumbnail"></div>
                            <span class="btn btn-file"><i class="icon-picture"></i>
                            <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span>
                            <input id="task_img" name="task_img" type="hidden" value="<!--{{atask.taskIcon}}-->"/>
                            <input type="file"  name="task_icon" class="taskIcon" >
                        </span>
                            <a data-dismiss="fileupload" class="btn fileupload-exists" href="#">Remove</a>
                            <span style="color: rgb(185, 74, 72);" class="img_note" hidden="hidden">图片不能为空且限于png,gif,jpeg,jpg格式</span>
                        </div>
                    </div>
                </div>

                <div class="control-group sort">
                    <label class="control-label">排序值</label>
                    <div class="controls">
                        <input type="text" name="sortValue" class="input-small" value="<!--{{atask.sortValue|default('50')}}-->" />
                    </div>
                </div>

                <div class="control-group">
                    <label class="control-label">管理员模式</label>
                    <div class="controls">
                        <div class="span2">
                            <!--{{form_radio('taskShowSwitch',0,downloadInfo.taskShowSwitch==0)}}-->否
                            <!--{{form_radio('taskShowSwitch',1,downloadInfo.taskShowSwitch==1)}}-->是
                        </div>
                    </div>
                </div>

                <div class="control-group">
                    <label class="control-label">展示模板</label>
                    <div class="controls">
                        <div class="input-append">
                            <div>
                                <img src="<!--{{asset('/static/images/task1.png')}}-->" style="width: 250px">
                            </div>
                            <div>
                                <!--{{form_radio('templateName','bigPic',showTemplate.templateName=='bigPic',{'class':'templateName'})}}-->模板1
                            </div>
                        </div>
                        <div class="input-append">
                            <div>
                                <img src="<!--{{asset('/static/images/task2.png')}}-->" style="width: 250px">
                            </div>
                            <div>
                                <!--{{form_radio('templateName','bottomPic',showTemplate.templateName=='bottomPic',{'class':'templateName'})}}-->模板2
                            </div>
                        </div>
                        <div class="input-append">
                            <div>
                                <img src="<!--{{asset('/static/images/task3.png')}}-->" style="width: 250px">
                            </div>
                            <div>
                                <!--{{form_radio('templateName','leftPic',showTemplate.templateName=='leftPic',{'class':'templateName'})}}-->模板3
                            </div>
                        </div>
                        <div class="input-append">
                            <div>
                                <img src="<!--{{asset('/static/images/task4.png')}}-->" style="width: 250px">
                            </div>
                            <div>
                                <!--{{form_radio('templateName','nothing',showTemplate.templateName=='nothing',{'class':'templateName'})}}-->模板4
                            </div>
                        </div>
                    </div>
                </div>

                <div class="control-group">
                    <label class="control-label">模板图片</label>
                    <div class="controls">
                        <input type="button" class="input-small add_pic" value="新建" />
                    </div>
                    <!--{% for picUrl in showTemplate.picUrls %}-->
                    <div class="controls" style="margin-top: 20px">
                        <div data-provides="fileupload" class="fileupload fileupload-new input-append">
                            <div style="max-width: 60px; max-height: 60px;" class="fileupload-new thumbnail">
                                <img id="selected_game_icon" src="<!--{{img_url}}--><!--{{picUrl|default('/static/img/wu_ss.gif')}}-->">
                            </div>
                            <div style="max-width: 60px; max-height: 60px; line-height: 20px;" class="fileupload-preview fileupload-exists thumbnail"></div>
                            <span class="btn btn-file"><i class="icon-picture"></i>
                            <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span>
                            <input name="picUrlsOld[]" class="picUrlsOld" type="hidden" value="<!--{{picUrl}}-->"/>
                            <input type="file"  name="picUrls[]" class="picUrls">
                        </span>
                            <a data-dismiss="fileupload" class="btn fileupload-exists" href="#">Remove</a>
                            <span style="color: rgb(185, 74, 72);" class="img_note" hidden="hidden">图片不能为空且限于png,gif,jpeg,jpg格式</span>
                        </div>
                        <div class="input-append">
                            <input type="button" class="input-small del_pic" value="删除" />
                        </div>
                    </div>
                    <!--{% endfor %}-->
                </div>


                <div class="row-fluid time">
                    <div class="span4">
                        <div class="control-group">
                            <label class="control-label">开始时间</label>
                            <div class="controls">
                                <div class="input-append date">
                                    <input name="startTime" onclick="laydate({istime: true, format: 'YYYY-MM-DD hh:mm:ss'})" type="text" class="input-medium datetimepicker" id="date_timepicker_start" value="<!--{{atask.startTime}}-->" readonly>
                                    <span class="add-on"><i class="icon-calendar"></i></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="span4">
                        <div class="control-group">
                            <label class="control-label">结束时间</label>
                            <div class="controls">
                                <div class="input-append date">
                                    <input name="endTime" onclick="laydate({istime: true, format: 'YYYY-MM-DD hh:mm:ss'})" type="text" class="input-medium datetimepicker" id="date_timepicker_start" value="<!--{{atask.endTime}}-->" readonly>
                                    <span class="add-on"><i class="icon-calendar"></i></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="control-group step_div">
                    <label class="control-label">任务详情</label>
                    <div class="controls">
                        <input type="button"  class="input-small add_down_b" value="新建" step_type_b="step_b_1" />
                    </div>
                </div>
                <div style="margin-left: 100px; margin-bottom: 10px; " class="step_content_b">

                </div>

                <div class="control-group">
                    <label class="control-label">父项任务ID</label>
                    <div class="controls">
                        <input type="text" name="preTaskId" class="input-xxlarge" value="<!--{{atask.preTaskId}}-->" />
                    </div>
                </div>

                <div class="control-group">
                    <label class="control-label">下载按钮图片</label>
                    <div class="controls">
                        <div data-provides="fileupload" class="fileupload fileupload-new">
                            <div style="max-width: 60px; max-height: 60px;" class="fileupload-new thumbnail">
                                <img id="backgroundPic" src="<!--{{img_url}}--><!--{{downloadInfo.backgroundPic|default('/static/img/wu_ss.gif')}}-->">
                            </div>
                            <div style="max-width: 60px; max-height: 60px; line-height: 20px;" class="fileupload-preview fileupload-exists thumbnail"></div>
                            <span class="btn btn-file"><i class="icon-picture"></i>
                            <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span>
                            <input id="prize_img_img" name="backgroundPic_img" type="hidden" value="<!--{{downloadInfo.backgroundPic}}-->"/>
                            <input type="file"  name="backgroundPic" >
                        </span>
                            <a data-dismiss="fileupload" class="btn fileupload-exists" href="#">Remove</a>
                            <span style="color: rgb(185, 74, 72);" class="img_note" hidden="hidden">图片不能为空且限于png,gif,jpeg,jpg格式</span>
                        </div>
                    </div>
                </div>

                <div class="control-group" style="border-top: 1px dashed #999;border-bottom: 1px dashed #999;padding-top: 10px;padding-bottom: 10px;">

                    <div class="control-group">
                        <label class="control-label">厂商回调advid</label>
                        <div class="controls">
                            <input name="advid" type="text" class="input-xxlarge" value="<!--{{downloadInfo.advid}}-->" />
                        </div>
                    </div>
                    <div class="control-group">
                        <label for="textfield" class="control-label">跳转地址</label>
                        <div class="controls">
                            <input name="owmUrl" type="text" class="input-xxlarge" value="<!--{{downloadInfo.linkInfo.linkValue}}-->" />
                        </div>
                    </div>
                    <div class="control-group">
                        <label for="textfield" class="control-label">安卓包名</label>
                        <div class="controls">
                            <input name="game_package_name" type="text" class="input-xxlarge" value="<!--{{atask.typeCondition['gamePackageName']}}-->" />
                        </div>
                    </div>
                    <div class="control-group">
                        <label for="textfield" class="control-label">浏览器类型</label>
                        <div class="controls">
                            <label class="radio inline">
                                <!--{{form_radio('linkType',2,downloadInfo.linkInfo.linkType==2)}}-->内置浏览器
                            </label>
                            <label class="radio inline">
                                <!--{{form_radio('linkType',1,downloadInfo.linkInfo.linkType==1)}}-->Safari浏览器
                            </label>
                        </div>
                    </div>
                </div>

                <div id="third" class="third">
                    <input id="third-count" name="third-count" type="hidden" value="<!--{{downloadInfo.thirdCount}}-->" />
                    <input id="third-delids" name="third-delids" type="hidden" value="" />
                    <!--{% for third in downloadInfo.thirdVendorsList %}-->
                    <!--{% set i = 1 %}-->
                    <div id="third-sub-<!--{{i}}-->" >
                        <button type="button" class="btn btn-danger third-del control-group">X</button>
                        <input name="thirdid[]" type="hidden" class="input-xxlarge thirdid" value="<!--{{third.id}}-->" />
                        <input name="gameDownloadId[]" type="hidden" class="input-xxlarge" value="<!--{{third.gameDownloadId}}-->" />
                        <div class="control-group">
                            <label for="textfield" class="control-label">第三方地址</label>
                            <div class="controls">
                                <input name="thirdUrl[]" type="text" class="input-xxlarge" value="<!--{{third.thirdUrl}}-->" />
                            </div>
                        </div>
                        <div class="control-group">
                            <label for="textfield" class="control-label">mac</label>
                            <div class="controls">
                                <input name="mac[]" type="text" class="input-xxlarge" value="<!--{{third.mac}}-->" />
                            </div>
                        </div>
                        <div class="control-group">
                            <label for="textfield" class="control-label">idfa</label>
                            <div class="controls">
                                <input name="idfa[]" type="text" class="input-xxlarge" value="<!--{{third.idfa}}-->" />
                            </div>
                        </div>
                        <div class="control-group">
                            <label for="textfield" class="control-label">openudid</label>
                            <div class="controls">
                                <input name="openudid[]" type="text" class="input-xxlarge" value="<!--{{third.openudid}}-->" />
                            </div>
                        </div>
                        <div class="control-group">
                            <label for="textfield" class="control-label">os</label>
                            <div class="controls">
                                <input name="os[]" type="text" class="input-xxlarge" value="<!--{{third.os}}-->" />
                            </div>
                        </div>
                        <div class="control-group">
                            <label for="textfield" class="control-label">plat</label>
                            <div class="controls">
                                <input name="plat[]" type="text" class="input-xxlarge" value="<!--{{third.plat}}-->" />
                            </div>
                        </div>
                        <div class="control-group">
                            <label for="textfield" class="control-label">callback</label>
                            <div class="controls">
                                <input name="callback[]" type="text" class="input-xxlarge" value="<!--{{third.callback}}-->" />
                            </div>
                        </div>
                        <div class="control-group">
                            <label for="textfield" class="control-label">首充</label>
                            <div class="controls">
                                <input name="firstRecharge[]" type="text" class="input-xxlarge" value="<!--{{third.firstRecharge}}-->" />
                            </div>
                        </div>
                        <div class="control-group">
                            <label for="textfield" class="control-label">首创</label>
                            <div class="controls">
                                <input name="firstCreateRole[]" type="text" class="input-xxlarge" value="<!--{{third.firstCreateRole}}-->" />
                            </div>
                        </div>
                    </div>
                    <!--{% set i = i + 1 %}-->
                    <!--{% endfor %}-->
                </div>

                <div>
                    <button type="button" class="btn btn-primary third-add">新增第三方链接</button>
                </div>


                <div class="form-actions">
                    <a type="submit" class="btn btn-primary sub"><i class="icon-ok"></i>保存</a>
                    <input type="hidden" name="stepListStr_b" value="<!--{{templateListJson}}-->"/>
                    <input type="hidden" name="taskId"  value="<!--{{atask.taskId}}-->"/>
                </div>

            </form>
        </div>

    </div>
</div>

<div id="third-module" style="display:none">
    <button type="button" class="btn btn-danger third-del control-group">X</button>
    <input name="thirdid[]" type="hidden" class="input-xxlarge thirdid" value="" />
    <input name="gameDownloadId[]" type="hidden" class="input-xxlarge" value="" />
    <div class="control-group">
        <label for="textfield" class="control-label">第三方地址</label>
        <div class="controls">
            <input name="thirdUrl[]" type="text" class="input-xxlarge" value="" />
        </div>
    </div>
    <div class="control-group">
        <label for="textfield" class="control-label">mac</label>
        <div class="controls">
            <input name="mac[]" type="text" class="input-xxlarge" value="" />
        </div>
    </div>
    <div class="control-group">
        <label for="textfield" class="control-label">idfa</label>
        <div class="controls">
            <input name="idfa[]" type="text" class="input-xxlarge" value="" />
        </div>
    </div>
    <div class="control-group">
        <label for="textfield" class="control-label">openudid</label>
        <div class="controls">
            <input name="openudid[]" type="text" class="input-xxlarge" value="" />
        </div>
    </div>
    <div class="control-group">
        <label for="textfield" class="control-label">os</label>
        <div class="controls">
            <input name="os[]" type="text" class="input-xxlarge" value="" />
        </div>
    </div>
    <div class="control-group">
        <label for="textfield" class="control-label">plat</label>
        <div class="controls">
            <input name="plat[]" type="text" class="input-xxlarge" value="" />
        </div>
    </div>
    <div class="control-group">
        <label for="textfield" class="control-label">callback</label>
        <div class="controls">
            <input name="callback[]" type="text" class="input-xxlarge" value="" />
        </div>
    </div>
    <div class="control-group">
        <label for="textfield" class="control-label">首充</label>
        <div class="controls">
            <input name="firstRecharge[]" type="text" class="input-xxlarge" value="" />
        </div>
    </div>
    <div class="control-group">
        <label for="textfield" class="control-label">首创</label>
        <div class="controls">
            <input name="firstCreateRole[]" type="text" class="input-xxlarge" value="" />
        </div>
    </div>
</div>

<!--{%endblock%}-->
<!--{%block footer_js%}-->
<script src="/static/js/ajaxfileupload.js"></script>
<script src="<!--{{asset('/static/js/xheditor/xheditor-1.1.14-zh-cn.min.js')}}-->"></script>
<script src="<!--{{asset('/static/js/ueditor/ueditor.config.js')}}-->"></script>
<script src="<!--{{asset('/static/js/ueditor/ueditor.all.js')}}-->"></script>
<script src="<!--{{asset('/static/js/ueditor/lang/zh-cn/zh-cn.js')}}-->"></script>
<script src="/static/js/jquery.validationEngine.js"></script>
<script src="/static/js/jquery.validationEngine-en.js"></script>
<script src="/static/js/laydate/laydate.js"></script>
<script src="/static/js/Sortable.js"></script>
<script src="/static/js/plugins/multiselect/bootstrap-multiselect.js"></script>
<script>
    //任务弹框对象
    var selectPopSubTask = {};
    $(function() {
//        $(".step_content_b").html("");
        <!--{%for template in atask.templateList%}-->

        $(".step_content_b").append('<fieldset style="width:1000px;padding:10px;border-left:groove" class="step_b_1" opearteMode="MODIFED" id="<!--{{ template.id }}-->" taskId="<!--{{ template.taskId }}-->" subTaskId="<!--{{ template.subTaskId }}-->"><legend class="step">按钮 <span>一</span><!--{{form_select('stepType_b[]',stepType_b,template.nativeTemplate.templateName,{'style':'width:160px;margin-left:240px;','class':'stepType_b'})}}--></legend><div style="float:left"><div class="control-group"><label class="control-label">背景图片:</label><div class="controls"><div data-provides="fileupload" class="fileupload fileupload-new"><div style="max-width:60px;max-height:60px" class="fileupload-new thumbnail"><img src="<!--{{img_url}}--><!--{{template.nativeTemplate.backgroundPic|default('/static/img/wu_ss.gif')}}-->"></div><div style="max-width:60px;max-height:60px;line-height:20px" class="fileupload-preview fileupload-exists thumbnail"></div><span class="btn btn-file"><i class="icon-picture"></i> <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span> <input name="prize_img[]" type="hidden" value="<!--{{template.nativeTemplate.backgroundPic}}-->" class="picValue_b"> <input type="file" name="prize_pic[]" class="img_validate myfile"></span> <a data-dismiss="fileupload" class="btn fileupload-exists fileupload-remove" href="#">Remove</a> <span style="color:#b94a48" class="img_note" hidden>图片不能为空且限于png,gif,jpeg,jpg格式</span></div></div></div><div class="control-group"><label class="control-label">图片大小</label><div class="controls"><input type="text" class="input-small" value="<!--{{template.nativeTemplate.size.0}}-->"> * <input type="text" class="input-small" value="<!--{{template.nativeTemplate.size.1}}-->"> <span style="color:red">必须为正整数</span></div></div></div><div style="float:left;margin-left:60px"><input value="插入结构" type="button" class="add_up_b"><br><br><input value="删除" type="button" class="btn_del"></div><div style="clear:both"></div></fieldset>');
        var obj = $(".step_content_b").children(".step_b_1:last");
        <!--{%if template.nativeTemplate.templateName=="bigButton"%}-->

        obj.children("div:first").append('<div class="control-group"><label class="control-label">按钮类型</label><div class="controls"><!--{{form_select('submitType[]',submitType,template.nativeTemplate.buttons.0.submitType,{'style':'width:160px;','class':'submitType'})}}--><span>大小</span> <input type="text" class="input-small" value="<!--{{template.nativeTemplate.buttons.0.size.0}}-->">*<input type="text" class="input-small" value="<!--{{template.nativeTemplate.buttons.0.size.1}}-->"></div></div><div class="buttonHtml"></div>');
            var bottonHtmlObj = obj.children("div").eq(-3).children("div").eq(-1);
            var tempHtml = '';
            <!--{% if template.nativeTemplate.buttons.0.submitType=="submit" or template.nativeTemplate.buttons.0.submitType=="screenshot" %}-->
                tempHtml += '<div class="control-group"><label class="control-label">按钮图片:</label><div class="controls"><div class="control-group"><label class="control-label">去完成</label><div data-provides="fileupload" class="fileupload fileupload-new"><div style="max-width:60px;max-height:60px" class="fileupload-new thumbnail"><img src="<!--{{img_url}}--><!--{{template.nativeTemplate.buttons.0.listButtonPic.0.backgroundPic|default('/static/img/wu_ss.gif')}}-->"></div><div style="max-width:60px;max-height:60px;line-height:20px" class="fileupload-preview fileupload-exists thumbnail"></div><span class="btn btn-file"><i class="icon-picture"></i> <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span> <input name="prize_img[]" type="hidden" value="<!--{{template.nativeTemplate.buttons.0.listButtonPic.0.backgroundPic}}-->" class="picValue_b"> <input type="file" name="prize_pic[]" class="img_validate myfile"></span> <a data-dismiss="fileupload" class="btn fileupload-exists fileupload-remove" href="#">Remove</a> <span style="color:#b94a48" class="img_note" hidden>图片不能为空且限于png,gif,jpeg,jpg格式</span></div></div><div class="control-group"><label class="control-label">审核中</label><div data-provides="fileupload" class="fileupload fileupload-new"><div style="max-width:60px;max-height:60px" class="fileupload-new thumbnail"><img src="<!--{{img_url}}--><!--{{template.nativeTemplate.buttons.0.listButtonPic.1.backgroundPic|default('/static/img/wu_ss.gif')}}-->"></div><div style="max-width:60px;max-height:60px;line-height:20px" class="fileupload-preview fileupload-exists thumbnail"></div><span class="btn btn-file"><i class="icon-picture"></i> <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span> <input name="prize_img[]" type="hidden" value="<!--{{template.nativeTemplate.buttons.0.listButtonPic.1.backgroundPic}}-->" class="picValue_b"> <input type="file" name="prize_pic[]" class="img_validate myfile"></span> <a data-dismiss="fileupload" class="btn fileupload-exists fileupload-remove" href="#">Remove</a> <span style="color:#b94a48" class="img_note" hidden>图片不能为空且限于png,gif,jpeg,jpg格式</span></div></div><div class="control-group"><label class="control-label">领取</label><div data-provides="fileupload" class="fileupload fileupload-new"><div style="max-width:60px;max-height:60px" class="fileupload-new thumbnail"><img src="<!--{{img_url}}--><!--{{template.nativeTemplate.buttons.0.listButtonPic.2.backgroundPic|default('/static/img/wu_ss.gif')}}-->"></div><div style="max-width:60px;max-height:60px;line-height:20px" class="fileupload-preview fileupload-exists thumbnail"></div><span class="btn btn-file"><i class="icon-picture"></i> <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span> <input name="prize_img[]" type="hidden" value="<!--{{template.nativeTemplate.buttons.0.listButtonPic.2.backgroundPic}}-->" class="picValue_b"> <input type="file" name="prize_pic[]" class="img_validate myfile"></span> <a data-dismiss="fileupload" class="btn fileupload-exists fileupload-remove" href="#">Remove</a> <span style="color:#b94a48" class="img_note" hidden>图片不能为空且限于png,gif,jpeg,jpg格式</span></div></div><div class="control-group"><label class="control-label">已完成</label><div data-provides="fileupload" class="fileupload fileupload-new"><div style="max-width:60px;max-height:60px" class="fileupload-new thumbnail"><img src="<!--{{img_url}}--><!--{{template.nativeTemplate.buttons.0.listButtonPic.3.backgroundPic|default('/static/img/wu_ss.gif')}}-->"></div><div style="max-width:60px;max-height:60px;line-height:20px" class="fileupload-preview fileupload-exists thumbnail"></div><span class="btn btn-file"><i class="icon-picture"></i> <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span> <input name="prize_img[]" type="hidden" value="<!--{{template.nativeTemplate.buttons.0.listButtonPic.3.backgroundPic}}-->" class="picValue_b"> <input type="file" name="prize_pic[]" class="img_validate myfile"></span> <a data-dismiss="fileupload" class="btn fileupload-exists fileupload-remove" href="#">Remove</a> <span style="color:#b94a48" class="img_note" hidden>图片不能为空且限于png,gif,jpeg,jpg格式</span></div></div></div></div>';
                var num = randomNum(99, 99999);
                tempHtml += '<div class="control-group"><label class="control-label">限额模式</label><div class="controls"><div class="control-group"><input type="radio" name="'+num+'" value="1" class="isLimit" checked >是<input type="radio" name="'+num+'" value="0" class="isLimit" <!--{{  template.nativeTemplate.buttons.0.limitMode.limit|default('checked') }}--> >否</div><div class="input-append"><label class="control-label">初始名额</label><input type="text" class="input-small limitNumbers" value="<!--{{ template.nativeTemplate.buttons.0.limitMode.limitNumbers }}-->" /></div><div class="input-append"><label class="control-label">限时时间（h）</label><input type="text" class="input-small limitHours" value="<!--{{ template.nativeTemplate.buttons.0.limitMode.limitHours }}-->" /></div></div></div>';

                //子任务
                tempHtml += '<div class="control-group"><label class="control-label">提交详情</label><div class="controls"><input type="button" class="input-small add_task" value="添加提交" /></div></div><div class="control-group">';

            <!--{% for taskSub in template.nativeTemplate.listTaskSub %}-->
                tempHtml += '<fieldset style="width:600px;padding:10px;border-left:groove" class="controls taskHtml" opearteMode="<!--{{taskSub.opearteMode}}-->" taskId="<!--{{taskSub.taskId}}-->"><legend class="step">任务 <span>一</span></legend><div class="input-append"><input class="selected_task_id" type="hidden" value="<!--{{taskSub.taskId}}-->"> <input type="text" readonly class="input-medium selected_task_name" data-rule-required="true" data-msg-required="请选择任务" value="<!--{{taskSub.taskName}}-->"> <span class="add-on select-pop-sub-task">选择任务</span> <input value="插入任务" type="button" class="add_task_up" style="margin-left:20px"> <input value="删除" type="button" class="btn_task" style="margin-left:20px"></div><div class="control-group" style="margin-top:20px"><div class="input-append"><label class="control-label">间隔时间（天）</label><input type="text" class="input-small intervalDays" value="<!--{{taskSub.intervalDays}}-->"></div><div class="input-append"><label class="control-label">后续百分比</label><input type="text" class="input-small attendRate" value="<!--{{taskSub.attendRate}}-->"></div></div></fieldset>';
                <!--{% endfor %}-->
                tempHtml += '</div>';

            <!--{% elseif template.nativeTemplate.buttons.0.submitType=="share" %}-->
                tempHtml += '<div class="control-group"><label class="control-label">按钮图片:</label><div data-provides="fileupload" class="fileupload fileupload-new"><div style="max-width:60px;max-height:60px" class="fileupload-new thumbnail"><img src="<!--{{img_url}}--><!--{{template.nativeTemplate.buttons.0.listButtonPic.0.backgroundPic|default('/static/img/wu_ss.gif')}}-->"></div><div style="max-width:60px;max-height:60px;line-height:20px" class="fileupload-preview fileupload-exists thumbnail"></div><span class="btn btn-file"><i class="icon-picture"></i> <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span> <input name="prize_img[]" type="hidden" value="<!--{{template.nativeTemplate.buttons.0.listButtonPic.0.backgroundPic}}-->" class="picValue_b"> <input type="file" name="prize_pic[]" class="img_validate myfile"></span> <a data-dismiss="fileupload" class="btn fileupload-exists fileupload-remove" href="#">Remove</a> <span style="color:#b94a48" class="img_note" hidden>图片不能为空且限于png,gif,jpeg,jpg格式</span></div></div><div class="control-group"><label class="control-label">分享标题</label><div class="controls"><input type="text" name="title" class="input-xxlarge title" value="<!--{{template.nativeTemplate.buttons.0.title}}-->" data-rule-required="true" data-msg-required="标题不能为空"></div></div><div class="control-group"><label class="control-label">分享描述</label><div class="controls"><input type="text" name="desc" class="input-xxlarge desc" value="<!--{{template.nativeTemplate.buttons.0.desc}}-->" data-rule-required="true" data-msg-required="分享描述不能为空"></div></div><div class="control-group"><label class="control-label">分享Icon:</label><div data-provides="fileupload" class="fileupload fileupload-new"><div style="max-width:60px;max-height:60px" class="fileupload-new thumbnail"><img src="<!--{{img_url}}--><!--{{template.nativeTemplate.buttons.0.icon|default('/static/img/wu_ss.gif')}}-->"></div><div style="max-width:60px;max-height:60px;line-height:20px" class="fileupload-preview fileupload-exists thumbnail"></div><span class="btn btn-file"><i class="icon-picture"></i> <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span> <input name="prize_img[]" type="hidden" value="<!--{{template.nativeTemplate.buttons.0.icon}}-->" class="picValue_b"> <input type="file" name="prize_pic[]" class="img_validate myfile"></span> <a data-dismiss="fileupload" class="btn fileupload-exists fileupload-remove" href="#">Remove</a> <span style="color:#b94a48" class="img_note" hidden>图片不能为空且限于png,gif,jpeg,jpg格式</span></div></div>';
            <!--{% elseif template.nativeTemplate.buttons.0.submitType=="outUrl" %}-->
                tempHtml += '<div class="control-group"><label class="control-label">按钮图片:</label><div data-provides="fileupload" class="fileupload fileupload-new"><div style="max-width:60px;max-height:60px" class="fileupload-new thumbnail"><img src="<!--{{img_url}}--><!--{{template.nativeTemplate.buttons.0.listButtonPic.0.backgroundPic|default('/static/img/wu_ss.gif')}}-->"></div><div style="max-width:60px;max-height:60px;line-height:20px" class="fileupload-preview fileupload-exists thumbnail"></div><span class="btn btn-file"><i class="icon-picture"></i> <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span> <input name="prize_img[]" type="hidden" value="<!--{{template.nativeTemplate.buttons.0.listButtonPic.0.backgroundPic}}-->" class="picValue_b"> <input type="file" name="prize_pic[]" class="img_validate myfile"></span> <a data-dismiss="fileupload" class="btn fileupload-exists fileupload-remove" href="#">Remove</a> <span style="color:#b94a48" class="img_note" hidden>图片不能为空且限于png,gif,jpeg,jpg格式</span></div></div><div class="control-group"><div class="controls"><label class="control-label">跳转地址</label><input type="text" name="outUrl" class="input-xxlarge outUrl" value="<!--{{template.nativeTemplate.buttons.0.outUrl}}-->" data-rule-required="true" data-msg-required="标题不能为空"></div></div>';
            <!--{% elseif template.nativeTemplate.buttons.0.submitType=="ranking" %}-->
                tempHtml += '<div class="control-group"><label class="control-label">按钮图片:</label><div data-provides="fileupload" class="fileupload fileupload-new"><div style="max-width:60px;max-height:60px" class="fileupload-new thumbnail"><img src="<!--{{img_url}}--><!--{{template.nativeTemplate.buttons.0.listButtonPic.0.backgroundPic|default('/static/img/wu_ss.gif')}}-->"></div><div style="max-width:60px;max-height:60px;line-height:20px" class="fileupload-preview fileupload-exists thumbnail"></div><span class="btn btn-file"><i class="icon-picture"></i> <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span> <input name="prize_img[]" type="hidden" value="<!--{{template.nativeTemplate.buttons.0.listButtonPic.0.backgroundPic}}-->" class="picValue_b"> <input type="file" name="prize_pic[]" class="img_validate myfile"></span> <a data-dismiss="fileupload" class="btn fileupload-exists fileupload-remove" href="#">Remove</a> <span style="color:#b94a48" class="img_note" hidden>图片不能为空且限于png,gif,jpeg,jpg格式</span></div></div>';
            <!--{% endif %}-->
        bottonHtmlObj.html(tempHtml);

        <!--{%elseif template.nativeTemplate.templateName=="dualButton"%}-->
        obj.children("div:first").append('<div class="control-group"><label class="control-label">按钮类型</label><div class="controls"><!--{{form_select('submitType[]',submitType,template.nativeTemplate.buttons.0.submitType,{'style':'width:160px;','class':'submitType'})}}--><span>大小</span> <input type="text" class="input-small" value="<!--{{template.nativeTemplate.buttons.0.size.0}}-->">*<input type="text" class="input-small" value="<!--{{template.nativeTemplate.buttons.0.size.1}}-->"></div></div><div class="buttonHtml"></div><div class="control-group"><label class="control-label">按钮类型</label><div class="controls"><!--{{form_select('submitType[]',submitType,template.nativeTemplate.buttons.1.submitType,{'style':'width:160px;','class':'submitType'})}}--><span>大小</span> <input type="text" class="input-small" value="<!--{{template.nativeTemplate.buttons.1.size.0}}-->">*<input type="text" class="input-small" value="<!--{{template.nativeTemplate.buttons.1.size.1}}-->"></div></div><div class="buttonHtml"></div>');

            var bottonHtmlObj_1 = obj.children("div").eq(-3).children("div").eq(-3);
            var bottonHtmlObj_2 = obj.children("div").eq(-3).children("div").eq(-1);
            //----------------------bottonHtml_1--------------------
            var tempHtml_1 = '';
            <!--{% if template.nativeTemplate.buttons.0.submitType=="submit" or template.nativeTemplate.buttons.0.submitType=="screenshot" %}-->
            tempHtml_1 += '<div class="control-group"><label class="control-label">按钮图片:</label><div class="controls"><div class="control-group"><label class="control-label">去完成</label><div data-provides="fileupload" class="fileupload fileupload-new"><div style="max-width:60px;max-height:60px" class="fileupload-new thumbnail"><img src="<!--{{img_url}}--><!--{{template.nativeTemplate.buttons.0.listButtonPic.0.backgroundPic|default('/static/img/wu_ss.gif')}}-->"></div><div style="max-width:60px;max-height:60px;line-height:20px" class="fileupload-preview fileupload-exists thumbnail"></div><span class="btn btn-file"><i class="icon-picture"></i> <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span> <input name="prize_img[]" type="hidden" value="<!--{{template.nativeTemplate.buttons.0.listButtonPic.0.backgroundPic}}-->" class="picValue_b"> <input type="file" name="prize_pic[]" class="img_validate myfile"></span> <a data-dismiss="fileupload" class="btn fileupload-exists fileupload-remove" href="#">Remove</a> <span style="color:#b94a48" class="img_note" hidden>图片不能为空且限于png,gif,jpeg,jpg格式</span></div></div><div class="control-group"><label class="control-label">审核中</label><div data-provides="fileupload" class="fileupload fileupload-new"><div style="max-width:60px;max-height:60px" class="fileupload-new thumbnail"><img src="<!--{{img_url}}--><!--{{template.nativeTemplate.buttons.0.listButtonPic.1.backgroundPic|default('/static/img/wu_ss.gif')}}-->"></div><div style="max-width:60px;max-height:60px;line-height:20px" class="fileupload-preview fileupload-exists thumbnail"></div><span class="btn btn-file"><i class="icon-picture"></i> <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span> <input name="prize_img[]" type="hidden" value="<!--{{template.nativeTemplate.buttons.0.listButtonPic.1.backgroundPic}}-->" class="picValue_b"> <input type="file" name="prize_pic[]" class="img_validate myfile"></span> <a data-dismiss="fileupload" class="btn fileupload-exists fileupload-remove" href="#">Remove</a> <span style="color:#b94a48" class="img_note" hidden>图片不能为空且限于png,gif,jpeg,jpg格式</span></div></div><div class="control-group"><label class="control-label">领取</label><div data-provides="fileupload" class="fileupload fileupload-new"><div style="max-width:60px;max-height:60px" class="fileupload-new thumbnail"><img src="<!--{{img_url}}--><!--{{template.nativeTemplate.buttons.0.listButtonPic.2.backgroundPic|default('/static/img/wu_ss.gif')}}-->"></div><div style="max-width:60px;max-height:60px;line-height:20px" class="fileupload-preview fileupload-exists thumbnail"></div><span class="btn btn-file"><i class="icon-picture"></i> <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span> <input name="prize_img[]" type="hidden" value="<!--{{template.nativeTemplate.buttons.0.listButtonPic.2.backgroundPic}}-->" class="picValue_b"> <input type="file" name="prize_pic[]" class="img_validate myfile"></span> <a data-dismiss="fileupload" class="btn fileupload-exists fileupload-remove" href="#">Remove</a> <span style="color:#b94a48" class="img_note" hidden>图片不能为空且限于png,gif,jpeg,jpg格式</span></div></div><div class="control-group"><label class="control-label">已完成</label><div data-provides="fileupload" class="fileupload fileupload-new"><div style="max-width:60px;max-height:60px" class="fileupload-new thumbnail"><img src="<!--{{img_url}}--><!--{{template.nativeTemplate.buttons.0.listButtonPic.3.backgroundPic|default('/static/img/wu_ss.gif')}}-->"></div><div style="max-width:60px;max-height:60px;line-height:20px" class="fileupload-preview fileupload-exists thumbnail"></div><span class="btn btn-file"><i class="icon-picture"></i> <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span> <input name="prize_img[]" type="hidden" value="<!--{{template.nativeTemplate.buttons.0.listButtonPic.3.backgroundPic}}-->" class="picValue_b"> <input type="file" name="prize_pic[]" class="img_validate myfile"></span> <a data-dismiss="fileupload" class="btn fileupload-exists fileupload-remove" href="#">Remove</a> <span style="color:#b94a48" class="img_note" hidden>图片不能为空且限于png,gif,jpeg,jpg格式</span></div></div></div></div>';
            var num = randomNum(99, 99999);
            tempHtml_1 += '<div class="control-group"><label class="control-label">限额模式</label><div class="controls"><div class="control-group"><input type="radio" name="'+num+'" value="1" class="isLimit" checked >是<input type="radio" name="'+num+'" value="0" class="isLimit" <!--{{  template.nativeTemplate.buttons.0.limitMode.limit|default('checked') }}--> >否</div><div class="input-append"><label class="control-label">初始名额</label><input type="text" class="input-small limitNumbers" value="<!--{{ template.nativeTemplate.buttons.0.limitMode.limitNumbers }}-->" /></div><div class="input-append"><label class="control-label">限时时间（h）</label><input type="text" class="input-small limitHours" value="<!--{{ template.nativeTemplate.buttons.0.limitMode.limitHours }}-->" /></div></div></div>';

            //子任务
            tempHtml_1 += '<div class="control-group"><label class="control-label">提交详情</label><div class="controls"><input type="button" class="input-small add_task" value="添加提交" /></div></div><div class="control-group">';

            <!--{% for taskSub in template.nativeTemplate.listTaskSub %}-->
            tempHtml_1 += '<fieldset style="width:600px;padding:10px;border-left:groove" class="controls taskHtml" opearteMode="<!--{{taskSub.opearteMode}}-->" taskId="<!--{{taskSub.taskId}}-->"><legend class="step">任务 <span>一</span></legend><div class="input-append"><input class="selected_task_id" type="hidden" value="<!--{{taskSub.taskId}}-->"> <input type="text" readonly class="input-medium selected_task_name" data-rule-required="true" data-msg-required="请选择任务" value="<!--{{taskSub.taskName}}-->"> <span class="add-on select-pop-sub-task">选择任务</span> <input value="插入任务" type="button" class="add_task_up" style="margin-left:20px"> <input value="删除" type="button" class="btn_task" style="margin-left:20px"></div><div class="control-group" style="margin-top:20px"><div class="input-append"><label class="control-label">间隔时间（天）</label><input type="text" class="input-small intervalDays" value="<!--{{taskSub.intervalDays}}-->"></div><div class="input-append"><label class="control-label">后续百分比</label><input type="text" class="input-small attendRate" value="<!--{{taskSub.attendRate}}-->"></div></div></fieldset>';
            <!--{% endfor %}-->
            tempHtml_1 += '</div>';

            <!--{% elseif template.nativeTemplate.buttons.0.submitType=="share" %}-->
            tempHtml_1 += '<div class="control-group"><label class="control-label">按钮图片:</label><div data-provides="fileupload" class="fileupload fileupload-new"><div style="max-width:60px;max-height:60px" class="fileupload-new thumbnail"><img src="<!--{{img_url}}--><!--{{template.nativeTemplate.buttons.0.listButtonPic.0.backgroundPic|default('/static/img/wu_ss.gif')}}-->"></div><div style="max-width:60px;max-height:60px;line-height:20px" class="fileupload-preview fileupload-exists thumbnail"></div><span class="btn btn-file"><i class="icon-picture"></i> <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span> <input name="prize_img[]" type="hidden" value="<!--{{template.nativeTemplate.buttons.0.listButtonPic.0.backgroundPic}}-->" class="picValue_b"> <input type="file" name="prize_pic[]" class="img_validate myfile"></span> <a data-dismiss="fileupload" class="btn fileupload-exists fileupload-remove" href="#">Remove</a> <span style="color:#b94a48" class="img_note" hidden>图片不能为空且限于png,gif,jpeg,jpg格式</span></div></div><div class="control-group"><label class="control-label">分享标题</label><div class="controls"><input type="text" name="title" class="input-xxlarge title" value="<!--{{template.nativeTemplate.buttons.0.title}}-->" data-rule-required="true" data-msg-required="标题不能为空"></div></div><div class="control-group"><label class="control-label">分享描述</label><div class="controls"><input type="text" name="desc" class="input-xxlarge desc" value="<!--{{template.nativeTemplate.buttons.0.desc}}-->" data-rule-required="true" data-msg-required="分享描述不能为空"></div></div><div class="control-group"><label class="control-label">分享Icon:</label><div data-provides="fileupload" class="fileupload fileupload-new"><div style="max-width:60px;max-height:60px" class="fileupload-new thumbnail"><img src="<!--{{img_url}}--><!--{{template.nativeTemplate.buttons.0.icon|default('/static/img/wu_ss.gif')}}-->"></div><div style="max-width:60px;max-height:60px;line-height:20px" class="fileupload-preview fileupload-exists thumbnail"></div><span class="btn btn-file"><i class="icon-picture"></i> <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span> <input name="prize_img[]" type="hidden" value="<!--{{template.nativeTemplate.buttons.0.icon}}-->" class="picValue_b"> <input type="file" name="prize_pic[]" class="img_validate myfile"></span> <a data-dismiss="fileupload" class="btn fileupload-exists fileupload-remove" href="#">Remove</a> <span style="color:#b94a48" class="img_note" hidden>图片不能为空且限于png,gif,jpeg,jpg格式</span></div></div>';
            <!--{% elseif template.nativeTemplate.buttons.0.submitType=="outUrl" %}-->
            tempHtml_1 += '<div class="control-group"><label class="control-label">按钮图片:</label><div data-provides="fileupload" class="fileupload fileupload-new"><div style="max-width:60px;max-height:60px" class="fileupload-new thumbnail"><img src="<!--{{img_url}}--><!--{{template.nativeTemplate.buttons.0.listButtonPic.0.backgroundPic|default('/static/img/wu_ss.gif')}}-->"></div><div style="max-width:60px;max-height:60px;line-height:20px" class="fileupload-preview fileupload-exists thumbnail"></div><span class="btn btn-file"><i class="icon-picture"></i> <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span> <input name="prize_img[]" type="hidden" value="<!--{{template.nativeTemplate.buttons.0.listButtonPic.0.backgroundPic}}-->" class="picValue_b"> <input type="file" name="prize_pic[]" class="img_validate myfile"></span> <a data-dismiss="fileupload" class="btn fileupload-exists fileupload-remove" href="#">Remove</a> <span style="color:#b94a48" class="img_note" hidden>图片不能为空且限于png,gif,jpeg,jpg格式</span></div></div><div class="control-group"><div class="controls"><label class="control-label">跳转地址</label><input type="text" name="outUrl" class="input-xxlarge outUrl" value="<!--{{template.nativeTemplate.buttons.0.outUrl}}-->" data-rule-required="true" data-msg-required="标题不能为空"></div></div>';
            <!--{% elseif template.nativeTemplate.buttons.0.submitType=="ranking" %}-->
            tempHtml_1 += '<div class="control-group"><label class="control-label">按钮图片:</label><div data-provides="fileupload" class="fileupload fileupload-new"><div style="max-width:60px;max-height:60px" class="fileupload-new thumbnail"><img src="<!--{{img_url}}--><!--{{template.nativeTemplate.buttons.0.listButtonPic.0.backgroundPic|default('/static/img/wu_ss.gif')}}-->"></div><div style="max-width:60px;max-height:60px;line-height:20px" class="fileupload-preview fileupload-exists thumbnail"></div><span class="btn btn-file"><i class="icon-picture"></i> <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span> <input name="prize_img[]" type="hidden" value="<!--{{template.nativeTemplate.buttons.0.listButtonPic.0.backgroundPic}}-->" class="picValue_b"> <input type="file" name="prize_pic[]" class="img_validate myfile"></span> <a data-dismiss="fileupload" class="btn fileupload-exists fileupload-remove" href="#">Remove</a> <span style="color:#b94a48" class="img_note" hidden>图片不能为空且限于png,gif,jpeg,jpg格式</span></div></div>';
            <!--{% endif %}-->
            //----------------------bottonHtml_1_end--------------------

            //----------------------bottonHtml_2--------------------
            var tempHtml_2 = '';
            <!--{% if template.nativeTemplate.buttons.1.submitType=="submit" or template.nativeTemplate.buttons.1.submitType=="screenshot" %}-->
            tempHtml_2 += '<div class="control-group"><label class="control-label">按钮图片:</label><div class="controls"><div class="control-group"><label class="control-label">去完成</label><div data-provides="fileupload" class="fileupload fileupload-new"><div style="max-width:60px;max-height:60px" class="fileupload-new thumbnail"><img src="<!--{{img_url}}--><!--{{template.nativeTemplate.buttons.1.listButtonPic.0.backgroundPic|default('/static/img/wu_ss.gif')}}-->"></div><div style="max-width:60px;max-height:60px;line-height:20px" class="fileupload-preview fileupload-exists thumbnail"></div><span class="btn btn-file"><i class="icon-picture"></i> <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span> <input name="prize_img[]" type="hidden" value="<!--{{template.nativeTemplate.buttons.1.listButtonPic.0.backgroundPic}}-->" class="picValue_b"> <input type="file" name="prize_pic[]" class="img_validate myfile"></span> <a data-dismiss="fileupload" class="btn fileupload-exists fileupload-remove" href="#">Remove</a> <span style="color:#b94a48" class="img_note" hidden>图片不能为空且限于png,gif,jpeg,jpg格式</span></div></div><div class="control-group"><label class="control-label">审核中</label><div data-provides="fileupload" class="fileupload fileupload-new"><div style="max-width:60px;max-height:60px" class="fileupload-new thumbnail"><img src="<!--{{img_url}}--><!--{{template.nativeTemplate.buttons.1.listButtonPic.1.backgroundPic|default('/static/img/wu_ss.gif')}}-->"></div><div style="max-width:60px;max-height:60px;line-height:20px" class="fileupload-preview fileupload-exists thumbnail"></div><span class="btn btn-file"><i class="icon-picture"></i> <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span> <input name="prize_img[]" type="hidden" value="<!--{{template.nativeTemplate.buttons.1.listButtonPic.1.backgroundPic}}-->" class="picValue_b"> <input type="file" name="prize_pic[]" class="img_validate myfile"></span> <a data-dismiss="fileupload" class="btn fileupload-exists fileupload-remove" href="#">Remove</a> <span style="color:#b94a48" class="img_note" hidden>图片不能为空且限于png,gif,jpeg,jpg格式</span></div></div><div class="control-group"><label class="control-label">领取</label><div data-provides="fileupload" class="fileupload fileupload-new"><div style="max-width:60px;max-height:60px" class="fileupload-new thumbnail"><img src="<!--{{img_url}}--><!--{{template.nativeTemplate.buttons.1.listButtonPic.2.backgroundPic|default('/static/img/wu_ss.gif')}}-->"></div><div style="max-width:60px;max-height:60px;line-height:20px" class="fileupload-preview fileupload-exists thumbnail"></div><span class="btn btn-file"><i class="icon-picture"></i> <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span> <input name="prize_img[]" type="hidden" value="<!--{{template.nativeTemplate.buttons.1.listButtonPic.2.backgroundPic}}-->" class="picValue_b"> <input type="file" name="prize_pic[]" class="img_validate myfile"></span> <a data-dismiss="fileupload" class="btn fileupload-exists fileupload-remove" href="#">Remove</a> <span style="color:#b94a48" class="img_note" hidden>图片不能为空且限于png,gif,jpeg,jpg格式</span></div></div><div class="control-group"><label class="control-label">已完成</label><div data-provides="fileupload" class="fileupload fileupload-new"><div style="max-width:60px;max-height:60px" class="fileupload-new thumbnail"><img src="<!--{{img_url}}--><!--{{template.nativeTemplate.buttons.1.listButtonPic.3.backgroundPic|default('/static/img/wu_ss.gif')}}-->"></div><div style="max-width:60px;max-height:60px;line-height:20px" class="fileupload-preview fileupload-exists thumbnail"></div><span class="btn btn-file"><i class="icon-picture"></i> <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span> <input name="prize_img[]" type="hidden" value="<!--{{template.nativeTemplate.buttons.1.listButtonPic.3.backgroundPic}}-->" class="picValue_b"> <input type="file" name="prize_pic[]" class="img_validate myfile"></span> <a data-dismiss="fileupload" class="btn fileupload-exists fileupload-remove" href="#">Remove</a> <span style="color:#b94a48" class="img_note" hidden>图片不能为空且限于png,gif,jpeg,jpg格式</span></div></div></div></div>';
            var num = randomNum(99, 99999);
            tempHtml_2 += '<div class="control-group"><label class="control-label">限额模式</label><div class="controls"><div class="control-group"><input type="radio" name="'+num+'" value="1" class="isLimit" checked >是<input type="radio" name="'+num+'" value="0" class="isLimit" <!--{{  template.nativeTemplate.buttons.0.limitMode.limit|default('checked') }}--> >否</div><div class="input-append"><label class="control-label">初始名额</label><input type="text" class="input-small limitNumbers" value="<!--{{ template.nativeTemplate.buttons.1.limitMode.limitNumbers }}-->" /></div><div class="input-append"><label class="control-label">限时时间（h）</label><input type="text" class="input-small limitHours" value="<!--{{ template.nativeTemplate.buttons.1.limitMode.limitHours }}-->" /></div></div></div>';

            //子任务
            tempHtml_2 += '<div class="control-group"><label class="control-label">提交详情</label><div class="controls"><input type="button" class="input-small add_task" value="添加提交" /></div></div><div class="control-group">';

            <!--{% for taskSub in template.nativeTemplate.listTaskSub %}-->
            tempHtml_2 += '<fieldset style="width:600px;padding:10px;border-left:groove" class="controls taskHtml" opearteMode="<!--{{taskSub.opearteMode}}-->" taskId="<!--{{taskSub.taskId}}-->"><legend class="step">任务 <span>一</span></legend><div class="input-append"><input class="selected_task_id" type="hidden" value="<!--{{taskSub.taskId}}-->"> <input type="text" readonly class="input-medium selected_task_name" data-rule-required="true" data-msg-required="请选择任务" value="<!--{{taskSub.taskName}}-->"> <span class="add-on select-pop-sub-task">选择任务</span> <input value="插入任务" type="button" class="add_task_up" style="margin-left:20px"> <input value="删除" type="button" class="btn_task" style="margin-left:20px"></div><div class="control-group" style="margin-top:20px"><div class="input-append"><label class="control-label">间隔时间（天）</label><input type="text" class="input-small intervalDays" value="<!--{{taskSub.intervalDays}}-->"></div><div class="input-append"><label class="control-label">后续百分比</label><input type="text" class="input-small attendRate" value="<!--{{taskSub.attendRate}}-->"></div></div></fieldset>';
            <!--{% endfor %}-->
            tempHtml_2 += '</div>';

            <!--{% elseif template.nativeTemplate.buttons.1.submitType=="share" %}-->
            tempHtml_2 += '<div class="control-group"><label class="control-label">按钮图片:</label><div data-provides="fileupload" class="fileupload fileupload-new"><div style="max-width:60px;max-height:60px" class="fileupload-new thumbnail"><img src="<!--{{img_url}}--><!--{{template.nativeTemplate.buttons.1.listButtonPic.0.backgroundPic|default('/static/img/wu_ss.gif')}}-->"></div><div style="max-width:60px;max-height:60px;line-height:20px" class="fileupload-preview fileupload-exists thumbnail"></div><span class="btn btn-file"><i class="icon-picture"></i> <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span> <input name="prize_img[]" type="hidden" value="<!--{{template.nativeTemplate.buttons.1.listButtonPic.0.backgroundPic}}-->" class="picValue_b"> <input type="file" name="prize_pic[]" class="img_validate myfile"></span> <a data-dismiss="fileupload" class="btn fileupload-exists fileupload-remove" href="#">Remove</a> <span style="color:#b94a48" class="img_note" hidden>图片不能为空且限于png,gif,jpeg,jpg格式</span></div></div><div class="control-group"><label class="control-label">分享标题</label><div class="controls"><input type="text" name="title" class="input-xxlarge title" value="<!--{{template.nativeTemplate.buttons.1.title}}-->" data-rule-required="true" data-msg-required="标题不能为空"></div></div><div class="control-group"><label class="control-label">分享描述</label><div class="controls"><input type="text" name="desc" class="input-xxlarge desc" value="<!--{{template.nativeTemplate.buttons.1.desc}}-->" data-rule-required="true" data-msg-required="分享描述不能为空"></div></div><div class="control-group"><label class="control-label">分享Icon:</label><div data-provides="fileupload" class="fileupload fileupload-new"><div style="max-width:60px;max-height:60px" class="fileupload-new thumbnail"><img src="<!--{{img_url}}--><!--{{template.nativeTemplate.buttons.1.icon|default('/static/img/wu_ss.gif')}}-->"></div><div style="max-width:60px;max-height:60px;line-height:20px" class="fileupload-preview fileupload-exists thumbnail"></div><span class="btn btn-file"><i class="icon-picture"></i> <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span> <input name="prize_img[]" type="hidden" value="<!--{{template.nativeTemplate.buttons.1.icon}}-->" class="picValue_b"> <input type="file" name="prize_pic[]" class="img_validate myfile"></span> <a data-dismiss="fileupload" class="btn fileupload-exists fileupload-remove" href="#">Remove</a> <span style="color:#b94a48" class="img_note" hidden>图片不能为空且限于png,gif,jpeg,jpg格式</span></div></div>';
            <!--{% elseif template.nativeTemplate.buttons.1.submitType=="outUrl" %}-->
            tempHtml_2 += '<div class="control-group"><label class="control-label">按钮图片:</label><div data-provides="fileupload" class="fileupload fileupload-new"><div style="max-width:60px;max-height:60px" class="fileupload-new thumbnail"><img src="<!--{{img_url}}--><!--{{template.nativeTemplate.buttons.1.listButtonPic.0.backgroundPic|default('/static/img/wu_ss.gif')}}-->"></div><div style="max-width:60px;max-height:60px;line-height:20px" class="fileupload-preview fileupload-exists thumbnail"></div><span class="btn btn-file"><i class="icon-picture"></i> <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span> <input name="prize_img[]" type="hidden" value="<!--{{template.nativeTemplate.buttons.1.listButtonPic.0.backgroundPic}}-->" class="picValue_b"> <input type="file" name="prize_pic[]" class="img_validate myfile"></span> <a data-dismiss="fileupload" class="btn fileupload-exists fileupload-remove" href="#">Remove</a> <span style="color:#b94a48" class="img_note" hidden>图片不能为空且限于png,gif,jpeg,jpg格式</span></div></div><div class="control-group"><div class="controls"><label class="control-label">跳转地址</label><input type="text" name="outUrl" class="input-xxlarge outUrl" value="<!--{{template.nativeTemplate.buttons.1.outUrl}}-->" data-rule-required="true" data-msg-required="标题不能为空"></div></div>';
            <!--{% elseif template.nativeTemplate.buttons.1.submitType=="ranking" %}-->
            tempHtml_2 += '<div class="control-group"><label class="control-label">按钮图片:</label><div data-provides="fileupload" class="fileupload fileupload-new"><div style="max-width:60px;max-height:60px" class="fileupload-new thumbnail"><img src="<!--{{img_url}}--><!--{{template.nativeTemplate.buttons.1.listButtonPic.0.backgroundPic|default('/static/img/wu_ss.gif')}}-->"></div><div style="max-width:60px;max-height:60px;line-height:20px" class="fileupload-preview fileupload-exists thumbnail"></div><span class="btn btn-file"><i class="icon-picture"></i> <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span> <input name="prize_img[]" type="hidden" value="<!--{{template.nativeTemplate.buttons.1.listButtonPic.0.backgroundPic}}-->" class="picValue_b"> <input type="file" name="prize_pic[]" class="img_validate myfile"></span> <a data-dismiss="fileupload" class="btn fileupload-exists fileupload-remove" href="#">Remove</a> <span style="color:#b94a48" class="img_note" hidden>图片不能为空且限于png,gif,jpeg,jpg格式</span></div></div>';
            <!--{% endif %}-->
            //----------------------bottonHtml_2_end--------------------

            bottonHtmlObj_1.html(tempHtml_1);
            bottonHtmlObj_2.html(tempHtml_2);

        <!--{%elseif template.nativeTemplate.templateName=="video"%}-->
        var videoInfo = "<!--{{template.videoInfo}}-->";
        obj.children("div:first").append('<div class="control-group"><label class="control-label">视频源码</label><div class="controls"><textarea class="videoInfo" style="width:400px;height:200px;">' + unescape(videoInfo) + '</textarea></div></div>');
        <!--{%endif%}-->

        <!--{%endfor%}-->

        $('input:radio').iCheck({
            checkboxClass: 'icheckbox_square-orange',
            radioClass: 'iradio_square-orange',
            increaseArea: '20%'
        });

        //模板图片
        $(".templateName").on('ifChecked',function(e){
            var obj =  $(this).parent().parent().parent().parent().parent().next();

            var html = '<div class="control-group"><label class="control-label">模板图片</label><div class="controls"><input type="button" class="input-small add_pic" value="新建"></div></div>';
            obj.html('').html(html);
        });

        $(document).on('click', '.add_pic', function(){
            var html = '<div class="controls" style="margin-top:20px"><div data-provides="fileupload" class="fileupload fileupload-new input-append"><div style="max-width:60px;max-height:60px" class="fileupload-new thumbnail"><img id="selected_game_icon" src="/static/img/wu_ss.gif"></div><div style="max-width:60px;max-height:60px;line-height:20px" class="fileupload-preview fileupload-exists thumbnail"></div><span class="btn btn-file"><i class="icon-picture"></i> <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span> <input class="picUrlsOld" name="picUrlsOld[]" type="hidden" value=""> <input type="file" name="picUrls[]" class="picUrls"></span> <a data-dismiss="fileupload" class="btn fileupload-exists" href="#">Remove</a> <span style="color:#b94a48" class="img_note" hidden>图片不能为空且限于png,gif,jpeg,jpg格式</span></div><div class="input-append"><input type="button" class="input-small del_pic" value="删除"></div></div>';
            var templateName = $(".templateName:checked").val();
            var temp = true;
            var picLength = $('.picUrls').length;

            if ((templateName == 'bigPic' || templateName == 'leftPic') && picLength > 0) {
                temp = false;
            } else if (templateName == 'bottomPic' && picLength > 2) {
                temp = false;
            } else if (templateName == 'nothing' && picLength > -1) {
                temp = false;
            }

            if (temp) {
                $(this).parent().parent().append(html);
            } else {
                alert('不能再添加');
            }
        });

        $(document).on('click', '.del_pic', function(){
            $(this).parent().parent().remove();
        });

        //选择游戏
        $('.select-pop-game').on('click', function () {
            var platformType=$('input:radio[name="platformType"]:checked').val();
            if (platformType == 'I') {
                var url = '/game/api/game-search';
            } else {
                var url = '/a_game/api/game-search';
            }
            $.ajax({
                url: url,
                dataType: 'json',
                success: function (json) {
                    var html = json.html;
                    $.dialog({id: 'pop-game-list', title: '提示', padding: 2, content: html, width: 600, height: 580});
                }
            });
        });

        var step_model_b = '<fieldset style="width:1000px;padding:10px;border-left:groove" class="step_b_1" opearteMode="NEW" id="" taskId="" subTaskId=""><legend class="step">按钮 <span>一</span> <!--{{form_select('stepType_b[]',stepType_b,'noButton',{'style':'width:160px;margin-left:240px;','class':'stepType_b'})}}--> </legend><div style="float:left"><div class="control-group"><label class="control-label">背景图片:</label><div class="controls"><div data-provides="fileupload" class="fileupload fileupload-new"><div style="max-width:60px;max-height:60px" class="fileupload-new thumbnail"><img src="/static/img/wu_ss.gif"></div><div style="max-width:60px;max-height:60px;line-height:20px" class="fileupload-preview fileupload-exists thumbnail"></div><span class="btn btn-file"><i class="icon-picture"></i> <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span> <input name="prize_img[]" type="hidden" value="" class="picValue_b"> <input type="file" name="prize_pic[]" class="img_validate myfile"></span> <a data-dismiss="fileupload" class="btn fileupload-exists fileupload-remove" href="#">Remove</a> <span style="color:#b94a48" class="img_note" hidden>图片不能为空且限于png,gif,jpeg,jpg格式</span></div></div></div><div class="control-group"><label class="control-label">图片大小</label><div class="controls"><input type="text" class="input-small" value=""> * <input type="text" class="input-small" value=""> <span style="color:red">必须为正整数</span></div></div></div><div style="float:left;margin-left:60px"><input value="插入结构" type="button" class="add_up_b"><br><br><input value="删除" type="button" class="btn_del"></div><div style="clear:both"></div></fieldset>';
        var step_cont_b_1 = '<div class="control-group"><label class="control-label">背景图片:</label><div class="controls"><div data-provides="fileupload" class="fileupload fileupload-new"><div style="max-width:60px;max-height:60px" class="fileupload-new thumbnail"><img src="/static/img/wu_ss.gif"></div><div style="max-width:60px;max-height:60px;line-height:20px" class="fileupload-preview fileupload-exists thumbnail"></div><span class="btn btn-file"><i class="icon-picture"></i> <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span> <input name="prize_img[]" type="hidden" value="" class="picValue_b"> <input type="file" name="prize_pic[]" class="img_validate myfile"></span> <a data-dismiss="fileupload" class="btn fileupload-exists fileupload-remove" href="#">Remove</a> <span style="color:#b94a48" class="img_note" hidden>图片不能为空且限于png,gif,jpeg,jpg格式</span></div></div></div><div class="control-group"><label class="control-label">图片大小</label><div class="controls"><input type="text" class="input-small" value=""> * <input type="text" class="input-small" value=""> <span style="color:red">必须为正整数</span></div></div>';
        var step_cont_b_2 = '<div class="control-group"><label class="control-label">背景图片:</label><div class="controls"><div data-provides="fileupload" class="fileupload fileupload-new"><div style="max-width:60px;max-height:60px" class="fileupload-new thumbnail"><img src="/static/img/wu_ss.gif"></div><div style="max-width:60px;max-height:60px;line-height:20px" class="fileupload-preview fileupload-exists thumbnail"></div><span class="btn btn-file"><i class="icon-picture"></i> <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span> <input name="prize_img[]" type="hidden" value="" class="picValue_b"> <input type="file" name="prize_pic[]" class="img_validate myfile"></span> <a data-dismiss="fileupload" class="btn fileupload-exists fileupload-remove" href="#">Remove</a> <span style="color:#b94a48" class="img_note" hidden>图片不能为空且限于png,gif,jpeg,jpg格式</span></div></div></div><div class="control-group"><label class="control-label">图片大小</label><div class="controls"><input type="text" class="input-small" value=""> * <input type="text" class="input-small" value=""> <span style="color:red">必须为正整数</span></div></div><div class="control-group"><label class="control-label">按钮类型</label><div class="controls"><!--{{form_select('submitType[]',submitType,item.submitType,{'style':'width:160px;','class':'submitType'})}}--> <span>大小</span> <input type="text" class="input-small" value=""> * <input type="text" class="input-small" value=""></div></div><div class="buttonHtml"></div>';
        var step_cont_b_3 = '<div class="control-group"><label class="control-label">背景图片:</label><div class="controls"><div data-provides="fileupload" class="fileupload fileupload-new"><div style="max-width:60px;max-height:60px" class="fileupload-new thumbnail"><img src="/static/img/wu_ss.gif"></div><div style="max-width:60px;max-height:60px;line-height:20px" class="fileupload-preview fileupload-exists thumbnail"></div><span class="btn btn-file"><i class="icon-picture"></i> <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span> <input name="prize_img[]" type="hidden" value="" class="picValue_b"> <input type="file" name="prize_pic[]" class="img_validate myfile"></span> <a data-dismiss="fileupload" class="btn fileupload-exists fileupload-remove" href="#">Remove</a> <span style="color:#b94a48" class="img_note" hidden>图片不能为空且限于png,gif,jpeg,jpg格式</span></div></div></div><div class="control-group"><label class="control-label">图片大小</label><div class="controls"><input type="text" class="input-small" value=""> * <input type="text" class="input-small" value=""> <span style="color:red">必须为正整数</span></div></div><div class="control-group"><label class="control-label">按钮类型</label><div class="controls"><!--{{form_select('submitType[]',submitType,item.submitType,{'style':'width:160px;','class':'submitType'})}}--> <span>大小</span> <input type="text" class="input-small" value=""> * <input type="text" class="input-small" value=""></div></div><div class="buttonHtml"></div><div class="control-group"><label class="control-label">按钮类型</label><div class="controls"><!--{{form_select('submitType[]',submitType,item.submitType,{'style':'width:160px;','class':'submitType'})}}--> <span>大小</span> <input type="text" class="input-small" value=""> * <input type="text" class="input-small" value=""></div></div><div class="buttonHtml"></div>';
        var step_cont_b_4 = '<div class="control-group"><label class="control-label">背景图片:</label><div class="controls"><div data-provides="fileupload" class="fileupload fileupload-new"><div style="max-width:60px;max-height:60px" class="fileupload-new thumbnail"><img src="/static/img/wu_ss.gif"></div><div style="max-width:60px;max-height:60px;line-height:20px" class="fileupload-preview fileupload-exists thumbnail"></div><span class="btn btn-file"><i class="icon-picture"></i> <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span> <input name="prize_img[]" type="hidden" value="" class="picValue_b"> <input type="file" name="prize_pic[]" class="img_validate myfile"></span> <a data-dismiss="fileupload" class="btn fileupload-exists fileupload-remove" href="#">Remove</a> <span style="color:#b94a48" class="img_note" hidden>图片不能为空且限于png,gif,jpeg,jpg格式</span></div></div></div><div class="control-group"><label class="control-label">图片大小</label><div class="controls"><input type="text" class="input-small" value=""> * <input type="text" class="input-small" value=""> <span style="color:red">必须为正整数</span></div></div><div class="control-group"><label class="control-label">视频源码</label><div class="controls"><textarea class="videoInfo" style="width:400px;height:200px"></textarea></div></div>';
        var step_cont_b_5 = '<div class="control-group"><label class="control-label">背景颜色:</label><div class="controls"><input type="text" class="input-small" value="<!--{{item.backgroundColor}}-->"></div></div><div class="control-group"><label class="control-label">标题字号:</label><div class="controls"><input type="text" class="input-small" value="<!--{{item.titleFontSize}}-->"></div></div><div class="control-group"><label class="control-label">标题颜色:</label><div class="controls"><input type="text" class="input-small" value="<!--{{item.titleColor}}-->"></div></div><div class="control-group"><label class="control-label">按钮图片:</label><div class="controls"><div data-provides="fileupload" class="fileupload fileupload-new"><div style="max-width:60px;max-height:60px" class="fileupload-new thumbnail"><img src="<!--{{item.buttons.0.backgroundPic|default('/static/img/wu_ss.gif')}}-->"></div><div style="max-width:60px;max-height:60px;line-height:20px" class="fileupload-preview fileupload-exists thumbnail"></div><span class="btn btn-file"><i class="icon-picture"></i> <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span> <input name="prize_img[]" type="hidden" value="<!--{{item.buttons.0.backgroundPic}}-->" class="picValue_b"> <input type="file" name="prize_pic[]" class="img_validate myfile"></span> <a data-dismiss="fileupload" class="btn fileupload-exists fileupload-remove" href="#">Remove</a> <span style="color:#b94a48" class="img_note" hidden>图片不能为空且限于png,gif,jpeg,jpg格式</span></div></div></div><div class="control-group"><label class="control-label">按钮大小</label><div class="controls"><input type="text" class="input-small" value="<!--{{item.buttonSize.0}}-->"> * <input type="text" class="input-small" value="<!--{{item.buttonSize.1}}-->"> <span style="color:red">必须为正整数</span></div></div>';

        //生成从minNum到maxNum的随机数
        function randomNum(minNum,maxNum){
            switch(arguments.length){
                case 1:
                    return parseInt(Math.random()*minNum+1,10);
                    break;
                case 2:
                    return parseInt(Math.random()*(maxNum-minNum+1)+minNum,10);
                    break;
                default:
                    return 0;
                    break;
            }
        }

        function step_botton_1() {
            var num = randomNum(99, 99999);
            var html = '<div class="control-group"><label class="control-label">按钮图片:</label><div class="controls"><div class="control-group"><label class="control-label">去完成</label><div data-provides="fileupload" class="fileupload fileupload-new"><div style="max-width:60px;max-height:60px" class="fileupload-new thumbnail"><img src="/static/img/wu_ss.gif"></div><div style="max-width:60px;max-height:60px;line-height:20px" class="fileupload-preview fileupload-exists thumbnail"></div><span class="btn btn-file"><i class="icon-picture"></i> <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span> <input name="prize_img[]" type="hidden" value="" class="picValue_b"> <input type="file" name="prize_pic[]" class="img_validate myfile"></span> <a data-dismiss="fileupload" class="btn fileupload-exists fileupload-remove" href="#">Remove</a> <span style="color:#b94a48" class="img_note" hidden>图片不能为空且限于png,gif,jpeg,jpg格式</span></div></div><div class="control-group"><label class="control-label">审核中</label><div data-provides="fileupload" class="fileupload fileupload-new"><div style="max-width:60px;max-height:60px" class="fileupload-new thumbnail"><img src="/static/img/wu_ss.gif"></div><div style="max-width:60px;max-height:60px;line-height:20px" class="fileupload-preview fileupload-exists thumbnail"></div><span class="btn btn-file"><i class="icon-picture"></i> <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span> <input name="prize_img[]" type="hidden" value="" class="picValue_b"> <input type="file" name="prize_pic[]" class="img_validate myfile"></span> <a data-dismiss="fileupload" class="btn fileupload-exists fileupload-remove" href="#">Remove</a> <span style="color:#b94a48" class="img_note" hidden>图片不能为空且限于png,gif,jpeg,jpg格式</span></div></div><div class="control-group"><label class="control-label">领取</label><div data-provides="fileupload" class="fileupload fileupload-new"><div style="max-width:60px;max-height:60px" class="fileupload-new thumbnail"><img src="/static/img/wu_ss.gif"></div><div style="max-width:60px;max-height:60px;line-height:20px" class="fileupload-preview fileupload-exists thumbnail"></div><span class="btn btn-file"><i class="icon-picture"></i> <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span> <input name="prize_img[]" type="hidden" value="" class="picValue_b"> <input type="file" name="prize_pic[]" class="img_validate myfile"></span> <a data-dismiss="fileupload" class="btn fileupload-exists fileupload-remove" href="#">Remove</a> <span style="color:#b94a48" class="img_note" hidden>图片不能为空且限于png,gif,jpeg,jpg格式</span></div></div><div class="control-group"><label class="control-label">已完成</label><div data-provides="fileupload" class="fileupload fileupload-new"><div style="max-width:60px;max-height:60px" class="fileupload-new thumbnail"><img src="/static/img/wu_ss.gif"></div><div style="max-width:60px;max-height:60px;line-height:20px" class="fileupload-preview fileupload-exists thumbnail"></div><span class="btn btn-file"><i class="icon-picture"></i> <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span> <input name="prize_img[]" type="hidden" value="" class="picValue_b"> <input type="file" name="prize_pic[]" class="img_validate myfile"></span> <a data-dismiss="fileupload" class="btn fileupload-exists fileupload-remove" href="#">Remove</a> <span style="color:#b94a48" class="img_note" hidden>图片不能为空且限于png,gif,jpeg,jpg格式</span></div></div></div></div><div class="control-group"><label class="control-label">限额模式</label><div class="controls"><div class="control-group">'
                +'<input type="radio" name="'+num+'" value="1" class="isLimit" checked>'
                +'是'
                +'<input type="radio" name="'+num+'" value="0" class="isLimit" >'
                +'否'+
                '</div><div class="input-append"><label class="control-label">初始名额</label><input type="text" class="input-small limitNumbers" value=""></div><div class="input-append"><label class="control-label">限时时间（h）</label><input type="text" class="input-small limitHours" value=""></div></div></div><div class="control-group"><label class="control-label">提交详情</label><div class="controls"><input type="button" class="input-small add_task" value="添加提交"></div></div><div class="control-group"><fieldset style="width:600px;padding:10px;border-left:groove" class="controls taskHtml" opearteMode="NEW" taskId=""><legend class="step">任务 <span>一</span></legend><div class="input-append"><input class="selected_task_id" type="hidden" value=""> <input type="text" readonly class="input-medium selected_task_name" data-rule-required="true" data-msg-required="请选择任务" value=""> <span class="add-on select-pop-sub-task">选择任务</span> <input value="插入任务" type="button" class="add_task_up" style="margin-left:20px"> <input value="删除" type="button" class="btn_task" style="margin-left:20px"></div><div class="control-group" style="margin-top:20px"><div class="input-append"><label class="control-label">间隔时间（天）</label><input type="text" class="input-small intervalDays" value=""></div><div class="input-append"><label class="control-label">后续百分比</label><input type="text" class="input-small attendRate" value=""></div></div></fieldset></div>';

            return html;
        }

        var step_botton_3 = '<div class="control-group"><label class="control-label">按钮图片:</label><div data-provides="fileupload" class="fileupload fileupload-new"><div style="max-width:60px;max-height:60px" class="fileupload-new thumbnail"><img src="/static/img/wu_ss.gif"></div><div style="max-width:60px;max-height:60px;line-height:20px" class="fileupload-preview fileupload-exists thumbnail"></div><span class="btn btn-file"><i class="icon-picture"></i> <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span> <input name="prize_img[]" type="hidden" value="" class="picValue_b"> <input type="file" name="prize_pic[]" class="img_validate myfile"></span> <a data-dismiss="fileupload" class="btn fileupload-exists fileupload-remove" href="#">Remove</a> <span style="color:#b94a48" class="img_note" hidden>图片不能为空且限于png,gif,jpeg,jpg格式</span></div></div><div class="control-group"><label class="control-label">分享标题</label><div class="controls"><input type="text" name="title" class="input-xxlarge title" value="" data-rule-required="true" data-msg-required="标题不能为空"></div></div><div class="control-group"><label class="control-label">分享描述</label><div class="controls"><input type="text" name="desc" class="input-xxlarge desc" value="" data-rule-required="true" data-msg-required="分享描述不能为空"></div></div><div class="control-group"><label class="control-label">分享Icon:</label><div data-provides="fileupload" class="fileupload fileupload-new"><div style="max-width:60px;max-height:60px" class="fileupload-new thumbnail"><img src="/static/img/wu_ss.gif"></div><div style="max-width:60px;max-height:60px;line-height:20px" class="fileupload-preview fileupload-exists thumbnail"></div><span class="btn btn-file"><i class="icon-picture"></i> <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span> <input name="prize_img[]" type="hidden" value="" class="picValue_b"> <input type="file" name="prize_pic[]" class="img_validate myfile"></span> <a data-dismiss="fileupload" class="btn fileupload-exists fileupload-remove" href="#">Remove</a> <span style="color:#b94a48" class="img_note" hidden>图片不能为空且限于png,gif,jpeg,jpg格式</span></div></div>';
        var step_botton_4 = '<div class="control-group"><label class="control-label">按钮图片:</label><div data-provides="fileupload" class="fileupload fileupload-new"><div style="max-width:60px;max-height:60px" class="fileupload-new thumbnail"><img src="/static/img/wu_ss.gif"></div><div style="max-width:60px;max-height:60px;line-height:20px" class="fileupload-preview fileupload-exists thumbnail"></div><span class="btn btn-file"><i class="icon-picture"></i> <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span> <input name="prize_img[]" type="hidden" value="" class="picValue_b"> <input type="file" name="prize_pic[]" class="img_validate myfile"></span> <a data-dismiss="fileupload" class="btn fileupload-exists fileupload-remove" href="#">Remove</a> <span style="color:#b94a48" class="img_note" hidden>图片不能为空且限于png,gif,jpeg,jpg格式</span></div></div><div class="control-group"><div class="controls"><label class="control-label">跳转地址</label><input type="text" name="outUrl" class="input-xxlarge outUrl" value="" data-rule-required="true" data-msg-required="标题不能为空"></div></div>';
        var step_botton_5 = '<div class="control-group"><label class="control-label">按钮图片:</label><div data-provides="fileupload" class="fileupload fileupload-new"><div style="max-width:60px;max-height:60px" class="fileupload-new thumbnail"><img src="/static/img/wu_ss.gif"></div><div style="max-width:60px;max-height:60px;line-height:20px" class="fileupload-preview fileupload-exists thumbnail"></div><span class="btn btn-file"><i class="icon-picture"></i> <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span> <input name="prize_img[]" type="hidden" value="" class="picValue_b"> <input type="file" name="prize_pic[]" class="img_validate myfile"></span> <a data-dismiss="fileupload" class="btn fileupload-exists fileupload-remove" href="#">Remove</a> <span style="color:#b94a48" class="img_note" hidden>图片不能为空且限于png,gif,jpeg,jpg格式</span></div></div>';

        $(".add_down_b").live("click",function(){
            $(this).parent().parent().parent().children(".step_content_b").append(step_model_b);
            var c = $(this).attr("step_type_b");
            $(this).parent().parent().parent().children(".step_content_b").children("fieldset").each(function(){
                $(this).addClass(c);
            })
            set_step_sort(c);
        });

        //添加
        $(".add_up_b").live('click',function(){
            var html = '<fieldset style="width:1000px;padding:10px;border-left:groove" class="step_b_1" opearteMode="NEW" id="" taskId="" subTaskId=""><legend class="step">按钮 <span>一</span> <!--{{form_select('stepType_b[]',stepType_b,'noButton',{'style':'width:160px;margin-left:240px;','class':'stepType_b'})}}--> </legend><div style="float:left"><div class="control-group"><label class="control-label">背景图片:</label><div class="controls"><div data-provides="fileupload" class="fileupload fileupload-new"><div style="max-width:60px;max-height:60px" class="fileupload-new thumbnail"><img src="/static/img/wu_ss.gif"></div><div style="max-width:60px;max-height:60px;line-height:20px" class="fileupload-preview fileupload-exists thumbnail"></div><span class="btn btn-file"><i class="icon-picture"></i> <span class="fileupload-new">选择照片</span><span class="fileupload-exists">Change</span> <input name="prize_img[]" type="hidden" value="" class="picValue_b"> <input type="file" name="prize_pic[]" class="img_validate myfile"></span> <a data-dismiss="fileupload" class="btn fileupload-exists fileupload-remove" href="#">Remove</a> <span style="color:#b94a48" class="img_note" hidden>图片不能为空且限于png,gif,jpeg,jpg格式</span></div></div></div><div class="control-group"><label class="control-label">图片大小</label><div class="controls"><input type="text" class="input-small" value=""> * <input type="text" class="input-small" value=""> <span style="color:red">必须为正整数</span></div></div></div><div style="float:left;margin-left:60px"><input value="插入结构" type="button" class="add_up_b"><br><br><input value="删除" type="button" class="btn_del"></div><div style="clear:both"></div></fieldset>';
            $(this).parent().parent().before(html);
            set_step_sort('step_b_1');
        });

        //删除模板
        $(".btn_del").live('click',function(){
            if(!confirm("删除后无法恢复，确认删除？")) return false;
            var _obj = $(this).parent().parent();
            var id = _obj.attr('id');
            if (id) {
                _obj.attr('opearteMode', 'DELETED');
                _obj.hide();
            } else {
                _obj.remove();
            }
            set_step_sort('step_b_1');
        });

        //选择子任务 select-pop-sub-task
        $(document).on('click', '.select-pop-sub-task', function () {
            selectPopSubTask = $(this);

            var platformType=$('input:radio[name="platformType"]:checked').val();
            $.ajax({
                url:'/v4_task/task/iframe-sub-task',
                data:{platformType:platformType},
                dataType:'json',
                success:function(json){
                    var html = json.html;
                    $.dialog({id:'pop-task-list',title:'提示',padding:2,content:html,width:650,height:500});
                }
            });
        });

        //添加子任务
        var taskHtml = '<fieldset style="width:600px;padding:10px;border-left:groove" class="controls taskHtml" opearteMode="NEW" taskId=""><legend class="step">任务 <span>一</span></legend><div class="input-append"><input class="selected_task_id" type="hidden" value=""> <input type="text" readonly class="input-medium selected_task_name" data-rule-required="true" data-msg-required="请选择任务" value=""> <span class="add-on select-pop-sub-task">选择任务</span> <input value="插入任务" type="button" class="add_task_up" style="margin-left:20px"> <input value="删除" type="button" class="btn_task" style="margin-left:20px"></div><div class="control-group" style="margin-top:20px"><div class="input-append"><label class="control-label">间隔时间（天）</label><input type="text" class="input-small intervalDays" value=""></div><div class="input-append"><label class="control-label">后续百分比</label><input type="text" class="input-small attendRate" value=""></div></div></fieldset>';

        $(document).on('click', '.add_task', function () {
            var _obj = $(this);
            _obj.parent().parent().next().append(taskHtml);
            set_step_sort('taskHtml');

        });

        //删除子任务
        $(document).on('click', '.add_task_up', function () {
            var _obj = $(this);
            _obj.parent().parent().before(taskHtml);
            set_step_sort('taskHtml');

        });

        $(document).on('click', '.btn_task', function () {
            if(!confirm("删除后无法恢复，确认删除？")) return false;
            var _obj = $(this).parent().parent();
            var taskId = _obj.attr('taskId');
            if (taskId) {
                _obj.attr('opearteMode', 'DELETED');
                _obj.hide();
            } else {
                _obj.remove();
            }
            set_step_sort('taskHtml');
        });
        

        $(".stepType_b").live('change',function(){
            var type = $(this).val();

            switch(type)
            {
                case 'noButton':
                    $(this).parent().siblings("div").eq(0).html(step_cont_b_1);
                    break;
                case 'bigButton':
                    $(this).parent().siblings("div").eq(0).html(step_cont_b_2);
                    $(this).parent().siblings("div").eq(0).find('.submitType').trigger('change');
                    break;
                case 'dualButton':
                    $(this).parent().siblings("div").eq(0).html(step_cont_b_3);
                    $(this).parent().siblings("div").eq(0).find('.submitType').trigger('change');
                    break;
                case 'video':
                    $(this).parent().siblings("div").eq(0).html(step_cont_b_4);
                    break;
                case 'inmobile':
                    $(this).parent().siblings("div").eq(0).html(step_cont_b_5);
                    break;
                default:
            }
        });

        $(".submitType").live('change',function () {
            var submitType = $(this).val();
            var parentObj = $(this).parent().parent().next();
            parentObj.html('');
            switch(submitType)
            {
                case 'submit':
                    parentObj.html(step_botton_1());
                    break;
                case 'screenshot':
                    parentObj.html(step_botton_1());
                    break;
                case 'share':
                    parentObj.html(step_botton_3);
                    break;
                case 'outUrl':
                    parentObj.html(step_botton_4);
                    break;
                case 'ranking':
                    parentObj.html(step_botton_5);
                    break;
                default:
            }
            $('input:radio').iCheck({
                checkboxClass: 'icheckbox_square-orange',
                radioClass: 'iradio_square-orange',
                increaseArea: '20%'
            });
        });
        
        function set_button_json(obj, i) {
            // i 为图片 index
            var buttons = '';
            var listTaskSub = '';
            obj.find('.submitType').each(function (k,v) {
                var submitType = $(v).val();
                var buttonHtmlObj = $(v).parent().parent().next();
                console.log(submitType);

                buttons += '{"submitType":"'+ submitType +'",';
                switch(submitType)
                {
                    case 'submit':
                        //attend去完成,audit审核中，award领取，completed已完成
                        var attend = $('.picValue_b').eq(i).val(); i++;
                        var audit = $('.picValue_b').eq(i).val(); i++;
                        var award = $('.picValue_b').eq(i).val(); i++;
                        var completed = $('.picValue_b').eq(i).val(); i++;
                        buttons += '"listButtonPic":[' +
                            '{"buttonType":"attend","backgroundPic":"'+ attend +'"},'+
                            '{"buttonType":"audit","backgroundPic":"'+ audit +'"},'+
                            '{"buttonType":"award","backgroundPic":"'+ award +'"},'+
                            '{"buttonType":"completed","backgroundPic":"'+ completed +'"}'+
                            '],';
                        var size1 = $(v).next().next().val();
                        var size2 = $(v).next().next().next().val();
                        buttons += '"size":"'+ size1 +','+ size2 +'",';

                        var isLimit = buttonHtmlObj.find('.isLimit:checked').val();
                        if(isLimit == 1){
                            isLimit = 'true';
                        } else {
                            isLimit = 'false';
                        }
                        var limitNumbers = buttonHtmlObj.find('.limitNumbers').val();
                        var limitHours = buttonHtmlObj.find('.limitHours').val();
                        buttons += '"limitMode":{' +
                            '"limit":'+ isLimit +',' +
                            '"limitNumbers":"'+ limitNumbers +'",' +
                            '"limitHours":"'+ limitHours +'"' +
                            '}';

                        //子任务
                        buttonHtmlObj.find('.taskHtml').each(function (index, item) {
                            listTaskSub += '{';
                            var opearteMode = $(item).attr('opearteMode');
                            var taskId = $(item).attr('taskId');
                            var taskName = $(item).find('.selected_task_name').val();
                            var intervalDays = $(item).find('.intervalDays').val();
                            var attendRate = $(item).find('.attendRate').val();
                            listTaskSub += '"opearteMode":"'+ opearteMode +'",';
                            listTaskSub += '"taskId":"'+ taskId +'",';
                            listTaskSub += '"taskName":"'+ taskName +'",';
                            listTaskSub += '"intervalDays":"'+ intervalDays +'",';
                            listTaskSub += '"attendRate":"'+ attendRate +'"';

                            listTaskSub += '},';
                        });
                        listTaskSub = listTaskSub.substring(0,listTaskSub.length-1);

                        break;
                    case 'screenshot':
                        //attend去完成,audit审核中，award领取，completed已完成
                        var attend = $('.picValue_b').eq(i).val(); i++;
                        var audit = $('.picValue_b').eq(i).val(); i++;
                        var award = $('.picValue_b').eq(i).val(); i++;
                        var completed = $('.picValue_b').eq(i).val(); i++;
                        buttons += '"listButtonPic":[' +
                            '{"buttonType":"attend","backgroundPic":"'+ attend +'"},'+
                            '{"buttonType":"audit","backgroundPic":"'+ audit +'"},'+
                            '{"buttonType":"award","backgroundPic":"'+ award +'"},'+
                            '{"buttonType":"completed","backgroundPic":"'+ completed +'"}'+
                            '],';
                        var size1 = $(v).next().next().val();
                        var size2 = $(v).next().next().next().val();
                        buttons += '"size":"'+ size1 +','+ size2 +'",';

                        var isLimit = buttonHtmlObj.find('.isLimit:checked').val();
                        if(isLimit == 1){
                            isLimit = 'true';
                        } else {
                            isLimit = 'false';
                        }
                        var limitNumbers = buttonHtmlObj.find('.limitNumbers').val();
                        var limitHours = buttonHtmlObj.find('.limitHours').val();
                        buttons += '"limitMode":{' +
                            '"limit":'+ isLimit +',' +
                            '"limitNumbers":"'+ limitNumbers +'",' +
                            '"limitHours":"'+ limitHours +'"' +
                            '}';

                        //子任务
                        buttonHtmlObj.find('.taskHtml').each(function (index, item) {
                            listTaskSub += '{';
                            var opearteMode = $(item).attr('opearteMode');
                            var taskId = $(item).attr('taskId');
                            var intervalDays = $(item).find('.intervalDays').val();
                            var taskName = $(item).find('.selected_task_name').val();
                            var attendRate = $(item).find('.attendRate').val();
                            listTaskSub += '"opearteMode":"'+ opearteMode +'",';
                            listTaskSub += '"taskId":"'+ taskId +'",';
                            listTaskSub += '"taskName":"'+ taskName +'",';
                            listTaskSub += '"intervalDays":"'+ intervalDays +'",';
                            listTaskSub += '"attendRate":"'+ attendRate +'"';

                            listTaskSub += '},';
                        });
                        listTaskSub = listTaskSub.substring(0,listTaskSub.length-1);

                        break;
                    case 'share':

                        var normal = $('.picValue_b').eq(i).val(); i++;
                        var title = buttonHtmlObj.find('.title').val();
                        var desc = buttonHtmlObj.find('.desc').val();
                        var icon = $('.picValue_b').eq(i).val(); i++;

                        buttons += '"listButtonPic":[' +
                            '{"buttonType":"normal","backgroundPic":"'+ normal +'"}'+
                            '],';

                        var size1 = $(v).next().next().val();
                        var size2 = $(v).next().next().next().val();
                        buttons += '"size":"'+ size1 +','+ size2 +'",';

                        buttons += '"title":"'+ title +'",';
                        buttons += '"desc":"'+ desc +'",';
                        buttons += '"icon":"'+ icon +'"';

                        break;
                    case 'outUrl':
                        var normal = $('.picValue_b').eq(i).val(); i++;
                        buttons += '"listButtonPic":[' +
                            '{"buttonType":"normal","backgroundPic":"'+ normal +'"}'+
                            '],';

                        var size1 = $(v).next().next().val();
                        var size2 = $(v).next().next().next().val();
                        buttons += '"size":"'+ size1 +','+ size2 +'",';

                        var outUrl = buttonHtmlObj.find('.outUrl').val();
                        buttons += '"outUrl":"'+ outUrl +'"';

                        break;
                    case 'ranking':
                        var normal = $('.picValue_b').eq(i).val(); i++;
                        buttons += '"listButtonPic":[' +
                            '{"buttonType":"normal","backgroundPic":"'+ normal +'"}'+
                            '],';
                        var size1 = $(v).next().next().val();
                        var size2 = $(v).next().next().next().val();
                        buttons += '"size":"'+ size1 +','+ size2 +'"';

                        break;

                    default:
                }

                buttons += '},';

            });
            buttons = buttons.substring(0,buttons.length-1);

            var data = new Object();
            data.buttons = buttons;
            data.listTaskSub = listTaskSub;
            data.i = i;
            return data;
        }

        //组合json
        function set_step_json_b(steptype){
            var i = 0;
            var json = '';
            $("."+steptype).each(function(){
                var stepType = $(this).children("legend").children(".stepType_b").val();
                var opearteMode = $(this).attr('opearteMode');
                var id = $(this).attr('id');
                var taskId = $(this).attr('taskId');
                var subTaskId = $(this).attr('subTaskId');

                var conditon = "";

                conditon += '{"opearteMode":"' + opearteMode + '","id":"' + id + '","taskId":"' + taskId + '","subTaskId":"' + subTaskId + '","nativeTemplate":';
                conditon += '{"templateName":"'+stepType+'",';
                conditon += '"backgroundPic":"'+$('.picValue_b').eq(i).val()+'",';i++;
                var size_w_1 = $(this).children().eq(1).children("div").eq(1).children("div").children("input").eq(0).val();
                var size_h_1 = $(this).children().eq(1).children("div").eq(1).children("div").children("input").eq(1).val();
                conditon += '"size":"'+size_w_1+','+size_h_1+'",';

                switch(stepType)
                {
                    case 'noButton':

                        break;
                    case 'bigButton':
                        var temp = set_button_json($(this), i);
                        if (temp.buttons) {
                            conditon += '"buttons":['+ temp.buttons +'],';
                        }
                        if (temp.listTaskSub) {
                            conditon += '"listTaskSub":['+ temp.listTaskSub +'],';
                        }
                        i = temp.i;
                        break;
                    case 'dualButton':
                        var temp = set_button_json($(this), i);
                        if (temp.buttons) {
                            conditon += '"buttons":['+ temp.buttons +'],';
                        }
                        if (temp.listTaskSub) {
                            conditon += '"listTaskSub":['+ temp.listTaskSub +'],';
                        }
                        i = temp.i;
                        break;
                    case 'video':
                        var videoInfo = $(this).find('.videoInfo').val();
                        conditon += '"videoInfo":"'+ escape(videoInfo)+ '",';
                        break;
                    default:
                }
                conditon = conditon.substring(0,conditon.length-1);
                json += conditon+"}},";

            });
            json = json.substring(0,json.length-1);
            return json;
        }



        //提交时限制图片为空
        $(".sub").click(function() {
            var stepListStr_b = set_step_json_b("step_b_1");
            $("input[name='stepListStr_b']").val(stepListStr_b);
            console.log(stepListStr_b);
//            return false;
            var can_on = 1;

            //关联游戏 图片
            if($.trim($('.taskIcon').val())=='' && $('#task_img').val()==''){
                alert("请选择图片");
                can_on = 0;
                return false;
            }

            $(".picUrls").each(function(k, v){
                if(($(v).val() == '') && ($(".picUrlsOld").eq(k).val() == '')){
                    console.log($(v).val());
                    console.log($(".picUrlsOld").eq(k).val());
                    alert("模板图片必须传");
                    can_on = 0;
                    return false;
                }
            });
            if(can_on == 0){
                return false;
            }
            $('#activity-task').submit();
        });

        gameselect('#gameselect');
        $(document).on('change','input.myfile',function(){
            var obj =  $(this).parent();
            var timestamp = new Date().getTime();
            var img_id = "id"+timestamp;
            $(this).attr("id",img_id);
            var btn_save = $(this).parent().parent().parent().parent().parent().siblings().eq(1).children(".btn_save");
            btn_save.attr("disabled","disabled");
            $.ajaxFileUpload
            (
                {
                    url:'/v4_task/task/ajax-upload-img', //你处理上传文件的服务端
                    type : 'post',
                    fileElementId:img_id,
                    dataType: 'json',
                    success: function (data)
                    {
                        if(data.success=="true"){
                            img_path = data.data;
                            //alert("图片上传完毕！");
                            obj.children("input[name='prize_img[]']").val(img_path);
                            btn_save.removeAttr("disabled");
                        }else{
                            alert(data.data);
                        }
                    }
                }
            );
            //}
        })

        $(".fileupload-remove").live("click",function(){
            $(this).parent().find("input[name='prize_img[]']").val('');
        });

        $('.third-add').bind('click',function(){
            var c = Number($('#third-count').val());
            c = c + 1;
            $('#third-count').val(c);
            $('#third').append('<div id="third-sub-'+c+'">'+$('#third-module').html()+'</div>');
        });
        $('.third-del').live('click',function(){
            if ($(this).parent().children('.thirdid').val()) {
                var ids = $('#third-delids').val();
                if (ids) {
                    ids += ',';
                }
                ids += $(this).parent().children('.thirdid').val();
                $('#third-delids').val(ids);
            }
            var c = Number($('#third-count').val());
            c = c - 1;
            $('#third-count').val(c);
            $(this).parent().remove();
        });

        function set_step_sort(steptype){
            var sort=1;
            $("."+steptype).each(function(){
                $(this).children("legend").children("span").html(sort);
                sort++;
            })
        }
        set_step_sort("step_b_1");
        set_step_sort("taskHtml");
    });

    var set_selected_game=function(game_id,game_name,icon){
        $('#selected_game_id').val(game_id);
        $('#selected_game_name').val(game_name);
        $('#selected_game_icon').attr('src',icon);
        $("#task_img").val(icon);
    };


</script>
<!--{%endblock%}-->