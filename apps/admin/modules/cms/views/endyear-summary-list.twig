<!--{%extends "base-layout.twig"%}-->
<!--{%block main_content%}-->
<div class="row-fluid">
	<div class="span12">
	    <div class="box box-color box-bordered">
			<div class="box-title">
				<h3>
					<i class="icon-table"></i>
					年终总结评论			
				</h3>
				<div class="actions">
				    <form action="<!--{{url('cms/summary/search')}}-->" class="">
				    <table class="table-filter">
				        <tr>				            
				            <td>
				            	<input name="type" type="hidden"  value="<!--{{type}}-->">		
				             	<!--{{form_select('keytype',cond.keytypes,cond.keytype,{'class':'input-small','style':'margin-bottom:0px'})}}-->
				            </td>
				            <td>
								<input name="keyword" type="text" class="input-medium" placeholder="" value="<!--{{cond.keyword}}-->">								
							</td>
				            <td><button class="btn btn-teal"><i class="icon-search"></i>搜索</button></td>
				        </tr>
				    </table>
				    </form>
				</div>
			</div>
			<div class="box-content nopadding">
			    <table class="table table-hover table-nomargin">
			        <thead>
						<tr>
							<th class="col-60">
								
								<div class="btn-group">
							        <a data-toggle="dropdown" class="btn dropdown-toggle"><span class="caret"></span></a>
							        <ul class="dropdown-menu">
							            <li><a href="<!--{{url('cms/summary/search/1')}}-->">已审核</a></li>
							            <li><a href="<!--{{url('cms/summary/search/0')}}-->">未审核</a></li>  
							        </ul>
							    </div>
							</th>
						    <th class="col-40">ID</th>
						    <th class="col-80">标题</th>
						    <th class="col-40">状态</th>
							<th class="col-160">内容</th>
							<th class="col-60">编辑时间</th>							
							<th class="table-btn-group">操作</th>
						</tr>
					</thead>
					<tbody>
					    <!--{%for item in datalist%}-->
						<tr>
							<td><input type="checkbox" name="everyone[]" value="<!--{{item.id}}-->"></td>
							<td><!--{{item.id}}--></td>							
							<td><!--{{item.nick}}--></td>
							<td><!--{%if item.audit == 1 %}--><span style="color:green;">已审核</span><!--{%else%}--><span style="color:red;">未审核</span><!--{%endif%}--></td>
							<td><!--{{item.content}}--></td>
							<td><!--{{item.addtime|date('Y-m-d')}}--></td>
							<td>
								<a href="<!--{{url('cms/summary/check',{'id':item.id,'type':item.audit})}}-->" class="btn btn-primary"><!--{%if item.audit == 1 %}-->取消<!--{%endif%}-->审核</a>
								<a href="<!--{{url('cms/summary/del',{'id':item.id})}}-->" class="btn btn-primary">删除</a>
							</td>
						</tr>
						<!--{%endfor%}-->
					</tbody>
			    </table>
			    <div style="float:lift;width: 200px;padding: 20px;">
			    	<input type="checkbox" name="all">
			    	<a href="<!--{{url('cms/summary/checks')}}-->" style="padding-lift:20px;" data-act="check" data-audit="1"  class="btn btn-primary ajax-digest-all">审核</a>
					<a href="<!--{{url('cms/summary/checks')}}-->" style="padding-lift:20px;" data-act="check" data-audit="0"  class="btn btn-primary ajax-digest-all">取消审核</a>
			    	
			    </div>
			    <div class="pagelink">
			        <!--{{pagelinks}}-->
			    </div>
			</div>
		</div>
	</div>
</div>

<!--{%endblock%}-->

<!--{%block footer_js%}-->
<script>
$(function(){
    $('a.ajax-del').bind('click',function(){
        if(!confirm('确定要删除数据吗？')){
            return false;
        }
    });
});

$(function(){
    $("input[name='all']").bind('click',function(){
    	if($(this).attr("checked") == 'checked'){
    		$("input[name='everyone[]']").attr("checked","checked");	
    	}else{
    		$("input[name='everyone[]']").removeAttr("checked");
    	}
    });
});

$(function(){
	var _this = $("input[name='everyone[]']");
	var all = $("input[name='all']");
	var count = _this.length;
	_this.bind('click',function(){
		var i = 0 ;
		_this.each(function (){
			if($(this).attr("checked") == 'checked'){
				i++;
			}
		});
		if( i == count){
			all.attr("checked","checked");
		}else{
			all.removeAttr("checked");
		}
    });
});

$('a.ajax-digest-all').bind('click',function(){
	
	var url = $(this).attr('href');
    $(this).attr('href','javascript:void(0);')
    var act = $(this).attr('data-act');
    var audit = $(this).attr('data-audit');
    var _this = $("input[name='everyone[]']");
    var tid = '';
    _this.each(function (){
		if($(this).attr("checked") == 'checked'){
			tid += ( tid == '' ) ? $(this).val() : ',' + $(this).val();
		}
	});
    if(tid == ''){
    	$(this).closest('.btn-group').removeClass('open');
    	$(this).attr('href',url);
    	alert('请选择要操作的文章！~~ ');
        return false;	
    }
    
    var data = {'act':act,'tids':tid,'audit':audit};
    /* console.log(data);
    return false; */
    $.ajax({
        url:url,
        type:'POST',
        data:data,
        dataType:'json',
        success:function(data){
       		html = data['html'];
       		alert(html);
       		window.location.href = window.location.href;
        }
    });
    return false;
	
});


$('a.ajax-digest').bind('click',function(){
    var url = $(this).attr('href');
    $(this).attr('href','javascript:void(0);')
    var act = $(this).attr('data-act');
    var tid = $(this).attr('data-id');
    var data = {'act':act,'type':'news','tmpids':tid};
    $.ajax({
        url:url,
        type:'POST',
        data:data,
        dataType:'json',
        success:function(data){
        	if(act == 'add-property'){
        		html = data['html'];
                $.dialog({id:'pop-tag-list',title:'添加属性',padding:2,content:html,width:600,height:580});
        	}else if(act == 'del-property'){
        		html = data['html'];
                $.dialog({id:'pop-tag-list',title:'删除属性',padding:2,content:html,width:600,height:580});
        	}else if(act == 'move'){
        		html = data['html'];
                $.dialog({id:'pop-type-list',title:'移动文章',padding:2,content:html,width:600,height:580});
        	}else{
        		html = data['html'];
        		alert(html);
        		window.location.href = window.location.href;
        	}
        }
    });
    return false;
});

</script>
<!--{%endblock%}-->